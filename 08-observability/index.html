
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Comprehensive training for Kubernetes architecture, operations, and security" name="description"/>
<meta content="K8s Security Training Contributors" name="author"/>
<link href="https://yourusername.github.io/k8s-architecture-and-security-training/08-observability/" rel="canonical"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.23" name="generator"/>
<title>Module 08: Observability and Logging - Kubernetes Architecture and Security Training</title>
<link href="../assets/stylesheets/main.84d31ad4.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#module-08-observability-and-logging">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Kubernetes Architecture and Security Training" class="md-header__button md-logo" data-md-component="logo" href=".." title="Kubernetes Architecture and Security Training">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Kubernetes Architecture and Security Training
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Module 08: Observability and Logging
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/yourusername/k8s-architecture-and-security-training" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    k8s-architecture-and-security-training
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../README.md">
          
  
  
  Getting Started

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../docs/01-k8s-basics.md">
          
  
  
  Foundation (Weeks 1-2)

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../docs/05-authn-authz.md">
          
  
  
  Security (Weeks 3-4)

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../docs/11-runtime-security.md">
          
  
  
  Advanced (Weeks 5-6)

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../REFERENCES.md">
          
  
  
  Resources

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Kubernetes Architecture and Security Training" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Kubernetes Architecture and Security Training">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Kubernetes Architecture and Security Training
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/yourusername/k8s-architecture-and-security-training" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    k8s-architecture-and-security-training
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Getting Started
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../README.md">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../SUMMARY.md">
<span class="md-ellipsis">
    Course Roadmap
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/00-intro.md">
<span class="md-ellipsis">
    Module 00 - Introduction
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Foundation (Weeks 1-2)
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Foundation (Weeks 1-2)
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/01-k8s-basics.md">
<span class="md-ellipsis">
    Module 01 - Kubernetes Basics
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/02-control-plane.md">
<span class="md-ellipsis">
    Module 02 - Control Plane
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/03-networking.md">
<span class="md-ellipsis">
    Module 03 - Networking
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/04-storage.md">
<span class="md-ellipsis">
    Module 04 - Storage
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Security (Weeks 3-4)
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Security (Weeks 3-4)
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/05-authn-authz.md">
<span class="md-ellipsis">
    Module 05 - Authentication &amp; Authorization
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/06-pod-security.md">
<span class="md-ellipsis">
    Module 06 - Pod Security
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/07-admission-policy.md">
<span class="md-ellipsis">
    Module 07 - Admission &amp; Policy
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/08-observability.md">
<span class="md-ellipsis">
    Module 08 - Observability
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/09-supply-chain.md">
<span class="md-ellipsis">
    Module 09 - Supply Chain Security
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/10-network-security.md">
<span class="md-ellipsis">
    Module 10 - Network Security
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Advanced (Weeks 5-6)
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Advanced (Weeks 5-6)
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/11-runtime-security.md">
<span class="md-ellipsis">
    Module 11 - Runtime Security
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/12-incident-response.md">
<span class="md-ellipsis">
    Module 12 - Incident Response
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/13-cis-compliance.md">
<span class="md-ellipsis">
    Module 13 - CIS &amp; Compliance
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/14-multi-cluster.md">
<span class="md-ellipsis">
    Module 14 - Multi-cluster
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/15-case-studies.md">
<span class="md-ellipsis">
    Module 15 - Case Studies
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Resources
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Resources
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../REFERENCES.md">
<span class="md-ellipsis">
    References
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CONTRIBUTING.md">
<span class="md-ellipsis">
    Contributing
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../WORKFLOW.md">
<span class="md-ellipsis">
    Workflow Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CHANGELOG.md">
<span class="md-ellipsis">
    Changelog
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#learning-objectives">
<span class="md-ellipsis">
      Learning Objectives
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1-observability-fundamentals">
<span class="md-ellipsis">
      1. Observability Fundamentals
    </span>
</a>
<nav aria-label="1. Observability Fundamentals" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11-the-three-pillars-of-observability">
<span class="md-ellipsis">
      1.1 The Three Pillars of Observability
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12-kubernetes-observability-architecture">
<span class="md-ellipsis">
      1.2 Kubernetes Observability Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#13-observability-for-security">
<span class="md-ellipsis">
      1.3 Observability for Security
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-prometheus-stack-deployment">
<span class="md-ellipsis">
      2. Prometheus Stack Deployment
    </span>
</a>
<nav aria-label="2. Prometheus Stack Deployment" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#21-prometheus-overview">
<span class="md-ellipsis">
      2.1 Prometheus Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#22-installing-prometheus-operator">
<span class="md-ellipsis">
      2.2 Installing Prometheus Operator
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#23-prometheus-configuration">
<span class="md-ellipsis">
      2.3 Prometheus Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#24-key-prometheus-metrics-for-security">
<span class="md-ellipsis">
      2.4 Key Prometheus Metrics for Security
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#25-prometheus-security-configuration">
<span class="md-ellipsis">
      2.5 Prometheus Security Configuration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-grafana-dashboards">
<span class="md-ellipsis">
      3. Grafana Dashboards
    </span>
</a>
<nav aria-label="3. Grafana Dashboards" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#31-accessing-grafana">
<span class="md-ellipsis">
      3.1 Accessing Grafana
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#32-security-focused-dashboards">
<span class="md-ellipsis">
      3.2 Security-Focused Dashboards
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#33-creating-custom-dashboards">
<span class="md-ellipsis">
      3.3 Creating Custom Dashboards
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#34-grafana-security-configuration">
<span class="md-ellipsis">
      3.4 Grafana Security Configuration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-log-aggregation">
<span class="md-ellipsis">
      4. Log Aggregation
    </span>
</a>
<nav aria-label="4. Log Aggregation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#41-fluentd-architecture">
<span class="md-ellipsis">
      4.1 Fluentd Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#42-installing-fluent-bit">
<span class="md-ellipsis">
      4.2 Installing Fluent Bit
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#43-loki-for-log-storage">
<span class="md-ellipsis">
      4.3 Loki for Log Storage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#44-log-security-best-practices">
<span class="md-ellipsis">
      4.4 Log Security Best Practices
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-kubernetes-audit-logging">
<span class="md-ellipsis">
      5. Kubernetes Audit Logging
    </span>
</a>
<nav aria-label="5. Kubernetes Audit Logging" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#51-audit-logging-overview">
<span class="md-ellipsis">
      5.1 Audit Logging Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#52-audit-policy-configuration">
<span class="md-ellipsis">
      5.2 Audit Policy Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#53-enabling-audit-logging">
<span class="md-ellipsis">
      5.3 Enabling Audit Logging
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#54-audit-webhook-backend">
<span class="md-ellipsis">
      5.4 Audit Webhook Backend
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#55-analyzing-audit-logs">
<span class="md-ellipsis">
      5.5 Analyzing Audit Logs
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-opentelemetry-and-distributed-tracing">
<span class="md-ellipsis">
      6. OpenTelemetry and Distributed Tracing
    </span>
</a>
<nav aria-label="6. OpenTelemetry and Distributed Tracing" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#61-opentelemetry-overview">
<span class="md-ellipsis">
      6.1 OpenTelemetry Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#62-installing-opentelemetry-operator">
<span class="md-ellipsis">
      6.2 Installing OpenTelemetry Operator
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#63-opentelemetry-collector-configuration">
<span class="md-ellipsis">
      6.3 OpenTelemetry Collector Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#64-instrumenting-applications">
<span class="md-ellipsis">
      6.4 Instrumenting Applications
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-security-alerting">
<span class="md-ellipsis">
      7. Security Alerting
    </span>
</a>
<nav aria-label="7. Security Alerting" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#71-alertmanager-configuration">
<span class="md-ellipsis">
      7.1 Alertmanager Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#72-security-alert-rules">
<span class="md-ellipsis">
      7.2 Security Alert Rules
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#73-log-based-alerts-loki">
<span class="md-ellipsis">
      7.3 Log-Based Alerts (Loki)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-observability-stack-security">
<span class="md-ellipsis">
      8. Observability Stack Security
    </span>
</a>
<nav aria-label="8. Observability Stack Security" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#81-securing-prometheus">
<span class="md-ellipsis">
      8.1 Securing Prometheus
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#82-encryption-at-rest">
<span class="md-ellipsis">
      8.2 Encryption at Rest
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#83-access-control">
<span class="md-ellipsis">
      8.3 Access Control
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#9-best-practices">
<span class="md-ellipsis">
      9. Best Practices
    </span>
</a>
<nav aria-label="9. Best Practices" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#91-observability-checklist">
<span class="md-ellipsis">
      9.1 Observability Checklist
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#92-performance-optimization">
<span class="md-ellipsis">
      9.2 Performance Optimization
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#10-security-checklist">
<span class="md-ellipsis">
      10. Security Checklist
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11-references">
<span class="md-ellipsis">
      11. References
    </span>
</a>
<nav aria-label="11. References" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#official-documentation">
<span class="md-ellipsis">
      Official Documentation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prometheus">
<span class="md-ellipsis">
      Prometheus
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#logging">
<span class="md-ellipsis">
      Logging
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tracing">
<span class="md-ellipsis">
      Tracing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security">
<span class="md-ellipsis">
      Security
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#next-steps">
<span class="md-ellipsis">
      Next Steps
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="module-08-observability-and-logging">Module 08: Observability and Logging<a class="headerlink" href="#module-08-observability-and-logging" title="Permanent link">¶</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¶</a></h2>
<p><strong>Estimated Time:</strong> 6-7 hours</p>
<p><strong>Module Type:</strong> Security Deep Dive</p>
<p><strong>Prerequisites:</strong>
- Module 02 - Control Plane and Cluster Components
- Module 03 - Networking Fundamentals
- Understanding of metrics, logs, and distributed tracing concepts
- Basic knowledge of Prometheus and Grafana</p>
<p>Observability is critical for detecting security incidents, troubleshooting issues, and maintaining cluster health. This module covers the three pillars of observability (metrics, logs, traces), deploying monitoring stacks (Prometheus, Grafana), implementing security-focused logging, Kubernetes audit logging, and alerting on security events. You'll learn to build comprehensive observability systems for production Kubernetes clusters.</p>
<hr/>
<h2 id="learning-objectives">Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permanent link">¶</a></h2>
<p>By the end of this module, you will be able to:</p>
<ol>
<li>Understand the three pillars of observability (metrics, logs, traces)</li>
<li>Deploy and configure Prometheus for Kubernetes monitoring</li>
<li>Create Grafana dashboards for security and operational metrics</li>
<li>Implement centralized logging with Fluentd/Fluent Bit</li>
<li>Configure Kubernetes audit logging for security events</li>
<li>Deploy OpenTelemetry for distributed tracing</li>
<li>Create security-focused alerts and runbooks</li>
<li>Query logs and metrics for security investigations</li>
<li>Implement log retention and compliance requirements</li>
<li>Build end-to-end observability pipelines</li>
</ol>
<hr/>
<h2 id="1-observability-fundamentals">1. Observability Fundamentals<a class="headerlink" href="#1-observability-fundamentals" title="Permanent link">¶</a></h2>
<h3 id="11-the-three-pillars-of-observability">1.1 The Three Pillars of Observability<a class="headerlink" href="#11-the-three-pillars-of-observability" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>graph TB
    A[Observability] --&gt; B[Metrics]
    A --&gt; C[Logs]
    A --&gt; D[Traces]

    B --&gt; B1[Time-series data]
    B --&gt; B2[Aggregations]
    B --&gt; B3[Prometheus/Thanos]

    C --&gt; C1[Event records]
    C --&gt; C2[Structured logging]
    C --&gt; C3[Fluentd/Loki]

    D --&gt; D1[Request flows]
    D --&gt; D2[Latency analysis]
    D --&gt; D3[Jaeger/Tempo]

    style B fill:#6bcf7f
    style C fill:#ffd93d
    style D fill:#4da6ff</code></pre>
<p><strong>Metrics:</strong>
- Numerical measurements over time
- CPU usage, memory consumption, request rates
- Efficient for dashboards and alerting
- Tools: Prometheus, Thanos, Cortex</p>
<p><strong>Logs:</strong>
- Discrete event records
- Application logs, audit logs, system logs
- Detailed context for investigations
- Tools: Fluentd, Fluent Bit, Loki, Elasticsearch</p>
<p><strong>Traces:</strong>
- Request lifecycle tracking
- Distributed transaction flows
- Identify performance bottlenecks
- Tools: Jaeger, Tempo, Zipkin, OpenTelemetry</p>
<h3 id="12-kubernetes-observability-architecture">1.2 Kubernetes Observability Architecture<a class="headerlink" href="#12-kubernetes-observability-architecture" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>graph TB
    subgraph "Kubernetes Cluster"
        A[Pods/Containers]
        B[Kubelet]
        C[API Server]
        D[Control Plane]
    end

    subgraph "Metrics"
        E[cAdvisor]
        F[Metrics Server]
        G[Prometheus]
        H[Grafana]
    end

    subgraph "Logs"
        I[Container Logs]
        J[Fluentd/Fluent Bit]
        K[Log Storage]
        L[Elasticsearch/Loki]
    end

    subgraph "Traces"
        M[OpenTelemetry]
        N[Jaeger/Tempo]
    end

    A --&gt;|Container Metrics| E
    B --&gt;|Node Metrics| E
    E --&gt; G
    C --&gt;|Audit Logs| J
    A --&gt;|App Logs| I
    I --&gt; J
    J --&gt; K
    K --&gt; L
    G --&gt; H
    F --&gt; G
    A --&gt;|Traces| M
    M --&gt; N

    style G fill:#e76f51
    style J fill:#2a9d8f
    style M fill:#e9c46a</code></pre>
<h3 id="13-observability-for-security">1.3 Observability for Security<a class="headerlink" href="#13-observability-for-security" title="Permanent link">¶</a></h3>
<p><strong>Security Use Cases:</strong>
- Detect anomalous behavior (unusual API calls, resource consumption)
- Track authentication/authorization failures
- Monitor policy violations
- Audit trail for compliance
- Incident response and forensics
- Vulnerability detection
- Lateral movement detection</p>
<hr/>
<h2 id="2-prometheus-stack-deployment">2. Prometheus Stack Deployment<a class="headerlink" href="#2-prometheus-stack-deployment" title="Permanent link">¶</a></h2>
<h3 id="21-prometheus-overview">2.1 Prometheus Overview<a class="headerlink" href="#21-prometheus-overview" title="Permanent link">¶</a></h3>
<p>Prometheus is a time-series database and monitoring system that scrapes metrics from instrumented targets.</p>
<p><strong>Key Components:</strong>
- <strong>Prometheus Server</strong> - Scrapes and stores metrics
- <strong>Alertmanager</strong> - Handles alerts
- <strong>Node Exporter</strong> - Hardware and OS metrics
- <strong>kube-state-metrics</strong> - Kubernetes object state
- <strong>Pushgateway</strong> - For short-lived jobs</p>
<h3 id="22-installing-prometheus-operator">2.2 Installing Prometheus Operator<a class="headerlink" href="#22-installing-prometheus-operator" title="Permanent link">¶</a></h3>
<p><strong>Using Helm (kube-prometheus-stack):</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># Add Prometheus community Helm repository</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>prometheus-community<span class="w"> </span>https://prometheus-community.github.io/helm-charts
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>helm<span class="w"> </span>repo<span class="w"> </span>update
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="c1"># Create namespace</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>monitoring
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="c1"># Install kube-prometheus-stack</span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a>helm<span class="w"> </span>install<span class="w"> </span>prometheus<span class="w"> </span>prometheus-community/kube-prometheus-stack<span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">  </span>--namespace<span class="w"> </span>monitoring<span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">  </span>--set<span class="w"> </span>prometheus.prometheusSpec.retention<span class="o">=</span>30d<span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">  </span>--set<span class="w"> </span>prometheus.prometheusSpec.storageSpec.volumeClaimTemplate.spec.resources.requests.storage<span class="o">=</span>50Gi<span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">  </span>--set<span class="w"> </span>grafana.adminPassword<span class="o">=</span>SecurePassword123!<span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">  </span>--set<span class="w"> </span>prometheus.prometheusSpec.securityContext.runAsNonRoot<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">  </span>--set<span class="w"> </span>prometheus.prometheusSpec.securityContext.runAsUser<span class="o">=</span><span class="m">65534</span>
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a>
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="c1"># Verify installation</span>
<a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>monitoring
</code></pre></div></p>
<p><strong>Verify services:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>monitoring
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="c1"># Expected services:</span>
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="c1"># - prometheus-kube-prometheus-prometheus</span>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="c1"># - prometheus-kube-state-metrics</span>
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="c1"># - prometheus-prometheus-node-exporter</span>
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="c1"># - alertmanager-operated</span>
<a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="c1"># - prometheus-grafana</span>
</code></pre></div></p>
<h3 id="23-prometheus-configuration">2.3 Prometheus Configuration<a class="headerlink" href="#23-prometheus-configuration" title="Permanent link">¶</a></h3>
<p><strong>ServiceMonitor for Custom Application:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring.coreos.com/v1</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceMonitor</span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp-monitor</span>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="nt">release</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus</span>
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">  </span><span class="nt">endpoints</span><span class="p">:</span>
<a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metrics</span>
<a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/metrics</span>
<a href="#__codelineno-2-16" id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">    </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
</code></pre></div></p>
<p><strong>PodMonitor Example:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring.coreos.com/v1</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PodMonitor</span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-monitor</span>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">instrumented-app</span>
<a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">  </span><span class="nt">podMetricsEndpoints</span><span class="p">:</span>
<a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metrics</span>
<a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/metrics</span>
<a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</code></pre></div></p>
<h3 id="24-key-prometheus-metrics-for-security">2.4 Key Prometheus Metrics for Security<a class="headerlink" href="#24-key-prometheus-metrics-for-security" title="Permanent link">¶</a></h3>
<p><strong>API Server Metrics:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># Authentication failures</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="kr">rate</span><span class="o">(</span><span class="nv">apiserver_authentication_failure_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="c1"># Authorization failures</span>
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="kr">rate</span><span class="o">(</span><span class="nv">apiserver_authorization_failure_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
<a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>
<a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="c1"># API request rate by verb and user</span>
<a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="kr">rate</span><span class="o">(</span><span class="nv">apiserver_request_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
<a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a>
<a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="c1"># Requests to sensitive resources</span>
<a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="nv">apiserver_request_total</span><span class="p">{</span><span class="nl">resource</span><span class="o">=</span><span class="p">"</span><span class="s">secrets</span><span class="p">"}</span>
<a href="#__codelineno-4-12" id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="nv">apiserver_request_total</span><span class="p">{</span><span class="nl">resource</span><span class="o">=</span><span class="p">"</span><span class="s">serviceaccounts</span><span class="p">"}</span>
<a href="#__codelineno-4-13" id="__codelineno-4-13" name="__codelineno-4-13"></a>
<a href="#__codelineno-4-14" id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="c1"># Admission webhook failures</span>
<a href="#__codelineno-4-15" id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="nv">apiserver_admission_webhook_rejection_count</span>
</code></pre></div></p>
<p><strong>Container Security Metrics:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1"># Privileged containers</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="k">count</span><span class="o">(</span><span class="nv">kube_pod_container_status_running</span><span class="p">{</span><span class="nl">container_security_context_privileged</span><span class="o">=</span><span class="p">"</span><span class="s">true</span><span class="p">"}</span><span class="o">)</span>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="c1"># Containers running as root</span>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="k">count</span><span class="o">(</span><span class="nv">kube_pod_container_status_running</span><span class="p">{</span><span class="nl">container_security_context_run_as_user</span><span class="o">=</span><span class="p">"</span><span class="s">0</span><span class="p">"}</span><span class="o">)</span>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="c1"># Pods without resource limits</span>
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="k">count</span><span class="o">(</span><span class="nv">kube_pod_container_resource_limits</span><span class="p">{</span><span class="nl">resource</span><span class="o">=</span><span class="p">"</span><span class="s">memory</span><span class="p">"}</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="o">)</span>
</code></pre></div></p>
<p><strong>Network Metrics:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1"># Network policy violations (requires CNI support)</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="kr">rate</span><span class="o">(</span><span class="nv">cilium_policy_drop_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a>
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="c1"># Suspicious network connections</span>
<a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="kr">rate</span><span class="o">(</span><span class="nv">container_network_tcp_connections_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span>
</code></pre></div></p>
<h3 id="25-prometheus-security-configuration">2.5 Prometheus Security Configuration<a class="headerlink" href="#25-prometheus-security-configuration" title="Permanent link">¶</a></h3>
<p><strong>Authentication and Authorization:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring.coreos.com/v1</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prometheus</span>
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus</span>
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">  </span><span class="c1"># Security context</span>
<a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">  </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">    </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">    </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65534</span>
<a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">    </span><span class="nt">fsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65534</span>
<a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">    </span><span class="nt">seccompProfile</span><span class="p">:</span>
<a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RuntimeDefault</span>
<a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a>
<a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="w">  </span><span class="c1"># Pod security</span>
<a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="w">  </span><span class="nt">podSecurityContext</span><span class="p">:</span>
<a href="#__codelineno-7-17" id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="w">    </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-7-18" id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="w">    </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65534</span>
<a href="#__codelineno-7-19" id="__codelineno-7-19" name="__codelineno-7-19"></a>
<a href="#__codelineno-7-20" id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="w">  </span><span class="c1"># Enable RBAC</span>
<a href="#__codelineno-7-21" id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="w">  </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus</span>
<a href="#__codelineno-7-22" id="__codelineno-7-22" name="__codelineno-7-22"></a>
<a href="#__codelineno-7-23" id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="w">  </span><span class="c1"># Remote write with authentication</span>
<a href="#__codelineno-7-24" id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="w">  </span><span class="nt">remoteWrite</span><span class="p">:</span>
<a href="#__codelineno-7-25" id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://remote-storage.example.com/api/v1/push</span>
<a href="#__codelineno-7-26" id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="w">    </span><span class="nt">basicAuth</span><span class="p">:</span>
<a href="#__codelineno-7-27" id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="w">      </span><span class="nt">username</span><span class="p">:</span>
<a href="#__codelineno-7-28" id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus-creds</span>
<a href="#__codelineno-7-29" id="__codelineno-7-29" name="__codelineno-7-29"></a><span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">username</span>
<a href="#__codelineno-7-30" id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="w">      </span><span class="nt">password</span><span class="p">:</span>
<a href="#__codelineno-7-31" id="__codelineno-7-31" name="__codelineno-7-31"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus-creds</span>
<a href="#__codelineno-7-32" id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
<a href="#__codelineno-7-33" id="__codelineno-7-33" name="__codelineno-7-33"></a><span class="w">    </span><span class="nt">tlsConfig</span><span class="p">:</span>
<a href="#__codelineno-7-34" id="__codelineno-7-34" name="__codelineno-7-34"></a><span class="w">      </span><span class="nt">ca</span><span class="p">:</span>
<a href="#__codelineno-7-35" id="__codelineno-7-35" name="__codelineno-7-35"></a><span class="w">        </span><span class="nt">secret</span><span class="p">:</span>
<a href="#__codelineno-7-36" id="__codelineno-7-36" name="__codelineno-7-36"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remote-ca</span>
<a href="#__codelineno-7-37" id="__codelineno-7-37" name="__codelineno-7-37"></a><span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ca.crt</span>
<a href="#__codelineno-7-38" id="__codelineno-7-38" name="__codelineno-7-38"></a>
<a href="#__codelineno-7-39" id="__codelineno-7-39" name="__codelineno-7-39"></a><span class="w">  </span><span class="c1"># Encryption at rest</span>
<a href="#__codelineno-7-40" id="__codelineno-7-40" name="__codelineno-7-40"></a><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<a href="#__codelineno-7-41" id="__codelineno-7-41" name="__codelineno-7-41"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data</span>
<a href="#__codelineno-7-42" id="__codelineno-7-42" name="__codelineno-7-42"></a><span class="w">    </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<a href="#__codelineno-7-43" id="__codelineno-7-43" name="__codelineno-7-43"></a><span class="w">      </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus-data</span>
</code></pre></div></p>
<hr/>
<h2 id="3-grafana-dashboards">3. Grafana Dashboards<a class="headerlink" href="#3-grafana-dashboards" title="Permanent link">¶</a></h2>
<h3 id="31-accessing-grafana">3.1 Accessing Grafana<a class="headerlink" href="#31-accessing-grafana" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="c1"># Port-forward to Grafana</span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>kubectl<span class="w"> </span>port-forward<span class="w"> </span>-n<span class="w"> </span>monitoring<span class="w"> </span>svc/prometheus-grafana<span class="w"> </span><span class="m">3000</span>:80
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="c1"># Or use LoadBalancer/Ingress</span>
<a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a>kubectl<span class="w"> </span>patch<span class="w"> </span>svc<span class="w"> </span>prometheus-grafana<span class="w"> </span>-n<span class="w"> </span>monitoring<span class="w"> </span>-p<span class="w"> </span><span class="s1">'{"spec": {"type": "LoadBalancer"}}'</span>
<a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>
<a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="c1"># Get admin password (if using default)</span>
<a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>-n<span class="w"> </span>monitoring<span class="w"> </span>prometheus-grafana<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.data.admin-password}"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>--decode
</code></pre></div>
<h3 id="32-security-focused-dashboards">3.2 Security-Focused Dashboards<a class="headerlink" href="#32-security-focused-dashboards" title="Permanent link">¶</a></h3>
<p><strong>API Server Security Dashboard:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="p">{</span>
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">  </span><span class="nt">"dashboard"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">    </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Kubernetes Security - API Server"</span><span class="p">,</span>
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">    </span><span class="nt">"panels"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">      </span><span class="p">{</span>
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">        </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Authentication Failures"</span><span class="p">,</span>
<a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">        </span><span class="nt">"targets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">          </span><span class="p">{</span>
<a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">            </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rate(apiserver_authentication_failure_total[5m])"</span>
<a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="w">          </span><span class="p">}</span>
<a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="w">        </span><span class="p">],</span>
<a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="w">        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"graph"</span>
<a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="w">      </span><span class="p">},</span>
<a href="#__codelineno-9-14" id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="w">      </span><span class="p">{</span>
<a href="#__codelineno-9-15" id="__codelineno-9-15" name="__codelineno-9-15"></a><span class="w">        </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Authorization Failures by User"</span><span class="p">,</span>
<a href="#__codelineno-9-16" id="__codelineno-9-16" name="__codelineno-9-16"></a><span class="w">        </span><span class="nt">"targets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-9-17" id="__codelineno-9-17" name="__codelineno-9-17"></a><span class="w">          </span><span class="p">{</span>
<a href="#__codelineno-9-18" id="__codelineno-9-18" name="__codelineno-9-18"></a><span class="w">            </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"topk(10, rate(apiserver_authorization_failure_total[5m]))"</span>
<a href="#__codelineno-9-19" id="__codelineno-9-19" name="__codelineno-9-19"></a><span class="w">          </span><span class="p">}</span>
<a href="#__codelineno-9-20" id="__codelineno-9-20" name="__codelineno-9-20"></a><span class="w">        </span><span class="p">],</span>
<a href="#__codelineno-9-21" id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="w">        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"graph"</span>
<a href="#__codelineno-9-22" id="__codelineno-9-22" name="__codelineno-9-22"></a><span class="w">      </span><span class="p">},</span>
<a href="#__codelineno-9-23" id="__codelineno-9-23" name="__codelineno-9-23"></a><span class="w">      </span><span class="p">{</span>
<a href="#__codelineno-9-24" id="__codelineno-9-24" name="__codelineno-9-24"></a><span class="w">        </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Requests to Secrets"</span><span class="p">,</span>
<a href="#__codelineno-9-25" id="__codelineno-9-25" name="__codelineno-9-25"></a><span class="w">        </span><span class="nt">"targets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-9-26" id="__codelineno-9-26" name="__codelineno-9-26"></a><span class="w">          </span><span class="p">{</span>
<a href="#__codelineno-9-27" id="__codelineno-9-27" name="__codelineno-9-27"></a><span class="w">            </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sum(rate(apiserver_request_total{resource=\"secrets\"}[5m])) by (verb, user)"</span>
<a href="#__codelineno-9-28" id="__codelineno-9-28" name="__codelineno-9-28"></a><span class="w">          </span><span class="p">}</span>
<a href="#__codelineno-9-29" id="__codelineno-9-29" name="__codelineno-9-29"></a><span class="w">        </span><span class="p">],</span>
<a href="#__codelineno-9-30" id="__codelineno-9-30" name="__codelineno-9-30"></a><span class="w">        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"table"</span>
<a href="#__codelineno-9-31" id="__codelineno-9-31" name="__codelineno-9-31"></a><span class="w">      </span><span class="p">},</span>
<a href="#__codelineno-9-32" id="__codelineno-9-32" name="__codelineno-9-32"></a><span class="w">      </span><span class="p">{</span>
<a href="#__codelineno-9-33" id="__codelineno-9-33" name="__codelineno-9-33"></a><span class="w">        </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Admission Webhook Latency"</span><span class="p">,</span>
<a href="#__codelineno-9-34" id="__codelineno-9-34" name="__codelineno-9-34"></a><span class="w">        </span><span class="nt">"targets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-9-35" id="__codelineno-9-35" name="__codelineno-9-35"></a><span class="w">          </span><span class="p">{</span>
<a href="#__codelineno-9-36" id="__codelineno-9-36" name="__codelineno-9-36"></a><span class="w">            </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"histogram_quantile(0.99, rate(apiserver_admission_webhook_admission_duration_seconds_bucket[5m]))"</span>
<a href="#__codelineno-9-37" id="__codelineno-9-37" name="__codelineno-9-37"></a><span class="w">          </span><span class="p">}</span>
<a href="#__codelineno-9-38" id="__codelineno-9-38" name="__codelineno-9-38"></a><span class="w">        </span><span class="p">],</span>
<a href="#__codelineno-9-39" id="__codelineno-9-39" name="__codelineno-9-39"></a><span class="w">        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"graph"</span>
<a href="#__codelineno-9-40" id="__codelineno-9-40" name="__codelineno-9-40"></a><span class="w">      </span><span class="p">}</span>
<a href="#__codelineno-9-41" id="__codelineno-9-41" name="__codelineno-9-41"></a><span class="w">    </span><span class="p">]</span>
<a href="#__codelineno-9-42" id="__codelineno-9-42" name="__codelineno-9-42"></a><span class="w">  </span><span class="p">}</span>
<a href="#__codelineno-9-43" id="__codelineno-9-43" name="__codelineno-9-43"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>Pod Security Dashboard (PromQL queries):</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1"># Privileged pods count</span>
<a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="k">count</span><span class="o">(</span><span class="nv">kube_pod_container_status_running</span><span class="p">{</span><span class="nl">container_security_context_privileged</span><span class="o">=</span><span class="p">"</span><span class="s">true</span><span class="p">"}</span><span class="o">)</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">namespace</span><span class="o">)</span>
<a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a>
<a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="c1"># Pods running as root</span>
<a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="k">count</span><span class="o">(</span><span class="nv">kube_pod_container_status_running</span><span class="p">{</span><span class="nl">container_security_context_run_as_user</span><span class="o">=</span><span class="p">"</span><span class="s">0</span><span class="p">"}</span><span class="o">)</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">namespace</span><span class="p">,</span><span class="w"> </span><span class="nv">pod</span><span class="o">)</span>
<a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a>
<a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="c1"># Pods without resource limits</span>
<a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="k">count</span><span class="o">(</span><span class="nv">kube_pod_container_info</span><span class="w"> </span><span class="ow">unless</span><span class="w"> </span><span class="k">on</span><span class="o">(</span><span class="nv">pod</span><span class="p">,</span><span class="w"> </span><span class="nv">namespace</span><span class="o">)</span><span class="w"> </span><span class="nv">kube_pod_container_resource_limits</span><span class="o">)</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">namespace</span><span class="o">)</span>
<a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a>
<a href="#__codelineno-10-10" id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="c1"># Host network usage</span>
<a href="#__codelineno-10-11" id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="k">count</span><span class="o">(</span><span class="nv">kube_pod_spec_host_network</span><span class="p">{</span><span class="nl">host_network</span><span class="o">=</span><span class="p">"</span><span class="s">true</span><span class="p">"}</span><span class="o">)</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">namespace</span><span class="o">)</span>
<a href="#__codelineno-10-12" id="__codelineno-10-12" name="__codelineno-10-12"></a>
<a href="#__codelineno-10-13" id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="c1"># Recent pod failures</span>
<a href="#__codelineno-10-14" id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="kr">increase</span><span class="o">(</span><span class="nv">kube_pod_container_status_restarts_total</span><span class="p">[</span><span class="s">1h</span><span class="p">]</span><span class="o">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span>
</code></pre></div></p>
<p><strong>Network Security Dashboard:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1"># Top talkers by pod</span>
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="k">topk</span><span class="o">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">container_network_transmit_bytes_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">pod</span><span class="o">))</span>
<a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a>
<a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="c1"># Egress traffic by namespace</span>
<a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">container_network_transmit_bytes_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">namespace</span><span class="o">)</span>
<a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a>
<a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="c1"># Network policy denies (Cilium)</span>
<a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="kr">rate</span><span class="o">(</span><span class="nv">cilium_policy_drop_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
<a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a>
<a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="c1"># DNS queries</span>
<a href="#__codelineno-11-11" id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="kr">rate</span><span class="o">(</span><span class="nv">coredns_dns_requests_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
</code></pre></div></p>
<h3 id="33-creating-custom-dashboards">3.3 Creating Custom Dashboards<a class="headerlink" href="#33-creating-custom-dashboards" title="Permanent link">¶</a></h3>
<p><strong>Import Dashboard via UI:</strong>
1. Navigate to Dashboards → Import
2. Use dashboard ID from Grafana.com (e.g., 15757 for Kubernetes Cluster Monitoring)
3. Or paste JSON configuration</p>
<p><strong>Dashboard as Code (Terraform):</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_dashboard"</span><span class="w"> </span><span class="nv">"security"</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">  </span><span class="na">config_json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">file</span><span class="p">(</span><span class="s2">"${path.module}/dashboards/security.json"</span><span class="p">)</span>
<a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">  </span><span class="na">folder</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_folder.security.id</span>
<a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="p">}</span>
<a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a>
<a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_folder"</span><span class="w"> </span><span class="nv">"security"</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">  </span><span class="na">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Security Dashboards"</span>
<a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="34-grafana-security-configuration">3.4 Grafana Security Configuration<a class="headerlink" href="#34-grafana-security-configuration" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1"># values.yaml for Grafana Helm chart</span>
<a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="nt">grafana</span><span class="p">:</span>
<a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">  </span><span class="nt">adminPassword</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;strong-password&gt;</span>
<a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a>
<a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">  </span><span class="c1"># Authentication</span>
<a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">  </span><span class="nt">grafana.ini</span><span class="p">:</span>
<a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">    </span><span class="nt">server</span><span class="p">:</span>
<a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">      </span><span class="nt">root_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://grafana.example.com</span>
<a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">    </span><span class="nt">security</span><span class="p">:</span>
<a href="#__codelineno-13-10" id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="w">      </span><span class="nt">admin_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<a href="#__codelineno-13-11" id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="w">      </span><span class="nt">secret_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;random-secret-key&gt;</span>
<a href="#__codelineno-13-12" id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="w">      </span><span class="nt">disable_gravatar</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-13-13" id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="w">    </span><span class="nt">auth</span><span class="p">:</span>
<a href="#__codelineno-13-14" id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="w">      </span><span class="nt">disable_login_form</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a href="#__codelineno-13-15" id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="w">    </span><span class="nt">auth.anonymous</span><span class="p">:</span>
<a href="#__codelineno-13-16" id="__codelineno-13-16" name="__codelineno-13-16"></a><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a href="#__codelineno-13-17" id="__codelineno-13-17" name="__codelineno-13-17"></a><span class="w">    </span><span class="nt">auth.basic</span><span class="p">:</span>
<a href="#__codelineno-13-18" id="__codelineno-13-18" name="__codelineno-13-18"></a><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-13-19" id="__codelineno-13-19" name="__codelineno-13-19"></a><span class="w">    </span><span class="nt">users</span><span class="p">:</span>
<a href="#__codelineno-13-20" id="__codelineno-13-20" name="__codelineno-13-20"></a><span class="w">      </span><span class="nt">allow_sign_up</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a href="#__codelineno-13-21" id="__codelineno-13-21" name="__codelineno-13-21"></a><span class="w">      </span><span class="nt">auto_assign_org_role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Viewer</span>
<a href="#__codelineno-13-22" id="__codelineno-13-22" name="__codelineno-13-22"></a>
<a href="#__codelineno-13-23" id="__codelineno-13-23" name="__codelineno-13-23"></a><span class="w">  </span><span class="c1"># RBAC</span>
<a href="#__codelineno-13-24" id="__codelineno-13-24" name="__codelineno-13-24"></a><span class="w">  </span><span class="nt">rbac</span><span class="p">:</span>
<a href="#__codelineno-13-25" id="__codelineno-13-25" name="__codelineno-13-25"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-13-26" id="__codelineno-13-26" name="__codelineno-13-26"></a>
<a href="#__codelineno-13-27" id="__codelineno-13-27" name="__codelineno-13-27"></a><span class="w">  </span><span class="c1"># Security context</span>
<a href="#__codelineno-13-28" id="__codelineno-13-28" name="__codelineno-13-28"></a><span class="w">  </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-13-29" id="__codelineno-13-29" name="__codelineno-13-29"></a><span class="w">    </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-13-30" id="__codelineno-13-30" name="__codelineno-13-30"></a><span class="w">    </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">472</span>
<a href="#__codelineno-13-31" id="__codelineno-13-31" name="__codelineno-13-31"></a><span class="w">    </span><span class="nt">fsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">472</span>
</code></pre></div>
<hr/>
<h2 id="4-log-aggregation">4. Log Aggregation<a class="headerlink" href="#4-log-aggregation" title="Permanent link">¶</a></h2>
<h3 id="41-fluentd-architecture">4.1 Fluentd Architecture<a class="headerlink" href="#41-fluentd-architecture" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>graph LR
    A[Container Logs] --&gt; B[Fluentd DaemonSet]
    C[Audit Logs] --&gt; B
    D[System Logs] --&gt; B

    B --&gt; E[Log Processing]
    E --&gt; F[Filter/Parse]
    F --&gt; G[Enrich]

    G --&gt; H[Elasticsearch]
    G --&gt; I[Loki]
    G --&gt; J[S3]
    G --&gt; K[Splunk]

    style B fill:#2a9d8f
    style E fill:#e9c46a</code></pre>
<h3 id="42-installing-fluent-bit">4.2 Installing Fluent Bit<a class="headerlink" href="#42-installing-fluent-bit" title="Permanent link">¶</a></h3>
<p>Fluent Bit is a lightweight alternative to Fluentd, ideal for forwarding logs.</p>
<p><strong>Fluent Bit DaemonSet:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent-bit</span>
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logging</span>
<a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="nn">---</span>
<a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent-bit</span>
<a href="#__codelineno-14-11" id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="nt">rules</span><span class="p">:</span>
<a href="#__codelineno-14-12" id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">""</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-14-13" id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"namespaces"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"pods"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-14-14" id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"get"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"list"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"watch"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-14-15" id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="nn">---</span>
<a href="#__codelineno-14-16" id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<a href="#__codelineno-14-17" id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<a href="#__codelineno-14-18" id="__codelineno-14-18" name="__codelineno-14-18"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-14-19" id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent-bit</span>
<a href="#__codelineno-14-20" id="__codelineno-14-20" name="__codelineno-14-20"></a><span class="nt">roleRef</span><span class="p">:</span>
<a href="#__codelineno-14-21" id="__codelineno-14-21" name="__codelineno-14-21"></a><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<a href="#__codelineno-14-22" id="__codelineno-14-22" name="__codelineno-14-22"></a><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<a href="#__codelineno-14-23" id="__codelineno-14-23" name="__codelineno-14-23"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent-bit</span>
<a href="#__codelineno-14-24" id="__codelineno-14-24" name="__codelineno-14-24"></a><span class="nt">subjects</span><span class="p">:</span>
<a href="#__codelineno-14-25" id="__codelineno-14-25" name="__codelineno-14-25"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<a href="#__codelineno-14-26" id="__codelineno-14-26" name="__codelineno-14-26"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent-bit</span>
<a href="#__codelineno-14-27" id="__codelineno-14-27" name="__codelineno-14-27"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logging</span>
<a href="#__codelineno-14-28" id="__codelineno-14-28" name="__codelineno-14-28"></a><span class="nn">---</span>
<a href="#__codelineno-14-29" id="__codelineno-14-29" name="__codelineno-14-29"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-14-30" id="__codelineno-14-30" name="__codelineno-14-30"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a href="#__codelineno-14-31" id="__codelineno-14-31" name="__codelineno-14-31"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-14-32" id="__codelineno-14-32" name="__codelineno-14-32"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent-bit-config</span>
<a href="#__codelineno-14-33" id="__codelineno-14-33" name="__codelineno-14-33"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logging</span>
<a href="#__codelineno-14-34" id="__codelineno-14-34" name="__codelineno-14-34"></a><span class="nt">data</span><span class="p">:</span>
<a href="#__codelineno-14-35" id="__codelineno-14-35" name="__codelineno-14-35"></a><span class="w">  </span><span class="nt">fluent-bit.conf</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a href="#__codelineno-14-36" id="__codelineno-14-36" name="__codelineno-14-36"></a><span class="w">    </span><span class="no">[SERVICE]</span>
<a href="#__codelineno-14-37" id="__codelineno-14-37" name="__codelineno-14-37"></a><span class="w">        </span><span class="no">Flush         5</span>
<a href="#__codelineno-14-38" id="__codelineno-14-38" name="__codelineno-14-38"></a><span class="w">        </span><span class="no">Log_Level     info</span>
<a href="#__codelineno-14-39" id="__codelineno-14-39" name="__codelineno-14-39"></a><span class="w">        </span><span class="no">Daemon        off</span>
<a href="#__codelineno-14-40" id="__codelineno-14-40" name="__codelineno-14-40"></a><span class="w">        </span><span class="no">Parsers_File  parsers.conf</span>
<a href="#__codelineno-14-41" id="__codelineno-14-41" name="__codelineno-14-41"></a>
<a href="#__codelineno-14-42" id="__codelineno-14-42" name="__codelineno-14-42"></a><span class="w">    </span><span class="no">[INPUT]</span>
<a href="#__codelineno-14-43" id="__codelineno-14-43" name="__codelineno-14-43"></a><span class="w">        </span><span class="no">Name              tail</span>
<a href="#__codelineno-14-44" id="__codelineno-14-44" name="__codelineno-14-44"></a><span class="w">        </span><span class="no">Path              /var/log/containers/*.log</span>
<a href="#__codelineno-14-45" id="__codelineno-14-45" name="__codelineno-14-45"></a><span class="w">        </span><span class="no">Parser            docker</span>
<a href="#__codelineno-14-46" id="__codelineno-14-46" name="__codelineno-14-46"></a><span class="w">        </span><span class="no">Tag               kube.*</span>
<a href="#__codelineno-14-47" id="__codelineno-14-47" name="__codelineno-14-47"></a><span class="w">        </span><span class="no">Refresh_Interval  5</span>
<a href="#__codelineno-14-48" id="__codelineno-14-48" name="__codelineno-14-48"></a><span class="w">        </span><span class="no">Mem_Buf_Limit     50MB</span>
<a href="#__codelineno-14-49" id="__codelineno-14-49" name="__codelineno-14-49"></a><span class="w">        </span><span class="no">Skip_Long_Lines   On</span>
<a href="#__codelineno-14-50" id="__codelineno-14-50" name="__codelineno-14-50"></a>
<a href="#__codelineno-14-51" id="__codelineno-14-51" name="__codelineno-14-51"></a><span class="w">    </span><span class="no">[FILTER]</span>
<a href="#__codelineno-14-52" id="__codelineno-14-52" name="__codelineno-14-52"></a><span class="w">        </span><span class="no">Name                kubernetes</span>
<a href="#__codelineno-14-53" id="__codelineno-14-53" name="__codelineno-14-53"></a><span class="w">        </span><span class="no">Match               kube.*</span>
<a href="#__codelineno-14-54" id="__codelineno-14-54" name="__codelineno-14-54"></a><span class="w">        </span><span class="no">Kube_URL            https://kubernetes.default.svc:443</span>
<a href="#__codelineno-14-55" id="__codelineno-14-55" name="__codelineno-14-55"></a><span class="w">        </span><span class="no">Kube_CA_File        /var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>
<a href="#__codelineno-14-56" id="__codelineno-14-56" name="__codelineno-14-56"></a><span class="w">        </span><span class="no">Kube_Token_File     /var/run/secrets/kubernetes.io/serviceaccount/token</span>
<a href="#__codelineno-14-57" id="__codelineno-14-57" name="__codelineno-14-57"></a><span class="w">        </span><span class="no">Kube_Tag_Prefix     kube.var.log.containers.</span>
<a href="#__codelineno-14-58" id="__codelineno-14-58" name="__codelineno-14-58"></a><span class="w">        </span><span class="no">Merge_Log           On</span>
<a href="#__codelineno-14-59" id="__codelineno-14-59" name="__codelineno-14-59"></a><span class="w">        </span><span class="no">Keep_Log            Off</span>
<a href="#__codelineno-14-60" id="__codelineno-14-60" name="__codelineno-14-60"></a><span class="w">        </span><span class="no">K8S-Logging.Parser  On</span>
<a href="#__codelineno-14-61" id="__codelineno-14-61" name="__codelineno-14-61"></a><span class="w">        </span><span class="no">K8S-Logging.Exclude On</span>
<a href="#__codelineno-14-62" id="__codelineno-14-62" name="__codelineno-14-62"></a>
<a href="#__codelineno-14-63" id="__codelineno-14-63" name="__codelineno-14-63"></a><span class="w">    </span><span class="no">[OUTPUT]</span>
<a href="#__codelineno-14-64" id="__codelineno-14-64" name="__codelineno-14-64"></a><span class="w">        </span><span class="no">Name            es</span>
<a href="#__codelineno-14-65" id="__codelineno-14-65" name="__codelineno-14-65"></a><span class="w">        </span><span class="no">Match           *</span>
<a href="#__codelineno-14-66" id="__codelineno-14-66" name="__codelineno-14-66"></a><span class="w">        </span><span class="no">Host            elasticsearch.logging.svc</span>
<a href="#__codelineno-14-67" id="__codelineno-14-67" name="__codelineno-14-67"></a><span class="w">        </span><span class="no">Port            9200</span>
<a href="#__codelineno-14-68" id="__codelineno-14-68" name="__codelineno-14-68"></a><span class="w">        </span><span class="no">Logstash_Format On</span>
<a href="#__codelineno-14-69" id="__codelineno-14-69" name="__codelineno-14-69"></a><span class="w">        </span><span class="no">Logstash_Prefix fluent-bit</span>
<a href="#__codelineno-14-70" id="__codelineno-14-70" name="__codelineno-14-70"></a><span class="w">        </span><span class="no">Type            _doc</span>
<a href="#__codelineno-14-71" id="__codelineno-14-71" name="__codelineno-14-71"></a><span class="w">        </span><span class="no">tls             On</span>
<a href="#__codelineno-14-72" id="__codelineno-14-72" name="__codelineno-14-72"></a><span class="w">        </span><span class="no">tls.verify      Off</span>
<a href="#__codelineno-14-73" id="__codelineno-14-73" name="__codelineno-14-73"></a>
<a href="#__codelineno-14-74" id="__codelineno-14-74" name="__codelineno-14-74"></a><span class="w">  </span><span class="nt">parsers.conf</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a href="#__codelineno-14-75" id="__codelineno-14-75" name="__codelineno-14-75"></a><span class="w">    </span><span class="no">[PARSER]</span>
<a href="#__codelineno-14-76" id="__codelineno-14-76" name="__codelineno-14-76"></a><span class="w">        </span><span class="no">Name   json</span>
<a href="#__codelineno-14-77" id="__codelineno-14-77" name="__codelineno-14-77"></a><span class="w">        </span><span class="no">Format json</span>
<a href="#__codelineno-14-78" id="__codelineno-14-78" name="__codelineno-14-78"></a><span class="w">        </span><span class="no">Time_Key time</span>
<a href="#__codelineno-14-79" id="__codelineno-14-79" name="__codelineno-14-79"></a><span class="w">        </span><span class="no">Time_Format %Y-%m-%dT%H:%M:%S.%L%z</span>
<a href="#__codelineno-14-80" id="__codelineno-14-80" name="__codelineno-14-80"></a>
<a href="#__codelineno-14-81" id="__codelineno-14-81" name="__codelineno-14-81"></a><span class="w">    </span><span class="no">[PARSER]</span>
<a href="#__codelineno-14-82" id="__codelineno-14-82" name="__codelineno-14-82"></a><span class="w">        </span><span class="no">Name        docker</span>
<a href="#__codelineno-14-83" id="__codelineno-14-83" name="__codelineno-14-83"></a><span class="w">        </span><span class="no">Format      json</span>
<a href="#__codelineno-14-84" id="__codelineno-14-84" name="__codelineno-14-84"></a><span class="w">        </span><span class="no">Time_Key    time</span>
<a href="#__codelineno-14-85" id="__codelineno-14-85" name="__codelineno-14-85"></a><span class="w">        </span><span class="no">Time_Format %Y-%m-%dT%H:%M:%S.%L%z</span>
<a href="#__codelineno-14-86" id="__codelineno-14-86" name="__codelineno-14-86"></a><span class="nn">---</span>
<a href="#__codelineno-14-87" id="__codelineno-14-87" name="__codelineno-14-87"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a href="#__codelineno-14-88" id="__codelineno-14-88" name="__codelineno-14-88"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DaemonSet</span>
<a href="#__codelineno-14-89" id="__codelineno-14-89" name="__codelineno-14-89"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-14-90" id="__codelineno-14-90" name="__codelineno-14-90"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent-bit</span>
<a href="#__codelineno-14-91" id="__codelineno-14-91" name="__codelineno-14-91"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logging</span>
<a href="#__codelineno-14-92" id="__codelineno-14-92" name="__codelineno-14-92"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-14-93" id="__codelineno-14-93" name="__codelineno-14-93"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a href="#__codelineno-14-94" id="__codelineno-14-94" name="__codelineno-14-94"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<a href="#__codelineno-14-95" id="__codelineno-14-95" name="__codelineno-14-95"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent-bit</span>
<a href="#__codelineno-14-96" id="__codelineno-14-96" name="__codelineno-14-96"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a href="#__codelineno-14-97" id="__codelineno-14-97" name="__codelineno-14-97"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-14-98" id="__codelineno-14-98" name="__codelineno-14-98"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-14-99" id="__codelineno-14-99" name="__codelineno-14-99"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent-bit</span>
<a href="#__codelineno-14-100" id="__codelineno-14-100" name="__codelineno-14-100"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-14-101" id="__codelineno-14-101" name="__codelineno-14-101"></a><span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent-bit</span>
<a href="#__codelineno-14-102" id="__codelineno-14-102" name="__codelineno-14-102"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-14-103" id="__codelineno-14-103" name="__codelineno-14-103"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent-bit</span>
<a href="#__codelineno-14-104" id="__codelineno-14-104" name="__codelineno-14-104"></a><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent/fluent-bit:2.1</span>
<a href="#__codelineno-14-105" id="__codelineno-14-105" name="__codelineno-14-105"></a><span class="w">        </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-14-106" id="__codelineno-14-106" name="__codelineno-14-106"></a><span class="w">          </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-14-107" id="__codelineno-14-107" name="__codelineno-14-107"></a><span class="w">          </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<a href="#__codelineno-14-108" id="__codelineno-14-108" name="__codelineno-14-108"></a><span class="w">          </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a href="#__codelineno-14-109" id="__codelineno-14-109" name="__codelineno-14-109"></a><span class="w">          </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-14-110" id="__codelineno-14-110" name="__codelineno-14-110"></a><span class="w">          </span><span class="nt">capabilities</span><span class="p">:</span>
<a href="#__codelineno-14-111" id="__codelineno-14-111" name="__codelineno-14-111"></a><span class="w">            </span><span class="nt">drop</span><span class="p">:</span>
<a href="#__codelineno-14-112" id="__codelineno-14-112" name="__codelineno-14-112"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<a href="#__codelineno-14-113" id="__codelineno-14-113" name="__codelineno-14-113"></a><span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<a href="#__codelineno-14-114" id="__codelineno-14-114" name="__codelineno-14-114"></a><span class="w">          </span><span class="nt">limits</span><span class="p">:</span>
<a href="#__codelineno-14-115" id="__codelineno-14-115" name="__codelineno-14-115"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200Mi</span>
<a href="#__codelineno-14-116" id="__codelineno-14-116" name="__codelineno-14-116"></a><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200m</span>
<a href="#__codelineno-14-117" id="__codelineno-14-117" name="__codelineno-14-117"></a><span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<a href="#__codelineno-14-118" id="__codelineno-14-118" name="__codelineno-14-118"></a><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100m</span>
<a href="#__codelineno-14-119" id="__codelineno-14-119" name="__codelineno-14-119"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100Mi</span>
<a href="#__codelineno-14-120" id="__codelineno-14-120" name="__codelineno-14-120"></a><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
<a href="#__codelineno-14-121" id="__codelineno-14-121" name="__codelineno-14-121"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">varlog</span>
<a href="#__codelineno-14-122" id="__codelineno-14-122" name="__codelineno-14-122"></a><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log</span>
<a href="#__codelineno-14-123" id="__codelineno-14-123" name="__codelineno-14-123"></a><span class="w">          </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-14-124" id="__codelineno-14-124" name="__codelineno-14-124"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">varlibdockercontainers</span>
<a href="#__codelineno-14-125" id="__codelineno-14-125" name="__codelineno-14-125"></a><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/containers</span>
<a href="#__codelineno-14-126" id="__codelineno-14-126" name="__codelineno-14-126"></a><span class="w">          </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-14-127" id="__codelineno-14-127" name="__codelineno-14-127"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent-bit-config</span>
<a href="#__codelineno-14-128" id="__codelineno-14-128" name="__codelineno-14-128"></a><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/fluent-bit/etc/</span>
<a href="#__codelineno-14-129" id="__codelineno-14-129" name="__codelineno-14-129"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<a href="#__codelineno-14-130" id="__codelineno-14-130" name="__codelineno-14-130"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">varlog</span>
<a href="#__codelineno-14-131" id="__codelineno-14-131" name="__codelineno-14-131"></a><span class="w">        </span><span class="nt">hostPath</span><span class="p">:</span>
<a href="#__codelineno-14-132" id="__codelineno-14-132" name="__codelineno-14-132"></a><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log</span>
<a href="#__codelineno-14-133" id="__codelineno-14-133" name="__codelineno-14-133"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">varlibdockercontainers</span>
<a href="#__codelineno-14-134" id="__codelineno-14-134" name="__codelineno-14-134"></a><span class="w">        </span><span class="nt">hostPath</span><span class="p">:</span>
<a href="#__codelineno-14-135" id="__codelineno-14-135" name="__codelineno-14-135"></a><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/containers</span>
<a href="#__codelineno-14-136" id="__codelineno-14-136" name="__codelineno-14-136"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent-bit-config</span>
<a href="#__codelineno-14-137" id="__codelineno-14-137" name="__codelineno-14-137"></a><span class="w">        </span><span class="nt">configMap</span><span class="p">:</span>
<a href="#__codelineno-14-138" id="__codelineno-14-138" name="__codelineno-14-138"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent-bit-config</span>
</code></pre></div></p>
<h3 id="43-loki-for-log-storage">4.3 Loki for Log Storage<a class="headerlink" href="#43-loki-for-log-storage" title="Permanent link">¶</a></h3>
<p>Loki is a horizontally-scalable log aggregation system inspired by Prometheus.</p>
<p><strong>Install Loki Stack:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>grafana<span class="w"> </span>https://grafana.github.io/helm-charts
<a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a>helm<span class="w"> </span>install<span class="w"> </span>loki<span class="w"> </span>grafana/loki-stack<span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">  </span>--namespace<span class="w"> </span>logging<span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">  </span>--create-namespace<span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">  </span>--set<span class="w"> </span>promtail.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">  </span>--set<span class="w"> </span>grafana.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">  </span>--set<span class="w"> </span>loki.persistence.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">  </span>--set<span class="w"> </span>loki.persistence.size<span class="o">=</span>50Gi
</code></pre></div></p>
<p><strong>Promtail Configuration (included in loki-stack):</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1"># Scrape configs automatically discovered</span>
<a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="nt">scrape_configs</span><span class="p">:</span>
<a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-pods</span>
<a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">  </span><span class="nt">kubernetes_sd_configs</span><span class="p">:</span>
<a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod</span>
<a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">  </span><span class="nt">pipeline_stages</span><span class="p">:</span>
<a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">docker</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span>
<a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">      </span><span class="nt">selector</span><span class="p">:</span><span class="w"> </span><span class="s">'{app="myapp"}'</span>
<a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">      </span><span class="nt">stages</span><span class="p">:</span>
<a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">json</span><span class="p">:</span>
<a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">          </span><span class="nt">expressions</span><span class="p">:</span>
<a href="#__codelineno-16-13" id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="w">            </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">level</span>
<a href="#__codelineno-16-14" id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="w">            </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">message</span>
<a href="#__codelineno-16-15" id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-16-16" id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="w">          </span><span class="nt">level</span><span class="p">:</span>
<a href="#__codelineno-16-17" id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="w">  </span><span class="nt">relabel_configs</span><span class="p">:</span>
<a href="#__codelineno-16-18" id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__meta_kubernetes_pod_name</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-16-19" id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="w">    </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod</span>
<a href="#__codelineno-16-20" id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__meta_kubernetes_namespace</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-16-21" id="__codelineno-16-21" name="__codelineno-16-21"></a><span class="w">    </span><span class="nt">target_label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namespace</span>
</code></pre></div></p>
<p><strong>Query Loki (LogQL):</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a># All logs from namespace
<a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>{namespace="production"}
<a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a>
<a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a># Filter by log level
<a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a>{namespace="production"} |= "ERROR"
<a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a>
<a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a># JSON parsing
<a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a>{app="api"} | json | level="error"
<a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a>
<a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a># Rate of errors
<a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a>rate({namespace="production"} |= "ERROR" [5m])
<a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a>
<a href="#__codelineno-17-13" id="__codelineno-17-13" name="__codelineno-17-13"></a># Top error messages
<a href="#__codelineno-17-14" id="__codelineno-17-14" name="__codelineno-17-14"></a>topk(10, sum by (message) (rate({namespace="production"} |= "ERROR" [5m])))
</code></pre></div></p>
<h3 id="44-log-security-best-practices">4.4 Log Security Best Practices<a class="headerlink" href="#44-log-security-best-practices" title="Permanent link">¶</a></h3>
<p><strong>Exclude Sensitive Data:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1"># Fluent Bit filter to redact secrets</span>
<a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="p p-Indicator">[</span><span class="nv">FILTER</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">Name    modify</span>
<a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">Match   *</span>
<a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">Add     redacted true</span>
<a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">Condition Key_value_matches log password=.*</span>
<a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">Set     log "password=[REDACTED]"</span>
</code></pre></div></p>
<p><strong>Log Retention Policies:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="c1"># Loki retention configuration</span>
<a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="nt">limits_config</span><span class="p">:</span>
<a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">  </span><span class="nt">retention_period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">744h</span><span class="w">  </span><span class="c1"># 31 days</span>
<a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a>
<a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="c1"># Table manager for retention</span>
<a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="nt">table_manager</span><span class="p">:</span>
<a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="w">  </span><span class="nt">retention_deletes_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="w">  </span><span class="nt">retention_period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">744h</span>
</code></pre></div></p>
<hr/>
<h2 id="5-kubernetes-audit-logging">5. Kubernetes Audit Logging<a class="headerlink" href="#5-kubernetes-audit-logging" title="Permanent link">¶</a></h2>
<h3 id="51-audit-logging-overview">5.1 Audit Logging Overview<a class="headerlink" href="#51-audit-logging-overview" title="Permanent link">¶</a></h3>
<p>Kubernetes audit logs provide a chronological record of API server activities.</p>
<p><strong>Audit Stages:</strong>
1. <strong>RequestReceived</strong> - Audit handler receives request
2. <strong>ResponseStarted</strong> - Response headers sent (long-running requests)
3. <strong>ResponseComplete</strong> - Response body completed
4. <strong>Panic</strong> - Events generated when panic occurs</p>
<p><strong>Audit Levels:</strong>
- <strong>None</strong> - Don't log
- <strong>Metadata</strong> - Log request metadata (user, timestamp, resource, verb)
- <strong>Request</strong> - Log metadata and request body
- <strong>RequestResponse</strong> - Log metadata, request, and response bodies</p>
<h3 id="52-audit-policy-configuration">5.2 Audit Policy Configuration<a class="headerlink" href="#52-audit-policy-configuration" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># /etc/kubernetes/audit-policy.yaml</span>
<a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audit.k8s.io/v1</span>
<a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Policy</span>
<a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="nt">omitStages</span><span class="p">:</span>
<a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"RequestReceived"</span>
<a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a>
<a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="nt">rules</span><span class="p">:</span>
<a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="w">  </span><span class="c1"># Log all requests at RequestResponse level for debugging</span>
<a href="#__codelineno-20-9" id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">  </span><span class="c1"># CAUTION: This generates large volumes of logs</span>
<a href="#__codelineno-20-10" id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RequestResponse</span>
<a href="#__codelineno-20-11" id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<a href="#__codelineno-20-12" id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">""</span>
<a href="#__codelineno-20-13" id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"secrets"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"configmaps"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-20-14" id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="w">    </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"production"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-20-15" id="__codelineno-20-15" name="__codelineno-20-15"></a>
<a href="#__codelineno-20-16" id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="w">  </span><span class="c1"># Log authentication/authorization failures</span>
<a href="#__codelineno-20-17" id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Metadata</span>
<a href="#__codelineno-20-18" id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="w">    </span><span class="nt">omitStages</span><span class="p">:</span>
<a href="#__codelineno-20-19" id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"RequestReceived"</span>
<a href="#__codelineno-20-20" id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"get"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"list"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"watch"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-20-21" id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<a href="#__codelineno-20-22" id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">""</span>
<a href="#__codelineno-20-23" id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"secrets"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"serviceaccounts"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-20-24" id="__codelineno-20-24" name="__codelineno-20-24"></a>
<a href="#__codelineno-20-25" id="__codelineno-20-25" name="__codelineno-20-25"></a><span class="w">  </span><span class="c1"># Log modifications to security resources</span>
<a href="#__codelineno-20-26" id="__codelineno-20-26" name="__codelineno-20-26"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RequestResponse</span>
<a href="#__codelineno-20-27" id="__codelineno-20-27" name="__codelineno-20-27"></a><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"create"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"update"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"patch"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"delete"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-20-28" id="__codelineno-20-28" name="__codelineno-20-28"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<a href="#__codelineno-20-29" id="__codelineno-20-29" name="__codelineno-20-29"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">"rbac.authorization.k8s.io"</span>
<a href="#__codelineno-20-30" id="__codelineno-20-30" name="__codelineno-20-30"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"clusterroles"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"clusterrolebindings"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"roles"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"rolebindings"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-20-31" id="__codelineno-20-31" name="__codelineno-20-31"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">""</span>
<a href="#__codelineno-20-32" id="__codelineno-20-32" name="__codelineno-20-32"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"serviceaccounts"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-20-33" id="__codelineno-20-33" name="__codelineno-20-33"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">"certificates.k8s.io"</span>
<a href="#__codelineno-20-34" id="__codelineno-20-34" name="__codelineno-20-34"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"certificatesigningrequests"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-20-35" id="__codelineno-20-35" name="__codelineno-20-35"></a>
<a href="#__codelineno-20-36" id="__codelineno-20-36" name="__codelineno-20-36"></a><span class="w">  </span><span class="c1"># Log admission webhook decisions</span>
<a href="#__codelineno-20-37" id="__codelineno-20-37" name="__codelineno-20-37"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Metadata</span>
<a href="#__codelineno-20-38" id="__codelineno-20-38" name="__codelineno-20-38"></a><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"create"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"update"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-20-39" id="__codelineno-20-39" name="__codelineno-20-39"></a><span class="w">    </span><span class="nt">omitStages</span><span class="p">:</span>
<a href="#__codelineno-20-40" id="__codelineno-20-40" name="__codelineno-20-40"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"RequestReceived"</span>
<a href="#__codelineno-20-41" id="__codelineno-20-41" name="__codelineno-20-41"></a>
<a href="#__codelineno-20-42" id="__codelineno-20-42" name="__codelineno-20-42"></a><span class="w">  </span><span class="c1"># Log pod exec/attach (potential attacker activity)</span>
<a href="#__codelineno-20-43" id="__codelineno-20-43" name="__codelineno-20-43"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Metadata</span>
<a href="#__codelineno-20-44" id="__codelineno-20-44" name="__codelineno-20-44"></a><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"create"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-20-45" id="__codelineno-20-45" name="__codelineno-20-45"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<a href="#__codelineno-20-46" id="__codelineno-20-46" name="__codelineno-20-46"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">""</span>
<a href="#__codelineno-20-47" id="__codelineno-20-47" name="__codelineno-20-47"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"pods/exec"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"pods/attach"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"pods/portforward"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-20-48" id="__codelineno-20-48" name="__codelineno-20-48"></a>
<a href="#__codelineno-20-49" id="__codelineno-20-49" name="__codelineno-20-49"></a><span class="w">  </span><span class="c1"># Log all deletions</span>
<a href="#__codelineno-20-50" id="__codelineno-20-50" name="__codelineno-20-50"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Request</span>
<a href="#__codelineno-20-51" id="__codelineno-20-51" name="__codelineno-20-51"></a><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"delete"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"deletecollection"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-20-52" id="__codelineno-20-52" name="__codelineno-20-52"></a>
<a href="#__codelineno-20-53" id="__codelineno-20-53" name="__codelineno-20-53"></a><span class="w">  </span><span class="c1"># Catch-all: log metadata for everything else</span>
<a href="#__codelineno-20-54" id="__codelineno-20-54" name="__codelineno-20-54"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Metadata</span>
<a href="#__codelineno-20-55" id="__codelineno-20-55" name="__codelineno-20-55"></a><span class="w">    </span><span class="nt">omitStages</span><span class="p">:</span>
<a href="#__codelineno-20-56" id="__codelineno-20-56" name="__codelineno-20-56"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"RequestReceived"</span>
</code></pre></div>
<h3 id="53-enabling-audit-logging">5.3 Enabling Audit Logging<a class="headerlink" href="#53-enabling-audit-logging" title="Permanent link">¶</a></h3>
<p><strong>Configure API Server:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="c1"># /etc/kubernetes/manifests/kube-apiserver.yaml</span>
<a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span>
<a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-apiserver</span>
<a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--audit-policy-file=/etc/kubernetes/audit-policy.yaml</span>
<a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--audit-log-path=/var/log/kubernetes/audit.log</span>
<a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--audit-log-maxage=30</span>
<a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--audit-log-maxbackup=10</span>
<a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--audit-log-maxsize=100</span>
<a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="w">    </span><span class="c1"># Or use webhook backend</span>
<a href="#__codelineno-21-12" id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--audit-webhook-config-file=/etc/kubernetes/audit-webhook-config.yaml</span>
<a href="#__codelineno-21-13" id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--audit-webhook-batch-max-wait=5s</span>
<a href="#__codelineno-21-14" id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span>
<a href="#__codelineno-21-15" id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audit-policy</span>
<a href="#__codelineno-21-16" id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="w">      </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/audit-policy.yaml</span>
<a href="#__codelineno-21-17" id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="w">      </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-21-18" id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audit-logs</span>
<a href="#__codelineno-21-19" id="__codelineno-21-19" name="__codelineno-21-19"></a><span class="w">      </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/kubernetes</span>
<a href="#__codelineno-21-20" id="__codelineno-21-20" name="__codelineno-21-20"></a><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<a href="#__codelineno-21-21" id="__codelineno-21-21" name="__codelineno-21-21"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audit-policy</span>
<a href="#__codelineno-21-22" id="__codelineno-21-22" name="__codelineno-21-22"></a><span class="w">    </span><span class="nt">hostPath</span><span class="p">:</span>
<a href="#__codelineno-21-23" id="__codelineno-21-23" name="__codelineno-21-23"></a><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/audit-policy.yaml</span>
<a href="#__codelineno-21-24" id="__codelineno-21-24" name="__codelineno-21-24"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">File</span>
<a href="#__codelineno-21-25" id="__codelineno-21-25" name="__codelineno-21-25"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audit-logs</span>
<a href="#__codelineno-21-26" id="__codelineno-21-26" name="__codelineno-21-26"></a><span class="w">    </span><span class="nt">hostPath</span><span class="p">:</span>
<a href="#__codelineno-21-27" id="__codelineno-21-27" name="__codelineno-21-27"></a><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/kubernetes</span>
<a href="#__codelineno-21-28" id="__codelineno-21-28" name="__codelineno-21-28"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DirectoryOrCreate</span>
</code></pre></div></p>
<h3 id="54-audit-webhook-backend">5.4 Audit Webhook Backend<a class="headerlink" href="#54-audit-webhook-backend" title="Permanent link">¶</a></h3>
<p><strong>Webhook Configuration:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1"># /etc/kubernetes/audit-webhook-config.yaml</span>
<a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Config</span>
<a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="nt">clusters</span><span class="p">:</span>
<a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audit-webhook</span>
<a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">  </span><span class="nt">cluster</span><span class="p">:</span>
<a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://audit-collector.logging.svc.cluster.local:8443/audit</span>
<a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">    </span><span class="nt">certificate-authority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/pki/ca.crt</span>
<a href="#__codelineno-22-9" id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="nt">contexts</span><span class="p">:</span>
<a href="#__codelineno-22-10" id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">context</span><span class="p">:</span>
<a href="#__codelineno-22-11" id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">    </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audit-webhook</span>
<a href="#__codelineno-22-12" id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audit-webhook</span>
<a href="#__codelineno-22-13" id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audit-webhook</span>
<a href="#__codelineno-22-14" id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="nt">current-context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audit-webhook</span>
<a href="#__codelineno-22-15" id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="nt">users</span><span class="p">:</span>
<a href="#__codelineno-22-16" id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audit-webhook</span>
<a href="#__codelineno-22-17" id="__codelineno-22-17" name="__codelineno-22-17"></a><span class="w">  </span><span class="nt">user</span><span class="p">:</span>
<a href="#__codelineno-22-18" id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="w">    </span><span class="nt">client-certificate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/pki/audit-webhook-client.crt</span>
<a href="#__codelineno-22-19" id="__codelineno-22-19" name="__codelineno-22-19"></a><span class="w">    </span><span class="nt">client-key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/kubernetes/pki/audit-webhook-client.key</span>
</code></pre></div></p>
<p><strong>Audit Webhook Receiver (example):</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>
<a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a>
<a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a>
<a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/audit'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">'POST'</span><span class="p">])</span>
<a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">receive_audit</span><span class="p">():</span>
<a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a>    <span class="n">audit_event</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>
<a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a>
<a href="#__codelineno-23-11" id="__codelineno-23-11" name="__codelineno-23-11"></a>    <span class="c1"># Extract key information</span>
<a href="#__codelineno-23-12" id="__codelineno-23-12" name="__codelineno-23-12"></a>    <span class="n">kind</span> <span class="o">=</span> <span class="n">audit_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'kind'</span><span class="p">)</span>
<a href="#__codelineno-23-13" id="__codelineno-23-13" name="__codelineno-23-13"></a>    <span class="n">api_version</span> <span class="o">=</span> <span class="n">audit_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'apiVersion'</span><span class="p">)</span>
<a href="#__codelineno-23-14" id="__codelineno-23-14" name="__codelineno-23-14"></a>    <span class="n">level</span> <span class="o">=</span> <span class="n">audit_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'level'</span><span class="p">)</span>
<a href="#__codelineno-23-15" id="__codelineno-23-15" name="__codelineno-23-15"></a>    <span class="n">stage</span> <span class="o">=</span> <span class="n">audit_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'stage'</span><span class="p">)</span>
<a href="#__codelineno-23-16" id="__codelineno-23-16" name="__codelineno-23-16"></a>    <span class="n">verb</span> <span class="o">=</span> <span class="n">audit_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'verb'</span><span class="p">)</span>
<a href="#__codelineno-23-17" id="__codelineno-23-17" name="__codelineno-23-17"></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">audit_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'username'</span><span class="p">)</span>
<a href="#__codelineno-23-18" id="__codelineno-23-18" name="__codelineno-23-18"></a>    <span class="n">resource</span> <span class="o">=</span> <span class="n">audit_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'objectRef'</span><span class="p">,</span> <span class="p">{})</span>
<a href="#__codelineno-23-19" id="__codelineno-23-19" name="__codelineno-23-19"></a>
<a href="#__codelineno-23-20" id="__codelineno-23-20" name="__codelineno-23-20"></a>    <span class="c1"># Log to centralized logging system</span>
<a href="#__codelineno-23-21" id="__codelineno-23-21" name="__codelineno-23-21"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Audit: </span><span class="si">{</span><span class="n">verb</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">resource</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-23-22" id="__codelineno-23-22" name="__codelineno-23-22"></a>
<a href="#__codelineno-23-23" id="__codelineno-23-23" name="__codelineno-23-23"></a>    <span class="c1"># Detect suspicious activity</span>
<a href="#__codelineno-23-24" id="__codelineno-23-24" name="__codelineno-23-24"></a>    <span class="k">if</span> <span class="n">verb</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'delete'</span><span class="p">,</span> <span class="s1">'deletecollection'</span><span class="p">]</span> <span class="ow">and</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'resource'</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'secrets'</span><span class="p">:</span>
<a href="#__codelineno-23-25" id="__codelineno-23-25" name="__codelineno-23-25"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"ALERT: Secret deletion by </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-23-26" id="__codelineno-23-26" name="__codelineno-23-26"></a>
<a href="#__codelineno-23-27" id="__codelineno-23-27" name="__codelineno-23-27"></a>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">"received"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span> <span class="mi">200</span>
<a href="#__codelineno-23-28" id="__codelineno-23-28" name="__codelineno-23-28"></a>
<a href="#__codelineno-23-29" id="__codelineno-23-29" name="__codelineno-23-29"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
<a href="#__codelineno-23-30" id="__codelineno-23-30" name="__codelineno-23-30"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">'0.0.0.0'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8443</span><span class="p">,</span> <span class="n">ssl_context</span><span class="o">=</span><span class="p">(</span><span class="s1">'cert.pem'</span><span class="p">,</span> <span class="s1">'key.pem'</span><span class="p">))</span>
</code></pre></div></p>
<h3 id="55-analyzing-audit-logs">5.5 Analyzing Audit Logs<a class="headerlink" href="#55-analyzing-audit-logs" title="Permanent link">¶</a></h3>
<p><strong>Query Examples:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1"># Failed authentication attempts</span>
<a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a>jq<span class="w"> </span><span class="s1">'select(.responseStatus.code &gt;= 400) | select(.verb == "authenticate")'</span><span class="w"> </span>audit.log
<a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a>
<a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="c1"># Secret access</span>
<a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a>jq<span class="w"> </span><span class="s1">'select(.objectRef.resource == "secrets")'</span><span class="w"> </span>audit.log
<a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a>
<a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="c1"># Admin actions</span>
<a href="#__codelineno-24-8" id="__codelineno-24-8" name="__codelineno-24-8"></a>jq<span class="w"> </span><span class="s1">'select(.user.username | contains("system:admin"))'</span><span class="w"> </span>audit.log
<a href="#__codelineno-24-9" id="__codelineno-24-9" name="__codelineno-24-9"></a>
<a href="#__codelineno-24-10" id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="c1"># Pod exec events</span>
<a href="#__codelineno-24-11" id="__codelineno-24-11" name="__codelineno-24-11"></a>jq<span class="w"> </span><span class="s1">'select(.objectRef.subresource == "exec")'</span><span class="w"> </span>audit.log
<a href="#__codelineno-24-12" id="__codelineno-24-12" name="__codelineno-24-12"></a>
<a href="#__codelineno-24-13" id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="c1"># RBAC changes</span>
<a href="#__codelineno-24-14" id="__codelineno-24-14" name="__codelineno-24-14"></a>jq<span class="w"> </span><span class="s1">'select(.objectRef.apiGroup == "rbac.authorization.k8s.io")'</span><span class="w"> </span>audit.log
</code></pre></div></p>
<hr/>
<h2 id="6-opentelemetry-and-distributed-tracing">6. OpenTelemetry and Distributed Tracing<a class="headerlink" href="#6-opentelemetry-and-distributed-tracing" title="Permanent link">¶</a></h2>
<h3 id="61-opentelemetry-overview">6.1 OpenTelemetry Overview<a class="headerlink" href="#61-opentelemetry-overview" title="Permanent link">¶</a></h3>
<p>OpenTelemetry provides vendor-neutral instrumentation for metrics, logs, and traces.</p>
<p><strong>Components:</strong>
- <strong>SDK</strong> - Instrumentation libraries
- <strong>Collector</strong> - Receive, process, export telemetry
- <strong>Exporter</strong> - Send data to backends (Jaeger, Zipkin, Prometheus)</p>
<h3 id="62-installing-opentelemetry-operator">6.2 Installing OpenTelemetry Operator<a class="headerlink" href="#62-installing-opentelemetry-operator" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1"># Install cert-manager (prerequisite)</span>
<a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/cert-manager/cert-manager/releases/download/v1.13.0/cert-manager.yaml
<a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a>
<a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="c1"># Install OpenTelemetry Operator</span>
<a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/open-telemetry/opentelemetry-operator/releases/latest/download/opentelemetry-operator.yaml
</code></pre></div>
<h3 id="63-opentelemetry-collector-configuration">6.3 OpenTelemetry Collector Configuration<a class="headerlink" href="#63-opentelemetry-collector-configuration" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opentelemetry.io/v1alpha1</span>
<a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenTelemetryCollector</span>
<a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otel-collector</span>
<a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">observability</span>
<a href="#__codelineno-26-6" id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-26-7" id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deployment</span>
<a href="#__codelineno-26-8" id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a href="#__codelineno-26-9" id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="w">    </span><span class="no">receivers:</span>
<a href="#__codelineno-26-10" id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">      </span><span class="no">otlp:</span>
<a href="#__codelineno-26-11" id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="w">        </span><span class="no">protocols:</span>
<a href="#__codelineno-26-12" id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="w">          </span><span class="no">grpc:</span>
<a href="#__codelineno-26-13" id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="w">            </span><span class="no">endpoint: 0.0.0.0:4317</span>
<a href="#__codelineno-26-14" id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="w">          </span><span class="no">http:</span>
<a href="#__codelineno-26-15" id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="w">            </span><span class="no">endpoint: 0.0.0.0:4318</span>
<a href="#__codelineno-26-16" id="__codelineno-26-16" name="__codelineno-26-16"></a>
<a href="#__codelineno-26-17" id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="w">      </span><span class="no"># Prometheus receiver</span>
<a href="#__codelineno-26-18" id="__codelineno-26-18" name="__codelineno-26-18"></a><span class="w">      </span><span class="no">prometheus:</span>
<a href="#__codelineno-26-19" id="__codelineno-26-19" name="__codelineno-26-19"></a><span class="w">        </span><span class="no">config:</span>
<a href="#__codelineno-26-20" id="__codelineno-26-20" name="__codelineno-26-20"></a><span class="w">          </span><span class="no">scrape_configs:</span>
<a href="#__codelineno-26-21" id="__codelineno-26-21" name="__codelineno-26-21"></a><span class="w">          </span><span class="no">- job_name: 'kubernetes-pods'</span>
<a href="#__codelineno-26-22" id="__codelineno-26-22" name="__codelineno-26-22"></a><span class="w">            </span><span class="no">kubernetes_sd_configs:</span>
<a href="#__codelineno-26-23" id="__codelineno-26-23" name="__codelineno-26-23"></a><span class="w">            </span><span class="no">- role: pod</span>
<a href="#__codelineno-26-24" id="__codelineno-26-24" name="__codelineno-26-24"></a>
<a href="#__codelineno-26-25" id="__codelineno-26-25" name="__codelineno-26-25"></a><span class="w">    </span><span class="no">processors:</span>
<a href="#__codelineno-26-26" id="__codelineno-26-26" name="__codelineno-26-26"></a><span class="w">      </span><span class="no">batch:</span>
<a href="#__codelineno-26-27" id="__codelineno-26-27" name="__codelineno-26-27"></a><span class="w">        </span><span class="no">timeout: 10s</span>
<a href="#__codelineno-26-28" id="__codelineno-26-28" name="__codelineno-26-28"></a><span class="w">        </span><span class="no">send_batch_size: 1024</span>
<a href="#__codelineno-26-29" id="__codelineno-26-29" name="__codelineno-26-29"></a>
<a href="#__codelineno-26-30" id="__codelineno-26-30" name="__codelineno-26-30"></a><span class="w">      </span><span class="no"># Add Kubernetes metadata</span>
<a href="#__codelineno-26-31" id="__codelineno-26-31" name="__codelineno-26-31"></a><span class="w">      </span><span class="no">k8sattributes:</span>
<a href="#__codelineno-26-32" id="__codelineno-26-32" name="__codelineno-26-32"></a><span class="w">        </span><span class="no">auth_type: "serviceAccount"</span>
<a href="#__codelineno-26-33" id="__codelineno-26-33" name="__codelineno-26-33"></a><span class="w">        </span><span class="no">passthrough: false</span>
<a href="#__codelineno-26-34" id="__codelineno-26-34" name="__codelineno-26-34"></a><span class="w">        </span><span class="no">extract:</span>
<a href="#__codelineno-26-35" id="__codelineno-26-35" name="__codelineno-26-35"></a><span class="w">          </span><span class="no">metadata:</span>
<a href="#__codelineno-26-36" id="__codelineno-26-36" name="__codelineno-26-36"></a><span class="w">          </span><span class="no">- k8s.pod.name</span>
<a href="#__codelineno-26-37" id="__codelineno-26-37" name="__codelineno-26-37"></a><span class="w">          </span><span class="no">- k8s.pod.uid</span>
<a href="#__codelineno-26-38" id="__codelineno-26-38" name="__codelineno-26-38"></a><span class="w">          </span><span class="no">- k8s.deployment.name</span>
<a href="#__codelineno-26-39" id="__codelineno-26-39" name="__codelineno-26-39"></a><span class="w">          </span><span class="no">- k8s.namespace.name</span>
<a href="#__codelineno-26-40" id="__codelineno-26-40" name="__codelineno-26-40"></a><span class="w">          </span><span class="no">- k8s.node.name</span>
<a href="#__codelineno-26-41" id="__codelineno-26-41" name="__codelineno-26-41"></a>
<a href="#__codelineno-26-42" id="__codelineno-26-42" name="__codelineno-26-42"></a><span class="w">    </span><span class="no">exporters:</span>
<a href="#__codelineno-26-43" id="__codelineno-26-43" name="__codelineno-26-43"></a><span class="w">      </span><span class="no"># Jaeger for traces</span>
<a href="#__codelineno-26-44" id="__codelineno-26-44" name="__codelineno-26-44"></a><span class="w">      </span><span class="no">jaeger:</span>
<a href="#__codelineno-26-45" id="__codelineno-26-45" name="__codelineno-26-45"></a><span class="w">        </span><span class="no">endpoint: jaeger-collector.observability.svc:14250</span>
<a href="#__codelineno-26-46" id="__codelineno-26-46" name="__codelineno-26-46"></a><span class="w">        </span><span class="no">tls:</span>
<a href="#__codelineno-26-47" id="__codelineno-26-47" name="__codelineno-26-47"></a><span class="w">          </span><span class="no">insecure: false</span>
<a href="#__codelineno-26-48" id="__codelineno-26-48" name="__codelineno-26-48"></a>
<a href="#__codelineno-26-49" id="__codelineno-26-49" name="__codelineno-26-49"></a><span class="w">      </span><span class="no"># Prometheus for metrics</span>
<a href="#__codelineno-26-50" id="__codelineno-26-50" name="__codelineno-26-50"></a><span class="w">      </span><span class="no">prometheus:</span>
<a href="#__codelineno-26-51" id="__codelineno-26-51" name="__codelineno-26-51"></a><span class="w">        </span><span class="no">endpoint: 0.0.0.0:8889</span>
<a href="#__codelineno-26-52" id="__codelineno-26-52" name="__codelineno-26-52"></a>
<a href="#__codelineno-26-53" id="__codelineno-26-53" name="__codelineno-26-53"></a><span class="w">      </span><span class="no"># Loki for logs</span>
<a href="#__codelineno-26-54" id="__codelineno-26-54" name="__codelineno-26-54"></a><span class="w">      </span><span class="no">loki:</span>
<a href="#__codelineno-26-55" id="__codelineno-26-55" name="__codelineno-26-55"></a><span class="w">        </span><span class="no">endpoint: http://loki.logging.svc:3100/loki/api/v1/push</span>
<a href="#__codelineno-26-56" id="__codelineno-26-56" name="__codelineno-26-56"></a>
<a href="#__codelineno-26-57" id="__codelineno-26-57" name="__codelineno-26-57"></a><span class="w">    </span><span class="no">service:</span>
<a href="#__codelineno-26-58" id="__codelineno-26-58" name="__codelineno-26-58"></a><span class="w">      </span><span class="no">pipelines:</span>
<a href="#__codelineno-26-59" id="__codelineno-26-59" name="__codelineno-26-59"></a><span class="w">        </span><span class="no">traces:</span>
<a href="#__codelineno-26-60" id="__codelineno-26-60" name="__codelineno-26-60"></a><span class="w">          </span><span class="no">receivers: [otlp]</span>
<a href="#__codelineno-26-61" id="__codelineno-26-61" name="__codelineno-26-61"></a><span class="w">          </span><span class="no">processors: [k8sattributes, batch]</span>
<a href="#__codelineno-26-62" id="__codelineno-26-62" name="__codelineno-26-62"></a><span class="w">          </span><span class="no">exporters: [jaeger]</span>
<a href="#__codelineno-26-63" id="__codelineno-26-63" name="__codelineno-26-63"></a><span class="w">        </span><span class="no">metrics:</span>
<a href="#__codelineno-26-64" id="__codelineno-26-64" name="__codelineno-26-64"></a><span class="w">          </span><span class="no">receivers: [otlp, prometheus]</span>
<a href="#__codelineno-26-65" id="__codelineno-26-65" name="__codelineno-26-65"></a><span class="w">          </span><span class="no">processors: [k8sattributes, batch]</span>
<a href="#__codelineno-26-66" id="__codelineno-26-66" name="__codelineno-26-66"></a><span class="w">          </span><span class="no">exporters: [prometheus]</span>
<a href="#__codelineno-26-67" id="__codelineno-26-67" name="__codelineno-26-67"></a><span class="w">        </span><span class="no">logs:</span>
<a href="#__codelineno-26-68" id="__codelineno-26-68" name="__codelineno-26-68"></a><span class="w">          </span><span class="no">receivers: [otlp]</span>
<a href="#__codelineno-26-69" id="__codelineno-26-69" name="__codelineno-26-69"></a><span class="w">          </span><span class="no">processors: [k8sattributes, batch]</span>
<a href="#__codelineno-26-70" id="__codelineno-26-70" name="__codelineno-26-70"></a><span class="w">          </span><span class="no">exporters: [loki]</span>
</code></pre></div>
<h3 id="64-instrumenting-applications">6.4 Instrumenting Applications<a class="headerlink" href="#64-instrumenting-applications" title="Permanent link">¶</a></h3>
<p><strong>Python Flask Example:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry</span><span class="w"> </span><span class="kn">import</span> <span class="n">trace</span>
<a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.sdk.trace</span><span class="w"> </span><span class="kn">import</span> <span class="n">TracerProvider</span>
<a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.sdk.trace.export</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchSpanProcessor</span>
<a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.exporter.otlp.proto.grpc.trace_exporter</span><span class="w"> </span><span class="kn">import</span> <span class="n">OTLPSpanExporter</span>
<a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.instrumentation.flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">FlaskInstrumentor</span>
<a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span>
<a href="#__codelineno-27-7" id="__codelineno-27-7" name="__codelineno-27-7"></a>
<a href="#__codelineno-27-8" id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="c1"># Initialize tracing</span>
<a href="#__codelineno-27-9" id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="n">trace</span><span class="o">.</span><span class="n">set_tracer_provider</span><span class="p">(</span><span class="n">TracerProvider</span><span class="p">())</span>
<a href="#__codelineno-27-10" id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="n">tracer</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_tracer</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a href="#__codelineno-27-11" id="__codelineno-27-11" name="__codelineno-27-11"></a>
<a href="#__codelineno-27-12" id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="c1"># Configure OTLP exporter</span>
<a href="#__codelineno-27-13" id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="n">otlp_exporter</span> <span class="o">=</span> <span class="n">OTLPSpanExporter</span><span class="p">(</span>
<a href="#__codelineno-27-14" id="__codelineno-27-14" name="__codelineno-27-14"></a>    <span class="n">endpoint</span><span class="o">=</span><span class="s2">"otel-collector.observability.svc:4317"</span><span class="p">,</span>
<a href="#__codelineno-27-15" id="__codelineno-27-15" name="__codelineno-27-15"></a>    <span class="n">insecure</span><span class="o">=</span><span class="kc">True</span>
<a href="#__codelineno-27-16" id="__codelineno-27-16" name="__codelineno-27-16"></a><span class="p">)</span>
<a href="#__codelineno-27-17" id="__codelineno-27-17" name="__codelineno-27-17"></a><span class="n">span_processor</span> <span class="o">=</span> <span class="n">BatchSpanProcessor</span><span class="p">(</span><span class="n">otlp_exporter</span><span class="p">)</span>
<a href="#__codelineno-27-18" id="__codelineno-27-18" name="__codelineno-27-18"></a><span class="n">trace</span><span class="o">.</span><span class="n">get_tracer_provider</span><span class="p">()</span><span class="o">.</span><span class="n">add_span_processor</span><span class="p">(</span><span class="n">span_processor</span><span class="p">)</span>
<a href="#__codelineno-27-19" id="__codelineno-27-19" name="__codelineno-27-19"></a>
<a href="#__codelineno-27-20" id="__codelineno-27-20" name="__codelineno-27-20"></a><span class="c1"># Create Flask app</span>
<a href="#__codelineno-27-21" id="__codelineno-27-21" name="__codelineno-27-21"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a href="#__codelineno-27-22" id="__codelineno-27-22" name="__codelineno-27-22"></a><span class="n">FlaskInstrumentor</span><span class="p">()</span><span class="o">.</span><span class="n">instrument_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a href="#__codelineno-27-23" id="__codelineno-27-23" name="__codelineno-27-23"></a>
<a href="#__codelineno-27-24" id="__codelineno-27-24" name="__codelineno-27-24"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/api/data'</span><span class="p">)</span>
<a href="#__codelineno-27-25" id="__codelineno-27-25" name="__codelineno-27-25"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">():</span>
<a href="#__codelineno-27-26" id="__codelineno-27-26" name="__codelineno-27-26"></a>    <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">"get_data"</span><span class="p">):</span>
<a href="#__codelineno-27-27" id="__codelineno-27-27" name="__codelineno-27-27"></a>        <span class="c1"># Your application logic</span>
<a href="#__codelineno-27-28" id="__codelineno-27-28" name="__codelineno-27-28"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">"status"</span><span class="p">:</span> <span class="s2">"ok"</span><span class="p">}</span>
<a href="#__codelineno-27-29" id="__codelineno-27-29" name="__codelineno-27-29"></a>
<a href="#__codelineno-27-30" id="__codelineno-27-30" name="__codelineno-27-30"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
<a href="#__codelineno-27-31" id="__codelineno-27-31" name="__codelineno-27-31"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">'0.0.0.0'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</code></pre></div></p>
<hr/>
<h2 id="7-security-alerting">7. Security Alerting<a class="headerlink" href="#7-security-alerting" title="Permanent link">¶</a></h2>
<h3 id="71-alertmanager-configuration">7.1 Alertmanager Configuration<a class="headerlink" href="#71-alertmanager-configuration" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alertmanager-config</span>
<a href="#__codelineno-28-5" id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a href="#__codelineno-28-6" id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="nt">data</span><span class="p">:</span>
<a href="#__codelineno-28-7" id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="w">  </span><span class="nt">alertmanager.yml</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a href="#__codelineno-28-8" id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="w">    </span><span class="no">global:</span>
<a href="#__codelineno-28-9" id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="w">      </span><span class="no">resolve_timeout: 5m</span>
<a href="#__codelineno-28-10" id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="w">      </span><span class="no">slack_api_url: 'https://hooks.slack.com/services/YOUR/WEBHOOK/URL'</span>
<a href="#__codelineno-28-11" id="__codelineno-28-11" name="__codelineno-28-11"></a>
<a href="#__codelineno-28-12" id="__codelineno-28-12" name="__codelineno-28-12"></a><span class="w">    </span><span class="no">route:</span>
<a href="#__codelineno-28-13" id="__codelineno-28-13" name="__codelineno-28-13"></a><span class="w">      </span><span class="no">group_by: ['alertname', 'cluster', 'namespace']</span>
<a href="#__codelineno-28-14" id="__codelineno-28-14" name="__codelineno-28-14"></a><span class="w">      </span><span class="no">group_wait: 10s</span>
<a href="#__codelineno-28-15" id="__codelineno-28-15" name="__codelineno-28-15"></a><span class="w">      </span><span class="no">group_interval: 10s</span>
<a href="#__codelineno-28-16" id="__codelineno-28-16" name="__codelineno-28-16"></a><span class="w">      </span><span class="no">repeat_interval: 12h</span>
<a href="#__codelineno-28-17" id="__codelineno-28-17" name="__codelineno-28-17"></a><span class="w">      </span><span class="no">receiver: 'default'</span>
<a href="#__codelineno-28-18" id="__codelineno-28-18" name="__codelineno-28-18"></a><span class="w">      </span><span class="no">routes:</span>
<a href="#__codelineno-28-19" id="__codelineno-28-19" name="__codelineno-28-19"></a><span class="w">      </span><span class="no"># Critical security alerts</span>
<a href="#__codelineno-28-20" id="__codelineno-28-20" name="__codelineno-28-20"></a><span class="w">      </span><span class="no">- match:</span>
<a href="#__codelineno-28-21" id="__codelineno-28-21" name="__codelineno-28-21"></a><span class="w">          </span><span class="no">severity: critical</span>
<a href="#__codelineno-28-22" id="__codelineno-28-22" name="__codelineno-28-22"></a><span class="w">        </span><span class="no">receiver: 'security-team'</span>
<a href="#__codelineno-28-23" id="__codelineno-28-23" name="__codelineno-28-23"></a><span class="w">        </span><span class="no">continue: true</span>
<a href="#__codelineno-28-24" id="__codelineno-28-24" name="__codelineno-28-24"></a>
<a href="#__codelineno-28-25" id="__codelineno-28-25" name="__codelineno-28-25"></a><span class="w">      </span><span class="no"># High priority alerts</span>
<a href="#__codelineno-28-26" id="__codelineno-28-26" name="__codelineno-28-26"></a><span class="w">      </span><span class="no">- match:</span>
<a href="#__codelineno-28-27" id="__codelineno-28-27" name="__codelineno-28-27"></a><span class="w">          </span><span class="no">severity: warning</span>
<a href="#__codelineno-28-28" id="__codelineno-28-28" name="__codelineno-28-28"></a><span class="w">        </span><span class="no">receiver: 'ops-team'</span>
<a href="#__codelineno-28-29" id="__codelineno-28-29" name="__codelineno-28-29"></a>
<a href="#__codelineno-28-30" id="__codelineno-28-30" name="__codelineno-28-30"></a><span class="w">    </span><span class="no">receivers:</span>
<a href="#__codelineno-28-31" id="__codelineno-28-31" name="__codelineno-28-31"></a><span class="w">    </span><span class="no">- name: 'default'</span>
<a href="#__codelineno-28-32" id="__codelineno-28-32" name="__codelineno-28-32"></a><span class="w">      </span><span class="no">slack_configs:</span>
<a href="#__codelineno-28-33" id="__codelineno-28-33" name="__codelineno-28-33"></a><span class="w">      </span><span class="no">- channel: '#alerts'</span>
<a href="#__codelineno-28-34" id="__codelineno-28-34" name="__codelineno-28-34"></a><span class="w">        </span><span class="no">title: 'Kubernetes Alert'</span>
<a href="#__codelineno-28-35" id="__codelineno-28-35" name="__codelineno-28-35"></a><span class="w">        </span><span class="no">text: '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'</span>
<a href="#__codelineno-28-36" id="__codelineno-28-36" name="__codelineno-28-36"></a>
<a href="#__codelineno-28-37" id="__codelineno-28-37" name="__codelineno-28-37"></a><span class="w">    </span><span class="no">- name: 'security-team'</span>
<a href="#__codelineno-28-38" id="__codelineno-28-38" name="__codelineno-28-38"></a><span class="w">      </span><span class="no">slack_configs:</span>
<a href="#__codelineno-28-39" id="__codelineno-28-39" name="__codelineno-28-39"></a><span class="w">      </span><span class="no">- channel: '#security-alerts'</span>
<a href="#__codelineno-28-40" id="__codelineno-28-40" name="__codelineno-28-40"></a><span class="w">        </span><span class="no">title: '🚨 SECURITY ALERT'</span>
<a href="#__codelineno-28-41" id="__codelineno-28-41" name="__codelineno-28-41"></a><span class="w">        </span><span class="no">text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'</span>
<a href="#__codelineno-28-42" id="__codelineno-28-42" name="__codelineno-28-42"></a><span class="w">      </span><span class="no">email_configs:</span>
<a href="#__codelineno-28-43" id="__codelineno-28-43" name="__codelineno-28-43"></a><span class="w">      </span><span class="no">- to: 'security@example.com'</span>
<a href="#__codelineno-28-44" id="__codelineno-28-44" name="__codelineno-28-44"></a><span class="w">        </span><span class="no">from: 'alertmanager@example.com'</span>
<a href="#__codelineno-28-45" id="__codelineno-28-45" name="__codelineno-28-45"></a><span class="w">        </span><span class="no">smarthost: 'smtp.example.com:587'</span>
<a href="#__codelineno-28-46" id="__codelineno-28-46" name="__codelineno-28-46"></a><span class="w">        </span><span class="no">auth_username: 'alertmanager'</span>
<a href="#__codelineno-28-47" id="__codelineno-28-47" name="__codelineno-28-47"></a><span class="w">        </span><span class="no">auth_password: 'password'</span>
<a href="#__codelineno-28-48" id="__codelineno-28-48" name="__codelineno-28-48"></a>
<a href="#__codelineno-28-49" id="__codelineno-28-49" name="__codelineno-28-49"></a><span class="w">    </span><span class="no">- name: 'ops-team'</span>
<a href="#__codelineno-28-50" id="__codelineno-28-50" name="__codelineno-28-50"></a><span class="w">      </span><span class="no">slack_configs:</span>
<a href="#__codelineno-28-51" id="__codelineno-28-51" name="__codelineno-28-51"></a><span class="w">      </span><span class="no">- channel: '#ops-alerts'</span>
</code></pre></div>
<h3 id="72-security-alert-rules">7.2 Security Alert Rules<a class="headerlink" href="#72-security-alert-rules" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring.coreos.com/v1</span>
<a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PrometheusRule</span>
<a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security-alerts</span>
<a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a href="#__codelineno-29-6" id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-29-7" id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="w">  </span><span class="nt">groups</span><span class="p">:</span>
<a href="#__codelineno-29-8" id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-security</span>
<a href="#__codelineno-29-9" id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a href="#__codelineno-29-10" id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<a href="#__codelineno-29-11" id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="w">    </span><span class="c1"># Authentication failures</span>
<a href="#__codelineno-29-12" id="__codelineno-29-12" name="__codelineno-29-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HighAuthenticationFailureRate</span>
<a href="#__codelineno-29-13" id="__codelineno-29-13" name="__codelineno-29-13"></a><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(apiserver_authentication_failure_total[5m]) &gt; 5</span>
<a href="#__codelineno-29-14" id="__codelineno-29-14" name="__codelineno-29-14"></a><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a href="#__codelineno-29-15" id="__codelineno-29-15" name="__codelineno-29-15"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-29-16" id="__codelineno-29-16" name="__codelineno-29-16"></a><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a href="#__codelineno-29-17" id="__codelineno-29-17" name="__codelineno-29-17"></a><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-29-18" id="__codelineno-29-18" name="__codelineno-29-18"></a><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">"High</span><span class="nv"> </span><span class="s">authentication</span><span class="nv"> </span><span class="s">failure</span><span class="nv"> </span><span class="s">rate"</span>
<a href="#__codelineno-29-19" id="__codelineno-29-19" name="__codelineno-29-19"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">"Authentication</span><span class="nv"> </span><span class="s">failure</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">per</span><span class="nv"> </span><span class="s">second"</span>
<a href="#__codelineno-29-20" id="__codelineno-29-20" name="__codelineno-29-20"></a>
<a href="#__codelineno-29-21" id="__codelineno-29-21" name="__codelineno-29-21"></a><span class="w">    </span><span class="c1"># Authorization failures</span>
<a href="#__codelineno-29-22" id="__codelineno-29-22" name="__codelineno-29-22"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HighAuthorizationFailureRate</span>
<a href="#__codelineno-29-23" id="__codelineno-29-23" name="__codelineno-29-23"></a><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(apiserver_authorization_failure_total[5m]) &gt; 10</span>
<a href="#__codelineno-29-24" id="__codelineno-29-24" name="__codelineno-29-24"></a><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a href="#__codelineno-29-25" id="__codelineno-29-25" name="__codelineno-29-25"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-29-26" id="__codelineno-29-26" name="__codelineno-29-26"></a><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a href="#__codelineno-29-27" id="__codelineno-29-27" name="__codelineno-29-27"></a><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-29-28" id="__codelineno-29-28" name="__codelineno-29-28"></a><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">"High</span><span class="nv"> </span><span class="s">authorization</span><span class="nv"> </span><span class="s">failure</span><span class="nv"> </span><span class="s">rate"</span>
<a href="#__codelineno-29-29" id="__codelineno-29-29" name="__codelineno-29-29"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">"Authorization</span><span class="nv"> </span><span class="s">failure</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">per</span><span class="nv"> </span><span class="s">second"</span>
<a href="#__codelineno-29-30" id="__codelineno-29-30" name="__codelineno-29-30"></a>
<a href="#__codelineno-29-31" id="__codelineno-29-31" name="__codelineno-29-31"></a><span class="w">    </span><span class="c1"># Privileged pods</span>
<a href="#__codelineno-29-32" id="__codelineno-29-32" name="__codelineno-29-32"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PrivilegedPodRunning</span>
<a href="#__codelineno-29-33" id="__codelineno-29-33" name="__codelineno-29-33"></a><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">count(kube_pod_container_status_running{container_security_context_privileged="true"}) &gt; 0</span>
<a href="#__codelineno-29-34" id="__codelineno-29-34" name="__codelineno-29-34"></a><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
<a href="#__codelineno-29-35" id="__codelineno-29-35" name="__codelineno-29-35"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-29-36" id="__codelineno-29-36" name="__codelineno-29-36"></a><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a href="#__codelineno-29-37" id="__codelineno-29-37" name="__codelineno-29-37"></a><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-29-38" id="__codelineno-29-38" name="__codelineno-29-38"></a><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">"Privileged</span><span class="nv"> </span><span class="s">pod</span><span class="nv"> </span><span class="s">detected"</span>
<a href="#__codelineno-29-39" id="__codelineno-29-39" name="__codelineno-29-39"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">privileged</span><span class="nv"> </span><span class="s">pods</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">running"</span>
<a href="#__codelineno-29-40" id="__codelineno-29-40" name="__codelineno-29-40"></a>
<a href="#__codelineno-29-41" id="__codelineno-29-41" name="__codelineno-29-41"></a><span class="w">    </span><span class="c1"># Pods running as root</span>
<a href="#__codelineno-29-42" id="__codelineno-29-42" name="__codelineno-29-42"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PodRunningAsRoot</span>
<a href="#__codelineno-29-43" id="__codelineno-29-43" name="__codelineno-29-43"></a><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">count(kube_pod_container_status_running{container_security_context_run_as_user="0"}) &gt; 5</span>
<a href="#__codelineno-29-44" id="__codelineno-29-44" name="__codelineno-29-44"></a><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a href="#__codelineno-29-45" id="__codelineno-29-45" name="__codelineno-29-45"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-29-46" id="__codelineno-29-46" name="__codelineno-29-46"></a><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a href="#__codelineno-29-47" id="__codelineno-29-47" name="__codelineno-29-47"></a><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-29-48" id="__codelineno-29-48" name="__codelineno-29-48"></a><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">"Pods</span><span class="nv"> </span><span class="s">running</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">root</span><span class="nv"> </span><span class="s">detected"</span>
<a href="#__codelineno-29-49" id="__codelineno-29-49" name="__codelineno-29-49"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">pods</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">running</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">root</span><span class="nv"> </span><span class="s">user"</span>
<a href="#__codelineno-29-50" id="__codelineno-29-50" name="__codelineno-29-50"></a>
<a href="#__codelineno-29-51" id="__codelineno-29-51" name="__codelineno-29-51"></a><span class="w">    </span><span class="c1"># Secret access spike</span>
<a href="#__codelineno-29-52" id="__codelineno-29-52" name="__codelineno-29-52"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SecretAccessSpike</span>
<a href="#__codelineno-29-53" id="__codelineno-29-53" name="__codelineno-29-53"></a><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(apiserver_request_total{resource="secrets"}[5m]) &gt; 10</span>
<a href="#__codelineno-29-54" id="__codelineno-29-54" name="__codelineno-29-54"></a><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2m</span>
<a href="#__codelineno-29-55" id="__codelineno-29-55" name="__codelineno-29-55"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-29-56" id="__codelineno-29-56" name="__codelineno-29-56"></a><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a href="#__codelineno-29-57" id="__codelineno-29-57" name="__codelineno-29-57"></a><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-29-58" id="__codelineno-29-58" name="__codelineno-29-58"></a><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">"Unusual</span><span class="nv"> </span><span class="s">secret</span><span class="nv"> </span><span class="s">access</span><span class="nv"> </span><span class="s">detected"</span>
<a href="#__codelineno-29-59" id="__codelineno-29-59" name="__codelineno-29-59"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">"Secret</span><span class="nv"> </span><span class="s">access</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">per</span><span class="nv"> </span><span class="s">second"</span>
<a href="#__codelineno-29-60" id="__codelineno-29-60" name="__codelineno-29-60"></a>
<a href="#__codelineno-29-61" id="__codelineno-29-61" name="__codelineno-29-61"></a><span class="w">    </span><span class="c1"># Pod exec events</span>
<a href="#__codelineno-29-62" id="__codelineno-29-62" name="__codelineno-29-62"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PodExecDetected</span>
<a href="#__codelineno-29-63" id="__codelineno-29-63" name="__codelineno-29-63"></a><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(apiserver_request_total{verb="create", resource="pods", subresource="exec"}[5m]) &gt; 0.1</span>
<a href="#__codelineno-29-64" id="__codelineno-29-64" name="__codelineno-29-64"></a><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
<a href="#__codelineno-29-65" id="__codelineno-29-65" name="__codelineno-29-65"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-29-66" id="__codelineno-29-66" name="__codelineno-29-66"></a><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a href="#__codelineno-29-67" id="__codelineno-29-67" name="__codelineno-29-67"></a><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-29-68" id="__codelineno-29-68" name="__codelineno-29-68"></a><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">"Pod</span><span class="nv"> </span><span class="s">exec</span><span class="nv"> </span><span class="s">activity</span><span class="nv"> </span><span class="s">detected"</span>
<a href="#__codelineno-29-69" id="__codelineno-29-69" name="__codelineno-29-69"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">"Pod</span><span class="nv"> </span><span class="s">exec</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">per</span><span class="nv"> </span><span class="s">second"</span>
<a href="#__codelineno-29-70" id="__codelineno-29-70" name="__codelineno-29-70"></a>
<a href="#__codelineno-29-71" id="__codelineno-29-71" name="__codelineno-29-71"></a><span class="w">    </span><span class="c1"># RBAC modification</span>
<a href="#__codelineno-29-72" id="__codelineno-29-72" name="__codelineno-29-72"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RBACModification</span>
<a href="#__codelineno-29-73" id="__codelineno-29-73" name="__codelineno-29-73"></a><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(apiserver_request_total{verb=~"create|update|patch|delete", resource=~"roles|rolebindings|clusterroles|clusterrolebindings"}[5m]) &gt; 0</span>
<a href="#__codelineno-29-74" id="__codelineno-29-74" name="__codelineno-29-74"></a><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
<a href="#__codelineno-29-75" id="__codelineno-29-75" name="__codelineno-29-75"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-29-76" id="__codelineno-29-76" name="__codelineno-29-76"></a><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a href="#__codelineno-29-77" id="__codelineno-29-77" name="__codelineno-29-77"></a><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-29-78" id="__codelineno-29-78" name="__codelineno-29-78"></a><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">"RBAC</span><span class="nv"> </span><span class="s">modification</span><span class="nv"> </span><span class="s">detected"</span>
<a href="#__codelineno-29-79" id="__codelineno-29-79" name="__codelineno-29-79"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">"RBAC</span><span class="nv"> </span><span class="s">resources</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">being</span><span class="nv"> </span><span class="s">modified"</span>
<a href="#__codelineno-29-80" id="__codelineno-29-80" name="__codelineno-29-80"></a>
<a href="#__codelineno-29-81" id="__codelineno-29-81" name="__codelineno-29-81"></a><span class="w">    </span><span class="c1"># Network policy violations (Cilium)</span>
<a href="#__codelineno-29-82" id="__codelineno-29-82" name="__codelineno-29-82"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicyViolations</span>
<a href="#__codelineno-29-83" id="__codelineno-29-83" name="__codelineno-29-83"></a><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(cilium_policy_drop_total[5m]) &gt; 10</span>
<a href="#__codelineno-29-84" id="__codelineno-29-84" name="__codelineno-29-84"></a><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a href="#__codelineno-29-85" id="__codelineno-29-85" name="__codelineno-29-85"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-29-86" id="__codelineno-29-86" name="__codelineno-29-86"></a><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a href="#__codelineno-29-87" id="__codelineno-29-87" name="__codelineno-29-87"></a><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-29-88" id="__codelineno-29-88" name="__codelineno-29-88"></a><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">"High</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">network</span><span class="nv"> </span><span class="s">policy</span><span class="nv"> </span><span class="s">violations"</span>
<a href="#__codelineno-29-89" id="__codelineno-29-89" name="__codelineno-29-89"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">"Network</span><span class="nv"> </span><span class="s">policy</span><span class="nv"> </span><span class="s">violation</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">per</span><span class="nv"> </span><span class="s">second"</span>
<a href="#__codelineno-29-90" id="__codelineno-29-90" name="__codelineno-29-90"></a>
<a href="#__codelineno-29-91" id="__codelineno-29-91" name="__codelineno-29-91"></a><span class="w">    </span><span class="c1"># Container restart loop</span>
<a href="#__codelineno-29-92" id="__codelineno-29-92" name="__codelineno-29-92"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PodCrashLooping</span>
<a href="#__codelineno-29-93" id="__codelineno-29-93" name="__codelineno-29-93"></a><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(kube_pod_container_status_restarts_total[15m]) &gt; 0.1</span>
<a href="#__codelineno-29-94" id="__codelineno-29-94" name="__codelineno-29-94"></a><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a href="#__codelineno-29-95" id="__codelineno-29-95" name="__codelineno-29-95"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-29-96" id="__codelineno-29-96" name="__codelineno-29-96"></a><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a href="#__codelineno-29-97" id="__codelineno-29-97" name="__codelineno-29-97"></a><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-29-98" id="__codelineno-29-98" name="__codelineno-29-98"></a><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">"Pod</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">crash</span><span class="nv"> </span><span class="s">looping"</span>
<a href="#__codelineno-29-99" id="__codelineno-29-99" name="__codelineno-29-99"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">"Pod</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.namespace</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">$labels.pod</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">restarting</span><span class="nv"> </span><span class="s">frequently"</span>
</code></pre></div>
<h3 id="73-log-based-alerts-loki">7.3 Log-Based Alerts (Loki)<a class="headerlink" href="#73-log-based-alerts-loki" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="c1"># Loki alerting rules</span>
<a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="nt">groups</span><span class="p">:</span>
<a href="#__codelineno-30-3" id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log-alerts</span>
<a href="#__codelineno-30-4" id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="w">  </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
<a href="#__codelineno-30-5" id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<a href="#__codelineno-30-6" id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HighErrorRate</span>
<a href="#__codelineno-30-7" id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a href="#__codelineno-30-8" id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="w">      </span><span class="no">sum(rate({namespace="production"} |= "ERROR" [5m])) by (namespace)</span>
<a href="#__codelineno-30-9" id="__codelineno-30-9" name="__codelineno-30-9"></a><span class="w">      </span><span class="no">&gt; 10</span>
<a href="#__codelineno-30-10" id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="w">    </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a href="#__codelineno-30-11" id="__codelineno-30-11" name="__codelineno-30-11"></a><span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-30-12" id="__codelineno-30-12" name="__codelineno-30-12"></a><span class="w">      </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a href="#__codelineno-30-13" id="__codelineno-30-13" name="__codelineno-30-13"></a><span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-30-14" id="__codelineno-30-14" name="__codelineno-30-14"></a><span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">"High</span><span class="nv"> </span><span class="s">error</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.namespace</span><span class="nv"> </span><span class="s">}}"</span>
<a href="#__codelineno-30-15" id="__codelineno-30-15" name="__codelineno-30-15"></a>
<a href="#__codelineno-30-16" id="__codelineno-30-16" name="__codelineno-30-16"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AuthenticationFailureInLogs</span>
<a href="#__codelineno-30-17" id="__codelineno-30-17" name="__codelineno-30-17"></a><span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a href="#__codelineno-30-18" id="__codelineno-30-18" name="__codelineno-30-18"></a><span class="w">      </span><span class="no">sum(rate({namespace=~".+"} |= "authentication failed" [5m])) &gt; 5</span>
<a href="#__codelineno-30-19" id="__codelineno-30-19" name="__codelineno-30-19"></a><span class="w">    </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2m</span>
<a href="#__codelineno-30-20" id="__codelineno-30-20" name="__codelineno-30-20"></a><span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-30-21" id="__codelineno-30-21" name="__codelineno-30-21"></a><span class="w">      </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a href="#__codelineno-30-22" id="__codelineno-30-22" name="__codelineno-30-22"></a><span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-30-23" id="__codelineno-30-23" name="__codelineno-30-23"></a><span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">"Authentication</span><span class="nv"> </span><span class="s">failures</span><span class="nv"> </span><span class="s">detected</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">logs"</span>
<a href="#__codelineno-30-24" id="__codelineno-30-24" name="__codelineno-30-24"></a>
<a href="#__codelineno-30-25" id="__codelineno-30-25" name="__codelineno-30-25"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PrivilegeEscalationAttempt</span>
<a href="#__codelineno-30-26" id="__codelineno-30-26" name="__codelineno-30-26"></a><span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a href="#__codelineno-30-27" id="__codelineno-30-27" name="__codelineno-30-27"></a><span class="w">      </span><span class="no">count_over_time({namespace=~".+"} |~ "(?i)(privilege escalation|sudo|su root)" [5m]) &gt; 0</span>
<a href="#__codelineno-30-28" id="__codelineno-30-28" name="__codelineno-30-28"></a><span class="w">    </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
<a href="#__codelineno-30-29" id="__codelineno-30-29" name="__codelineno-30-29"></a><span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-30-30" id="__codelineno-30-30" name="__codelineno-30-30"></a><span class="w">      </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a href="#__codelineno-30-31" id="__codelineno-30-31" name="__codelineno-30-31"></a><span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-30-32" id="__codelineno-30-32" name="__codelineno-30-32"></a><span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">"Potential</span><span class="nv"> </span><span class="s">privilege</span><span class="nv"> </span><span class="s">escalation</span><span class="nv"> </span><span class="s">attempt</span><span class="nv"> </span><span class="s">detected"</span>
</code></pre></div>
<hr/>
<h2 id="8-observability-stack-security">8. Observability Stack Security<a class="headerlink" href="#8-observability-stack-security" title="Permanent link">¶</a></h2>
<h3 id="81-securing-prometheus">8.1 Securing Prometheus<a class="headerlink" href="#81-securing-prometheus" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="c1"># Network policy for Prometheus</span>
<a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus-netpol</span>
<a href="#__codelineno-31-6" id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a href="#__codelineno-31-7" id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-31-8" id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
<a href="#__codelineno-31-9" id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<a href="#__codelineno-31-10" id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus</span>
<a href="#__codelineno-31-11" id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="w">  </span><span class="nt">policyTypes</span><span class="p">:</span>
<a href="#__codelineno-31-12" id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<a href="#__codelineno-31-13" id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Egress</span>
<a href="#__codelineno-31-14" id="__codelineno-31-14" name="__codelineno-31-14"></a><span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<a href="#__codelineno-31-15" id="__codelineno-31-15" name="__codelineno-31-15"></a><span class="w">  </span><span class="c1"># Allow Grafana</span>
<a href="#__codelineno-31-16" id="__codelineno-31-16" name="__codelineno-31-16"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<a href="#__codelineno-31-17" id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">podSelector</span><span class="p">:</span>
<a href="#__codelineno-31-18" id="__codelineno-31-18" name="__codelineno-31-18"></a><span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<a href="#__codelineno-31-19" id="__codelineno-31-19" name="__codelineno-31-19"></a><span class="w">          </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
<a href="#__codelineno-31-20" id="__codelineno-31-20" name="__codelineno-31-20"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<a href="#__codelineno-31-21" id="__codelineno-31-21" name="__codelineno-31-21"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<a href="#__codelineno-31-22" id="__codelineno-31-22" name="__codelineno-31-22"></a><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9090</span>
<a href="#__codelineno-31-23" id="__codelineno-31-23" name="__codelineno-31-23"></a><span class="w">  </span><span class="c1"># Allow Alertmanager</span>
<a href="#__codelineno-31-24" id="__codelineno-31-24" name="__codelineno-31-24"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<a href="#__codelineno-31-25" id="__codelineno-31-25" name="__codelineno-31-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">podSelector</span><span class="p">:</span>
<a href="#__codelineno-31-26" id="__codelineno-31-26" name="__codelineno-31-26"></a><span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<a href="#__codelineno-31-27" id="__codelineno-31-27" name="__codelineno-31-27"></a><span class="w">          </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alertmanager</span>
<a href="#__codelineno-31-28" id="__codelineno-31-28" name="__codelineno-31-28"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<a href="#__codelineno-31-29" id="__codelineno-31-29" name="__codelineno-31-29"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<a href="#__codelineno-31-30" id="__codelineno-31-30" name="__codelineno-31-30"></a><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9090</span>
<a href="#__codelineno-31-31" id="__codelineno-31-31" name="__codelineno-31-31"></a><span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<a href="#__codelineno-31-32" id="__codelineno-31-32" name="__codelineno-31-32"></a><span class="w">  </span><span class="c1"># Allow scraping targets</span>
<a href="#__codelineno-31-33" id="__codelineno-31-33" name="__codelineno-31-33"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span>
<a href="#__codelineno-31-34" id="__codelineno-31-34" name="__codelineno-31-34"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaceSelector</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a href="#__codelineno-31-35" id="__codelineno-31-35" name="__codelineno-31-35"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<a href="#__codelineno-31-36" id="__codelineno-31-36" name="__codelineno-31-36"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<a href="#__codelineno-31-37" id="__codelineno-31-37" name="__codelineno-31-37"></a><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<a href="#__codelineno-31-38" id="__codelineno-31-38" name="__codelineno-31-38"></a><span class="w">  </span><span class="c1"># Allow DNS</span>
<a href="#__codelineno-31-39" id="__codelineno-31-39" name="__codelineno-31-39"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span>
<a href="#__codelineno-31-40" id="__codelineno-31-40" name="__codelineno-31-40"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaceSelector</span><span class="p">:</span>
<a href="#__codelineno-31-41" id="__codelineno-31-41" name="__codelineno-31-41"></a><span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<a href="#__codelineno-31-42" id="__codelineno-31-42" name="__codelineno-31-42"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a href="#__codelineno-31-43" id="__codelineno-31-43" name="__codelineno-31-43"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<a href="#__codelineno-31-44" id="__codelineno-31-44" name="__codelineno-31-44"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
<a href="#__codelineno-31-45" id="__codelineno-31-45" name="__codelineno-31-45"></a><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53</span>
</code></pre></div>
<h3 id="82-encryption-at-rest">8.2 Encryption at Rest<a class="headerlink" href="#82-encryption-at-rest" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="c1"># Encrypted storage for Prometheus</span>
<a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<a href="#__codelineno-32-4" id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-32-5" id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus-data</span>
<a href="#__codelineno-32-6" id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<a href="#__codelineno-32-7" id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-32-8" id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<a href="#__codelineno-32-9" id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<a href="#__codelineno-32-10" id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<a href="#__codelineno-32-11" id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<a href="#__codelineno-32-12" id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50Gi</span>
<a href="#__codelineno-32-13" id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">encrypted-ssd</span>
</code></pre></div>
<h3 id="83-access-control">8.3 Access Control<a class="headerlink" href="#83-access-control" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="c1"># RBAC for Prometheus</span>
<a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<a href="#__codelineno-33-4" id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-33-5" id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus</span>
<a href="#__codelineno-33-6" id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="nt">rules</span><span class="p">:</span>
<a href="#__codelineno-33-7" id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">""</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-33-8" id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<a href="#__codelineno-33-9" id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nodes</span>
<a href="#__codelineno-33-10" id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nodes/metrics</span>
<a href="#__codelineno-33-11" id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">services</span>
<a href="#__codelineno-33-12" id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">endpoints</span>
<a href="#__codelineno-33-13" id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pods</span>
<a href="#__codelineno-33-14" id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"get"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"list"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"watch"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-33-15" id="__codelineno-33-15" name="__codelineno-33-15"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">""</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-33-16" id="__codelineno-33-16" name="__codelineno-33-16"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<a href="#__codelineno-33-17" id="__codelineno-33-17" name="__codelineno-33-17"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configmaps</span>
<a href="#__codelineno-33-18" id="__codelineno-33-18" name="__codelineno-33-18"></a><span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"get"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-33-19" id="__codelineno-33-19" name="__codelineno-33-19"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">nonResourceURLs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"/metrics"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-33-20" id="__codelineno-33-20" name="__codelineno-33-20"></a><span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"get"</span><span class="p p-Indicator">]</span>
</code></pre></div>
<hr/>
<h2 id="9-best-practices">9. Best Practices<a class="headerlink" href="#9-best-practices" title="Permanent link">¶</a></h2>
<h3 id="91-observability-checklist">9.1 Observability Checklist<a class="headerlink" href="#91-observability-checklist" title="Permanent link">¶</a></h3>
<ul>
<li>✅ <strong>Metrics Collection</strong></li>
<li>Prometheus deployed with HA configuration</li>
<li>ServiceMonitors for all applications</li>
<li>Security-focused metrics monitored</li>
<li>
<p>Long-term storage (Thanos/Cortex)</p>
</li>
<li>
<p>✅ <strong>Log Aggregation</strong></p>
</li>
<li>Centralized logging (Loki/Elasticsearch)</li>
<li>Container logs collected</li>
<li>Audit logs forwarded</li>
<li>
<p>Log retention policy defined</p>
</li>
<li>
<p>✅ <strong>Distributed Tracing</strong></p>
</li>
<li>OpenTelemetry collector deployed</li>
<li>Critical services instrumented</li>
<li>
<p>Trace sampling configured</p>
</li>
<li>
<p>✅ <strong>Alerting</strong></p>
</li>
<li>Security alerts configured</li>
<li>On-call rotations defined</li>
<li>Runbooks documented</li>
<li>
<p>Alert fatigue minimized</p>
</li>
<li>
<p>✅ <strong>Security</strong></p>
</li>
<li>Observability stack secured</li>
<li>Network policies applied</li>
<li>RBAC configured</li>
<li>Data encrypted</li>
</ul>
<h3 id="92-performance-optimization">9.2 Performance Optimization<a class="headerlink" href="#92-performance-optimization" title="Permanent link">¶</a></h3>
<p><strong>Metric Relabeling:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="c1"># Drop high-cardinality metrics</span>
<a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="nt">metric_relabel_configs</span><span class="p">:</span>
<a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">__name__</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="w">  </span><span class="nt">regex</span><span class="p">:</span><span class="w"> </span><span class="s">'etcd_request_duration_seconds_bucket'</span>
<a href="#__codelineno-34-5" id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">drop</span>
</code></pre></div></p>
<p><strong>Log Sampling:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="c1"># Fluent Bit sampling</span>
<a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="p p-Indicator">[</span><span class="nv">FILTER</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-35-3" id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">Name    sampling</span>
<a href="#__codelineno-35-4" id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">Match   *</span>
<a href="#__codelineno-35-5" id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">Percentage 10</span><span class="w">  </span><span class="c1"># Keep 10% of logs</span>
</code></pre></div></p>
<hr/>
<h2 id="10-security-checklist">10. Security Checklist<a class="headerlink" href="#10-security-checklist" title="Permanent link">¶</a></h2>
<ul>
<li>[ ] <strong>Metrics Monitoring</strong></li>
<li>[ ] Prometheus deployed with security context</li>
<li>[ ] Metrics endpoints secured</li>
<li>[ ] Network policies applied</li>
<li>
<p>[ ] Security-focused dashboards created</p>
</li>
<li>
<p>[ ] <strong>Log Management</strong></p>
</li>
<li>[ ] Centralized logging configured</li>
<li>[ ] Audit logs collected</li>
<li>[ ] Sensitive data redacted</li>
<li>[ ] Retention policies enforced</li>
<li>
<p>[ ] Log access controlled via RBAC</p>
</li>
<li>
<p>[ ] <strong>Security Alerts</strong></p>
</li>
<li>[ ] Authentication failure alerts</li>
<li>[ ] Authorization failure alerts</li>
<li>[ ] Privileged pod alerts</li>
<li>[ ] RBAC modification alerts</li>
<li>[ ] Secret access alerts</li>
<li>
<p>[ ] Pod exec alerts</p>
</li>
<li>
<p>[ ] <strong>Compliance</strong></p>
</li>
<li>[ ] Audit logs retained per policy</li>
<li>[ ] Access logs available</li>
<li>[ ] Security events monitored</li>
<li>[ ] Incident response procedures defined</li>
</ul>
<hr/>
<h2 id="11-references">11. References<a class="headerlink" href="#11-references" title="Permanent link">¶</a></h2>
<h3 id="official-documentation">Official Documentation<a class="headerlink" href="#official-documentation" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Kubernetes Monitoring Architecture</strong></li>
<li>
<p>https://kubernetes.io/docs/tasks/debug/debug-cluster/resource-metrics-pipeline/</p>
</li>
<li>
<p><strong>Kubernetes Audit Logging</strong></p>
</li>
<li>https://kubernetes.io/docs/tasks/debug/debug-cluster/audit/</li>
</ol>
<h3 id="prometheus">Prometheus<a class="headerlink" href="#prometheus" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Prometheus Documentation</strong></li>
<li>
<p>https://prometheus.io/docs/</p>
</li>
<li>
<p><strong>kube-prometheus-stack</strong></p>
</li>
<li>
<p>https://github.com/prometheus-operator/kube-prometheus</p>
</li>
<li>
<p><strong>Prometheus Best Practices</strong></p>
</li>
<li>https://prometheus.io/docs/practices/naming/</li>
</ol>
<h3 id="logging">Logging<a class="headerlink" href="#logging" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Fluent Bit Documentation</strong></li>
<li>
<p>https://docs.fluentbit.io/</p>
</li>
<li>
<p><strong>Grafana Loki</strong></p>
</li>
<li>https://grafana.com/docs/loki/</li>
</ol>
<h3 id="tracing">Tracing<a class="headerlink" href="#tracing" title="Permanent link">¶</a></h3>
<ol>
<li><strong>OpenTelemetry</strong></li>
<li>
<p>https://opentelemetry.io/docs/</p>
</li>
<li>
<p><strong>Jaeger</strong></p>
</li>
<li>https://www.jaegertracing.io/docs/</li>
</ol>
<h3 id="security">Security<a class="headerlink" href="#security" title="Permanent link">¶</a></h3>
<ol>
<li><strong>CNCF Security TAG - Observability</strong><ul>
<li>https://github.com/cncf/tag-security/tree/main/security-whitepaper</li>
</ul>
</li>
</ol>
<hr/>
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">¶</a></h2>
<p>Continue to <strong>Module 09: Supply Chain and Image Security</strong> to learn about securing container images, software supply chain, and CI/CD pipelines.</p>
<hr/>
<p><strong>Module Completion Status:</strong> ✅ Complete</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2025 K8s Security Training Contributors
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/yourusername/k8s-architecture-and-security-training" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
<script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
</body>
</html>