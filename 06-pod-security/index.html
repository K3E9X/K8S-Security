
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Comprehensive training for Kubernetes architecture, operations, and security" name="description"/>
<meta content="K8s Security Training Contributors" name="author"/>
<link href="https://yourusername.github.io/k8s-architecture-and-security-training/06-pod-security/" rel="canonical"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.23" name="generator"/>
<title>Module 06: Pod Security - Kubernetes Architecture and Security Training</title>
<link href="../assets/stylesheets/main.84d31ad4.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#module-06-pod-security">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Kubernetes Architecture and Security Training" class="md-header__button md-logo" data-md-component="logo" href=".." title="Kubernetes Architecture and Security Training">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Kubernetes Architecture and Security Training
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Module 06: Pod Security
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/yourusername/k8s-architecture-and-security-training" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    k8s-architecture-and-security-training
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../README.md">
          
  
  
  Getting Started

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../docs/01-k8s-basics.md">
          
  
  
  Foundation (Weeks 1-2)

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../docs/05-authn-authz.md">
          
  
  
  Security (Weeks 3-4)

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../docs/11-runtime-security.md">
          
  
  
  Advanced (Weeks 5-6)

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../REFERENCES.md">
          
  
  
  Resources

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Kubernetes Architecture and Security Training" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Kubernetes Architecture and Security Training">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Kubernetes Architecture and Security Training
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/yourusername/k8s-architecture-and-security-training" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    k8s-architecture-and-security-training
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Getting Started
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../README.md">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../SUMMARY.md">
<span class="md-ellipsis">
    Course Roadmap
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/00-intro.md">
<span class="md-ellipsis">
    Module 00 - Introduction
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Foundation (Weeks 1-2)
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Foundation (Weeks 1-2)
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/01-k8s-basics.md">
<span class="md-ellipsis">
    Module 01 - Kubernetes Basics
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/02-control-plane.md">
<span class="md-ellipsis">
    Module 02 - Control Plane
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/03-networking.md">
<span class="md-ellipsis">
    Module 03 - Networking
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/04-storage.md">
<span class="md-ellipsis">
    Module 04 - Storage
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Security (Weeks 3-4)
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Security (Weeks 3-4)
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/05-authn-authz.md">
<span class="md-ellipsis">
    Module 05 - Authentication &amp; Authorization
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/06-pod-security.md">
<span class="md-ellipsis">
    Module 06 - Pod Security
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/07-admission-policy.md">
<span class="md-ellipsis">
    Module 07 - Admission &amp; Policy
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/08-observability.md">
<span class="md-ellipsis">
    Module 08 - Observability
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/09-supply-chain.md">
<span class="md-ellipsis">
    Module 09 - Supply Chain Security
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/10-network-security.md">
<span class="md-ellipsis">
    Module 10 - Network Security
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Advanced (Weeks 5-6)
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Advanced (Weeks 5-6)
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/11-runtime-security.md">
<span class="md-ellipsis">
    Module 11 - Runtime Security
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/12-incident-response.md">
<span class="md-ellipsis">
    Module 12 - Incident Response
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/13-cis-compliance.md">
<span class="md-ellipsis">
    Module 13 - CIS &amp; Compliance
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/14-multi-cluster.md">
<span class="md-ellipsis">
    Module 14 - Multi-cluster
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/15-case-studies.md">
<span class="md-ellipsis">
    Module 15 - Case Studies
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Resources
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Resources
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../REFERENCES.md">
<span class="md-ellipsis">
    References
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CONTRIBUTING.md">
<span class="md-ellipsis">
    Contributing
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../WORKFLOW.md">
<span class="md-ellipsis">
    Workflow Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CHANGELOG.md">
<span class="md-ellipsis">
    Changelog
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#learning-objectives">
<span class="md-ellipsis">
      Learning Objectives
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1-pod-security-standards-pss">
<span class="md-ellipsis">
      1. Pod Security Standards (PSS)
    </span>
</a>
<nav aria-label="1. Pod Security Standards (PSS)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11-overview">
<span class="md-ellipsis">
      1.1 Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12-privileged-profile">
<span class="md-ellipsis">
      1.2 Privileged Profile
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#13-baseline-profile">
<span class="md-ellipsis">
      1.3 Baseline Profile
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#14-restricted-profile">
<span class="md-ellipsis">
      1.4 Restricted Profile
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-pod-security-admission-psa">
<span class="md-ellipsis">
      2. Pod Security Admission (PSA)
    </span>
</a>
<nav aria-label="2. Pod Security Admission (PSA)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#21-psa-architecture">
<span class="md-ellipsis">
      2.1 PSA Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#22-psa-modes">
<span class="md-ellipsis">
      2.2 PSA Modes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#23-configuring-psa-at-namespace-level">
<span class="md-ellipsis">
      2.3 Configuring PSA at Namespace Level
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#24-cluster-wide-psa-configuration">
<span class="md-ellipsis">
      2.4 Cluster-Wide PSA Configuration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-security-contexts">
<span class="md-ellipsis">
      3. Security Contexts
    </span>
</a>
<nav aria-label="3. Security Contexts" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#31-pod-level-security-context">
<span class="md-ellipsis">
      3.1 Pod-Level Security Context
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#32-container-level-security-context">
<span class="md-ellipsis">
      3.2 Container-Level Security Context
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#33-linux-capabilities">
<span class="md-ellipsis">
      3.3 Linux Capabilities
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-seccomp-profiles">
<span class="md-ellipsis">
      4. Seccomp Profiles
    </span>
</a>
<nav aria-label="4. Seccomp Profiles" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#41-seccomp-overview">
<span class="md-ellipsis">
      4.1 Seccomp Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#42-runtimedefault-profile">
<span class="md-ellipsis">
      4.2 RuntimeDefault Profile
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#43-custom-seccomp-profiles">
<span class="md-ellipsis">
      4.3 Custom Seccomp Profiles
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#44-generating-seccomp-profiles">
<span class="md-ellipsis">
      4.4 Generating Seccomp Profiles
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-apparmor">
<span class="md-ellipsis">
      5. AppArmor
    </span>
</a>
<nav aria-label="5. AppArmor" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#51-apparmor-overview">
<span class="md-ellipsis">
      5.1 AppArmor Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#52-apparmor-profiles">
<span class="md-ellipsis">
      5.2 AppArmor Profiles
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#53-using-apparmor-in-pods">
<span class="md-ellipsis">
      5.3 Using AppArmor in Pods
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#54-testing-apparmor-enforcement">
<span class="md-ellipsis">
      5.4 Testing AppArmor Enforcement
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-selinux">
<span class="md-ellipsis">
      6. SELinux
    </span>
</a>
<nav aria-label="6. SELinux" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#61-selinux-overview">
<span class="md-ellipsis">
      6.1 SELinux Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#62-container-selinux-types">
<span class="md-ellipsis">
      6.2 Container SELinux Types
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#63-selinux-in-pods">
<span class="md-ellipsis">
      6.3 SELinux in Pods
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#64-selinux-volume-labeling">
<span class="md-ellipsis">
      6.4 SELinux Volume Labeling
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-read-only-root-filesystem">
<span class="md-ellipsis">
      7. Read-Only Root Filesystem
    </span>
</a>
<nav aria-label="7. Read-Only Root Filesystem" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#71-why-read-only-root-filesystems">
<span class="md-ellipsis">
      7.1 Why Read-Only Root Filesystems?
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#72-implementing-read-only-root-filesystem">
<span class="md-ellipsis">
      7.2 Implementing Read-Only Root Filesystem
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#73-application-specific-writable-paths">
<span class="md-ellipsis">
      7.3 Application-Specific Writable Paths
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#74-production-ready-example-with-read-only-root">
<span class="md-ellipsis">
      7.4 Production-Ready Example with Read-Only Root
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-security-best-practices">
<span class="md-ellipsis">
      8. Security Best Practices
    </span>
</a>
<nav aria-label="8. Security Best Practices" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#81-defense-in-depth">
<span class="md-ellipsis">
      8.1 Defense in Depth
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#82-principle-of-least-privilege">
<span class="md-ellipsis">
      8.2 Principle of Least Privilege
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#83-secure-image-practices">
<span class="md-ellipsis">
      8.3 Secure Image Practices
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#84-admission-controllers">
<span class="md-ellipsis">
      8.4 Admission Controllers
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#9-security-anti-patterns">
<span class="md-ellipsis">
      9. Security Anti-Patterns
    </span>
</a>
<nav aria-label="9. Security Anti-Patterns" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#91-common-mistakes">
<span class="md-ellipsis">
      9.1 Common Mistakes
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#10-hands-on-labs">
<span class="md-ellipsis">
      10. Hands-On Labs
    </span>
</a>
<nav aria-label="10. Hands-On Labs" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#lab-1-implementing-pod-security-admission">
<span class="md-ellipsis">
      Lab 1: Implementing Pod Security Admission
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lab-2-seccomp-profile-creation">
<span class="md-ellipsis">
      Lab 2: Seccomp Profile Creation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lab-3-apparmor-profile">
<span class="md-ellipsis">
      Lab 3: AppArmor Profile
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lab-4-complete-secure-deployment">
<span class="md-ellipsis">
      Lab 4: Complete Secure Deployment
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11-security-checklist">
<span class="md-ellipsis">
      11. Security Checklist
    </span>
</a>
<nav aria-label="11. Security Checklist" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pre-deployment-security-audit">
<span class="md-ellipsis">
      Pre-Deployment Security Audit
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12-references">
<span class="md-ellipsis">
      12. References
    </span>
</a>
<nav aria-label="12. References" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#official-documentation">
<span class="md-ellipsis">
      Official Documentation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-frameworks">
<span class="md-ellipsis">
      Security Frameworks
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#linux-security">
<span class="md-ellipsis">
      Linux Security
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tools">
<span class="md-ellipsis">
      Tools
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#next-steps">
<span class="md-ellipsis">
      Next Steps
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="module-06-pod-security">Module 06: Pod Security<a class="headerlink" href="#module-06-pod-security" title="Permanent link">¶</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¶</a></h2>
<p><strong>Estimated Time:</strong> 6-7 hours</p>
<p><strong>Module Type:</strong> Security Deep Dive</p>
<p><strong>Prerequisites:</strong>
- Module 01 - Kubernetes Basics
- Module 02 - Control Plane and Cluster Components
- Module 05 - Authentication and Authorization
- Understanding of Linux security primitives (capabilities, namespaces, cgroups)</p>
<p>Pod security is foundational to Kubernetes cluster hardening. This module covers the Pod Security Standards framework, Pod Security Admission (PSA), security contexts, Linux security modules (seccomp, AppArmor, SELinux), and best practices for creating secure pod configurations. Based on CIS Kubernetes Benchmark and NSA/CISA hardening guidelines, you'll learn to implement defense-in-depth strategies at the pod level.</p>
<hr/>
<h2 id="learning-objectives">Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permanent link">¶</a></h2>
<p>By the end of this module, you will be able to:</p>
<ol>
<li>Understand and implement Pod Security Standards (Privileged, Baseline, Restricted)</li>
<li>Configure Pod Security Admission (PSA) at namespace and cluster levels</li>
<li>Apply security contexts to pods and containers with appropriate restrictions</li>
<li>Implement seccomp profiles for syscall filtering</li>
<li>Configure AppArmor and SELinux for mandatory access control</li>
<li>Design pods with read-only root filesystems</li>
<li>Apply principle of least privilege to container permissions</li>
<li>Identify and remediate common pod security anti-patterns</li>
<li>Perform security audits of pod configurations</li>
<li>Create production-ready secure pod specifications</li>
</ol>
<hr/>
<h2 id="1-pod-security-standards-pss">1. Pod Security Standards (PSS)<a class="headerlink" href="#1-pod-security-standards-pss" title="Permanent link">¶</a></h2>
<h3 id="11-overview">1.1 Overview<a class="headerlink" href="#11-overview" title="Permanent link">¶</a></h3>
<p>Pod Security Standards define three levels of security policies that progressively restrict pod configurations. These standards, introduced in Kubernetes 1.23 (stable in 1.25), replaced Pod Security Policies (PSP).</p>
<p><strong>Three Security Levels:</strong></p>
<ol>
<li><strong>Privileged</strong> - Unrestricted, allows known privilege escalations</li>
<li><strong>Baseline</strong> - Minimally restrictive, prevents known privilege escalations</li>
<li><strong>Restricted</strong> - Heavily restricted, follows pod hardening best practices</li>
</ol>
<h3 id="12-privileged-profile">1.2 Privileged Profile<a class="headerlink" href="#12-privileged-profile" title="Permanent link">¶</a></h3>
<p>The Privileged profile is unrestricted and should only be used for trusted, infrastructure-level workloads.</p>
<p><strong>Characteristics:</strong>
- No restrictions applied
- Allows privileged containers
- Allows host namespace sharing (PID, IPC, Network)
- Allows all capabilities
- Allows host path volumes</p>
<p><strong>Use Cases:</strong>
- CNI plugins
- Storage drivers
- Monitoring agents with host access
- Development/testing environments</p>
<h3 id="13-baseline-profile">1.3 Baseline Profile<a class="headerlink" href="#13-baseline-profile" title="Permanent link">¶</a></h3>
<p>The Baseline profile prevents known privilege escalations while maintaining minimal restrictions for common containerized workloads.</p>
<p><strong>Key Restrictions:</strong></p>
<table>
<thead>
<tr>
<th>Control</th>
<th>Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td>HostProcess</td>
<td>Windows HostProcess containers prohibited</td>
</tr>
<tr>
<td>Host Namespaces</td>
<td>Sharing host PID, IPC, or network namespaces prohibited</td>
</tr>
<tr>
<td>Privileged Containers</td>
<td><code>privileged: true</code> prohibited</td>
</tr>
<tr>
<td>Capabilities</td>
<td>Adding all capabilities prohibited; specific dangerous capabilities dropped</td>
</tr>
<tr>
<td>HostPath Volumes</td>
<td>Prohibited</td>
</tr>
<tr>
<td>Host Ports</td>
<td>Prohibited or restricted to known ranges</td>
</tr>
<tr>
<td>AppArmor</td>
<td>Unconfined profiles prohibited</td>
</tr>
<tr>
<td>SELinux</td>
<td>Custom types or user/role options prohibited</td>
</tr>
<tr>
<td>/proc Mount Type</td>
<td>Default /proc masks required</td>
</tr>
<tr>
<td>Seccomp</td>
<td>Unconfined profile prohibited</td>
</tr>
<tr>
<td>Sysctls</td>
<td>Only safe sysctls allowed</td>
</tr>
</tbody>
</table>
<p><strong>Example Violations:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># VIOLATION: Host network enabled</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span><span class="nt">hostNetwork</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Baseline violation</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:1.0</span>
</code></pre></div></p>
<h3 id="14-restricted-profile">1.4 Restricted Profile<a class="headerlink" href="#14-restricted-profile" title="Permanent link">¶</a></h3>
<p>The Restricted profile implements pod hardening best practices with significant restrictions. All production workloads should target this level.</p>
<p><strong>Additional Restrictions Beyond Baseline:</strong></p>
<table>
<thead>
<tr>
<th>Control</th>
<th>Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td>Volume Types</td>
<td>Restricted to configMap, emptyDir, projected, secret, downwardAPI, persistentVolumeClaim, ephemeral</td>
</tr>
<tr>
<td>Privilege Escalation</td>
<td><code>allowPrivilegeEscalation: false</code> required</td>
</tr>
<tr>
<td>Non-root User</td>
<td><code>runAsNonRoot: true</code> required; containers must not run as UID 0</td>
</tr>
<tr>
<td>Capabilities</td>
<td>Must drop ALL capabilities; may add only NET_BIND_SERVICE</td>
</tr>
<tr>
<td>Seccomp</td>
<td>Must use RuntimeDefault, Localhost, or specific profile</td>
</tr>
</tbody>
</table>
<p><strong>Compliant Example:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted-pod</span>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">  </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">    </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="nt">fsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2000</span>
<a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">    </span><span class="nt">seccompProfile</span><span class="p">:</span>
<a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RuntimeDefault</span>
<a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:1.0</span>
<a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">      </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">      </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">      </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-1-20" id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="w">      </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<a href="#__codelineno-1-21" id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="w">      </span><span class="nt">capabilities</span><span class="p">:</span>
<a href="#__codelineno-1-22" id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">        </span><span class="nt">drop</span><span class="p">:</span>
<a href="#__codelineno-1-23" id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<a href="#__codelineno-1-24" id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span>
<a href="#__codelineno-1-25" id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache</span>
<a href="#__codelineno-1-26" id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="w">      </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/cache</span>
<a href="#__codelineno-1-27" id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmp</span>
<a href="#__codelineno-1-28" id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="w">      </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
<a href="#__codelineno-1-29" id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<a href="#__codelineno-1-30" id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache</span>
<a href="#__codelineno-1-31" id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="w">    </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a href="#__codelineno-1-32" id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmp</span>
<a href="#__codelineno-1-33" id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="w">    </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</code></pre></div></p>
<hr/>
<h2 id="2-pod-security-admission-psa">2. Pod Security Admission (PSA)<a class="headerlink" href="#2-pod-security-admission-psa" title="Permanent link">¶</a></h2>
<h3 id="21-psa-architecture">2.1 PSA Architecture<a class="headerlink" href="#21-psa-architecture" title="Permanent link">¶</a></h3>
<p>Pod Security Admission is a built-in admission controller that enforces Pod Security Standards.</p>
<pre class="mermaid"><code>graph TB
    A[Pod Creation Request] --&gt; B[API Server]
    B --&gt; C{Pod Security&lt;br/&gt;Admission}
    C --&gt; D{Check Namespace&lt;br/&gt;Labels}
    D --&gt; E{Evaluate Against&lt;br/&gt;PSS Level}
    E --&gt;|Enforce: Deny| F[Request Rejected]
    E --&gt;|Audit: Allow + Log| G[Request Allowed&lt;br/&gt;Violation Logged]
    E --&gt;|Warn: Allow + Warn| H[Request Allowed&lt;br/&gt;Warning Returned]
    E --&gt;|Compliant| I[Request Allowed]

    style F fill:#ff6b6b
    style G fill:#ffd93d
    style H fill:#ffd93d
    style I fill:#6bcf7f</code></pre>
<h3 id="22-psa-modes">2.2 PSA Modes<a class="headerlink" href="#22-psa-modes" title="Permanent link">¶</a></h3>
<p>PSA operates in three modes simultaneously per namespace:</p>
<ol>
<li><strong>enforce</strong> - Policy violations cause pod rejection</li>
<li><strong>audit</strong> - Policy violations trigger audit log annotation</li>
<li><strong>warn</strong> - Policy violations return warnings to user</li>
</ol>
<p><strong>Namespace Labels:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># Enforce restricted, audit and warn on baseline</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="nt">pod-security.kubernetes.io/enforce</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="nt">pod-security.kubernetes.io/enforce-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="nt">pod-security.kubernetes.io/audit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">baseline</span>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="nt">pod-security.kubernetes.io/audit-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="nt">pod-security.kubernetes.io/warn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">baseline</span>
<a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="nt">pod-security.kubernetes.io/warn-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
</code></pre></div></p>
<h3 id="23-configuring-psa-at-namespace-level">2.3 Configuring PSA at Namespace Level<a class="headerlink" href="#23-configuring-psa-at-namespace-level" title="Permanent link">¶</a></h3>
<p><strong>Production Namespace (Restricted):</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production-apps</span>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/enforce</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/audit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/warn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/enforce-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.28</span>
</code></pre></div></p>
<p><strong>Apply with kubectl:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># Label existing namespace</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>kubectl<span class="w"> </span>label<span class="w"> </span>namespace<span class="w"> </span>production-apps<span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">  </span>pod-security.kubernetes.io/enforce<span class="o">=</span>restricted<span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">  </span>pod-security.kubernetes.io/audit<span class="o">=</span>restricted<span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">  </span>pod-security.kubernetes.io/warn<span class="o">=</span>restricted
<a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>
<a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="c1"># Verify labels</span>
<a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a>kubectl<span class="w"> </span>get<span class="w"> </span>namespace<span class="w"> </span>production-apps<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>pod-security
</code></pre></div></p>
<p><strong>Development Namespace (Baseline with Warnings):</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev-team-a</span>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/enforce</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">baseline</span>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/audit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/warn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
</code></pre></div></p>
<h3 id="24-cluster-wide-psa-configuration">2.4 Cluster-Wide PSA Configuration<a class="headerlink" href="#24-cluster-wide-psa-configuration" title="Permanent link">¶</a></h3>
<p>Configure default PSA behavior using AdmissionConfiguration:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1"># /etc/kubernetes/admission-config.yaml</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apiserver.config.k8s.io/v1</span>
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AdmissionConfiguration</span>
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="nt">plugins</span><span class="p">:</span>
<a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PodSecurity</span>
<a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">  </span><span class="nt">configuration</span><span class="p">:</span>
<a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-security.admission.config.k8s.io/v1</span>
<a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PodSecurityConfiguration</span>
<a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="nt">defaults</span><span class="p">:</span>
<a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">      </span><span class="nt">enforce</span><span class="p">:</span><span class="w"> </span><span class="s">"baseline"</span>
<a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">      </span><span class="nt">enforce-version</span><span class="p">:</span><span class="w"> </span><span class="s">"latest"</span>
<a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">      </span><span class="nt">audit</span><span class="p">:</span><span class="w"> </span><span class="s">"restricted"</span>
<a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">      </span><span class="nt">audit-version</span><span class="p">:</span><span class="w"> </span><span class="s">"latest"</span>
<a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">      </span><span class="nt">warn</span><span class="p">:</span><span class="w"> </span><span class="s">"restricted"</span>
<a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">      </span><span class="nt">warn-version</span><span class="p">:</span><span class="w"> </span><span class="s">"latest"</span>
<a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">    </span><span class="nt">exemptions</span><span class="p">:</span>
<a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">      </span><span class="nt">usernames</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">      </span><span class="nt">runtimeClasses</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">      </span><span class="nt">namespaces</span><span class="p">:</span>
<a href="#__codelineno-6-20" id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<a href="#__codelineno-6-21" id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-public</span>
<a href="#__codelineno-6-22" id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-node-lease</span>
</code></pre></div>
<p><strong>Enable in API server:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1"># Add to kube-apiserver manifest</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>--admission-control-config-file<span class="o">=</span>/etc/kubernetes/admission-config.yaml
</code></pre></div></p>
<hr/>
<h2 id="3-security-contexts">3. Security Contexts<a class="headerlink" href="#3-security-contexts" title="Permanent link">¶</a></h2>
<h3 id="31-pod-level-security-context">3.1 Pod-Level Security Context<a class="headerlink" href="#31-pod-level-security-context" title="Permanent link">¶</a></h3>
<p>Security contexts define privilege and access control settings for pods and containers.</p>
<p><strong>Pod Security Context Fields:</strong></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security-context-demo</span>
<a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">  </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">    </span><span class="c1"># Run as specific user/group</span>
<a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">    </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="w">    </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
<a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="w">    </span><span class="nt">fsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2000</span>
<a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="w">    </span><span class="nt">fsGroupChangePolicy</span><span class="p">:</span><span class="w"> </span><span class="s">"OnRootMismatch"</span>
<a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a>
<a href="#__codelineno-8-13" id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="w">    </span><span class="c1"># Supplemental groups</span>
<a href="#__codelineno-8-14" id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="w">    </span><span class="nt">supplementalGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">4000</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">5000</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-8-15" id="__codelineno-8-15" name="__codelineno-8-15"></a>
<a href="#__codelineno-8-16" id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="w">    </span><span class="c1"># Require non-root user</span>
<a href="#__codelineno-8-17" id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="w">    </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-8-18" id="__codelineno-8-18" name="__codelineno-8-18"></a>
<a href="#__codelineno-8-19" id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="w">    </span><span class="c1"># Seccomp profile</span>
<a href="#__codelineno-8-20" id="__codelineno-8-20" name="__codelineno-8-20"></a><span class="w">    </span><span class="nt">seccompProfile</span><span class="p">:</span>
<a href="#__codelineno-8-21" id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RuntimeDefault</span>
<a href="#__codelineno-8-22" id="__codelineno-8-22" name="__codelineno-8-22"></a>
<a href="#__codelineno-8-23" id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="w">    </span><span class="c1"># SELinux options</span>
<a href="#__codelineno-8-24" id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="w">    </span><span class="nt">seLinuxOptions</span><span class="p">:</span>
<a href="#__codelineno-8-25" id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="w">      </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="s">"s0:c123,c456"</span>
<a href="#__codelineno-8-26" id="__codelineno-8-26" name="__codelineno-8-26"></a><span class="w">      </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="s">"system_r"</span>
<a href="#__codelineno-8-27" id="__codelineno-8-27" name="__codelineno-8-27"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">"container_t"</span>
<a href="#__codelineno-8-28" id="__codelineno-8-28" name="__codelineno-8-28"></a><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="s">"system_u"</span>
<a href="#__codelineno-8-29" id="__codelineno-8-29" name="__codelineno-8-29"></a>
<a href="#__codelineno-8-30" id="__codelineno-8-30" name="__codelineno-8-30"></a><span class="w">    </span><span class="c1"># Sysctl settings</span>
<a href="#__codelineno-8-31" id="__codelineno-8-31" name="__codelineno-8-31"></a><span class="w">    </span><span class="nt">sysctls</span><span class="p">:</span>
<a href="#__codelineno-8-32" id="__codelineno-8-32" name="__codelineno-8-32"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kernel.shm_rmid_forced</span>
<a href="#__codelineno-8-33" id="__codelineno-8-33" name="__codelineno-8-33"></a><span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"1"</span>
<a href="#__codelineno-8-34" id="__codelineno-8-34" name="__codelineno-8-34"></a>
<a href="#__codelineno-8-35" id="__codelineno-8-35" name="__codelineno-8-35"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-8-36" id="__codelineno-8-36" name="__codelineno-8-36"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-8-37" id="__codelineno-8-37" name="__codelineno-8-37"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.25</span>
</code></pre></div>
<h3 id="32-container-level-security-context">3.2 Container-Level Security Context<a class="headerlink" href="#32-container-level-security-context" title="Permanent link">¶</a></h3>
<p>Container-level settings override pod-level settings:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container-security-context</span>
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">  </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">    </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">    </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a>
<a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.25</span>
<a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-9-14" id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="w">      </span><span class="c1"># Container-specific overrides</span>
<a href="#__codelineno-9-15" id="__codelineno-9-15" name="__codelineno-9-15"></a><span class="w">      </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2000</span><span class="w">  </span><span class="c1"># Overrides pod runAsUser</span>
<a href="#__codelineno-9-16" id="__codelineno-9-16" name="__codelineno-9-16"></a><span class="w">      </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a href="#__codelineno-9-17" id="__codelineno-9-17" name="__codelineno-9-17"></a><span class="w">      </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-9-18" id="__codelineno-9-18" name="__codelineno-9-18"></a>
<a href="#__codelineno-9-19" id="__codelineno-9-19" name="__codelineno-9-19"></a><span class="w">      </span><span class="c1"># Linux capabilities</span>
<a href="#__codelineno-9-20" id="__codelineno-9-20" name="__codelineno-9-20"></a><span class="w">      </span><span class="nt">capabilities</span><span class="p">:</span>
<a href="#__codelineno-9-21" id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="w">        </span><span class="nt">drop</span><span class="p">:</span>
<a href="#__codelineno-9-22" id="__codelineno-9-22" name="__codelineno-9-22"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<a href="#__codelineno-9-23" id="__codelineno-9-23" name="__codelineno-9-23"></a><span class="w">        </span><span class="nt">add</span><span class="p">:</span>
<a href="#__codelineno-9-24" id="__codelineno-9-24" name="__codelineno-9-24"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NET_BIND_SERVICE</span>
<a href="#__codelineno-9-25" id="__codelineno-9-25" name="__codelineno-9-25"></a>
<a href="#__codelineno-9-26" id="__codelineno-9-26" name="__codelineno-9-26"></a><span class="w">      </span><span class="c1"># Seccomp (container-level)</span>
<a href="#__codelineno-9-27" id="__codelineno-9-27" name="__codelineno-9-27"></a><span class="w">      </span><span class="nt">seccompProfile</span><span class="p">:</span>
<a href="#__codelineno-9-28" id="__codelineno-9-28" name="__codelineno-9-28"></a><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Localhost</span>
<a href="#__codelineno-9-29" id="__codelineno-9-29" name="__codelineno-9-29"></a><span class="w">        </span><span class="nt">localhostProfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">profiles/audit.json</span>
<a href="#__codelineno-9-30" id="__codelineno-9-30" name="__codelineno-9-30"></a>
<a href="#__codelineno-9-31" id="__codelineno-9-31" name="__codelineno-9-31"></a><span class="w">      </span><span class="c1"># Privileged mode (avoid in production)</span>
<a href="#__codelineno-9-32" id="__codelineno-9-32" name="__codelineno-9-32"></a><span class="w">      </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a href="#__codelineno-9-33" id="__codelineno-9-33" name="__codelineno-9-33"></a>
<a href="#__codelineno-9-34" id="__codelineno-9-34" name="__codelineno-9-34"></a><span class="w">      </span><span class="c1"># Process namespace sharing</span>
<a href="#__codelineno-9-35" id="__codelineno-9-35" name="__codelineno-9-35"></a><span class="w">      </span><span class="nt">shareProcessNamespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a href="#__codelineno-9-36" id="__codelineno-9-36" name="__codelineno-9-36"></a>
<a href="#__codelineno-9-37" id="__codelineno-9-37" name="__codelineno-9-37"></a><span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span>
<a href="#__codelineno-9-38" id="__codelineno-9-38" name="__codelineno-9-38"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache</span>
<a href="#__codelineno-9-39" id="__codelineno-9-39" name="__codelineno-9-39"></a><span class="w">      </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/cache/nginx</span>
<a href="#__codelineno-9-40" id="__codelineno-9-40" name="__codelineno-9-40"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">run</span>
<a href="#__codelineno-9-41" id="__codelineno-9-41" name="__codelineno-9-41"></a><span class="w">      </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run</span>
<a href="#__codelineno-9-42" id="__codelineno-9-42" name="__codelineno-9-42"></a>
<a href="#__codelineno-9-43" id="__codelineno-9-43" name="__codelineno-9-43"></a><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<a href="#__codelineno-9-44" id="__codelineno-9-44" name="__codelineno-9-44"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache</span>
<a href="#__codelineno-9-45" id="__codelineno-9-45" name="__codelineno-9-45"></a><span class="w">    </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a href="#__codelineno-9-46" id="__codelineno-9-46" name="__codelineno-9-46"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">run</span>
<a href="#__codelineno-9-47" id="__codelineno-9-47" name="__codelineno-9-47"></a><span class="w">    </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</code></pre></div>
<h3 id="33-linux-capabilities">3.3 Linux Capabilities<a class="headerlink" href="#33-linux-capabilities" title="Permanent link">¶</a></h3>
<p>Capabilities divide root privileges into distinct units that can be independently enabled or disabled.</p>
<p><strong>Common Capabilities:</strong></p>
<table>
<thead>
<tr>
<th>Capability</th>
<th>Description</th>
<th>Risk Level</th>
</tr>
</thead>
<tbody>
<tr>
<td>CAP_SYS_ADMIN</td>
<td>Administrative operations</td>
<td>Critical</td>
</tr>
<tr>
<td>CAP_NET_ADMIN</td>
<td>Network administration</td>
<td>High</td>
</tr>
<tr>
<td>CAP_SYS_PTRACE</td>
<td>Trace arbitrary processes</td>
<td>High</td>
</tr>
<tr>
<td>CAP_SYS_MODULE</td>
<td>Load/unload kernel modules</td>
<td>Critical</td>
</tr>
<tr>
<td>CAP_DAC_OVERRIDE</td>
<td>Bypass file permissions</td>
<td>High</td>
</tr>
<tr>
<td>CAP_NET_BIND_SERVICE</td>
<td>Bind to ports &lt; 1024</td>
<td>Low</td>
</tr>
<tr>
<td>CAP_CHOWN</td>
<td>Change file ownership</td>
<td>Medium</td>
</tr>
<tr>
<td>CAP_SETUID</td>
<td>Set user ID</td>
<td>High</td>
</tr>
<tr>
<td>CAP_SETGID</td>
<td>Set group ID</td>
<td>High</td>
</tr>
</tbody>
</table>
<p><strong>Secure Capability Configuration:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">capability-demo</span>
<a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.25</span>
<a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-10-10" id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">      </span><span class="nt">capabilities</span><span class="p">:</span>
<a href="#__codelineno-10-11" id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w">        </span><span class="nt">drop</span><span class="p">:</span>
<a href="#__codelineno-10-12" id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span><span class="w">  </span><span class="c1"># Drop all capabilities first</span>
<a href="#__codelineno-10-13" id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">        </span><span class="nt">add</span><span class="p">:</span>
<a href="#__codelineno-10-14" id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NET_BIND_SERVICE</span><span class="w">  </span><span class="c1"># Add only what's needed</span>
<a href="#__codelineno-10-15" id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<a href="#__codelineno-10-16" id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div></p>
<p><strong>Check Container Capabilities:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1"># Install libcap2-bin in container</span>
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>libcap2-bin
<a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a>
<a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="c1"># View effective capabilities</span>
<a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a>capsh<span class="w"> </span>--print
<a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a>
<a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="c1"># View capability bounding set</span>
<a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a>cat<span class="w"> </span>/proc/1/status<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Cap
</code></pre></div></p>
<hr/>
<h2 id="4-seccomp-profiles">4. Seccomp Profiles<a class="headerlink" href="#4-seccomp-profiles" title="Permanent link">¶</a></h2>
<h3 id="41-seccomp-overview">4.1 Seccomp Overview<a class="headerlink" href="#41-seccomp-overview" title="Permanent link">¶</a></h3>
<p>Secure Computing Mode (seccomp) is a Linux kernel feature that filters system calls, reducing the kernel attack surface.</p>
<p><strong>Seccomp Profile Types:</strong></p>
<ol>
<li><strong>RuntimeDefault</strong> - Container runtime's default profile (recommended)</li>
<li><strong>Localhost</strong> - Custom profile loaded from node filesystem</li>
<li><strong>Unconfined</strong> - No filtering (insecure, avoid in production)</li>
</ol>
<h3 id="42-runtimedefault-profile">4.2 RuntimeDefault Profile<a class="headerlink" href="#42-runtimedefault-profile" title="Permanent link">¶</a></h3>
<p>The simplest and recommended approach for most workloads:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">seccomp-runtime-default</span>
<a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">  </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">    </span><span class="nt">seccompProfile</span><span class="p">:</span>
<a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RuntimeDefault</span>
<a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-12-10" id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-12-11" id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:1.0</span>
</code></pre></div>
<h3 id="43-custom-seccomp-profiles">4.3 Custom Seccomp Profiles<a class="headerlink" href="#43-custom-seccomp-profiles" title="Permanent link">¶</a></h3>
<p><strong>Profile Location:</strong>
Seccomp profiles must be placed on each node at <code>/var/lib/kubelet/seccomp/</code>.</p>
<p><strong>Example Custom Profile (audit.json):</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="p">{</span>
<a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">  </span><span class="nt">"defaultAction"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SCMP_ACT_LOG"</span><span class="p">,</span>
<a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">  </span><span class="nt">"architectures"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="s2">"SCMP_ARCH_X86_64"</span><span class="p">,</span>
<a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">    </span><span class="s2">"SCMP_ARCH_X86"</span><span class="p">,</span>
<a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">    </span><span class="s2">"SCMP_ARCH_X32"</span>
<a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">  </span><span class="p">],</span>
<a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">  </span><span class="nt">"syscalls"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">    </span><span class="p">{</span>
<a href="#__codelineno-13-10" id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="w">      </span><span class="nt">"names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-13-11" id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="w">        </span><span class="s2">"accept"</span><span class="p">,</span>
<a href="#__codelineno-13-12" id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="w">        </span><span class="s2">"accept4"</span><span class="p">,</span>
<a href="#__codelineno-13-13" id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="w">        </span><span class="s2">"access"</span><span class="p">,</span>
<a href="#__codelineno-13-14" id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="w">        </span><span class="s2">"arch_prctl"</span><span class="p">,</span>
<a href="#__codelineno-13-15" id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="w">        </span><span class="s2">"bind"</span><span class="p">,</span>
<a href="#__codelineno-13-16" id="__codelineno-13-16" name="__codelineno-13-16"></a><span class="w">        </span><span class="s2">"brk"</span><span class="p">,</span>
<a href="#__codelineno-13-17" id="__codelineno-13-17" name="__codelineno-13-17"></a><span class="w">        </span><span class="s2">"chmod"</span><span class="p">,</span>
<a href="#__codelineno-13-18" id="__codelineno-13-18" name="__codelineno-13-18"></a><span class="w">        </span><span class="s2">"chown"</span><span class="p">,</span>
<a href="#__codelineno-13-19" id="__codelineno-13-19" name="__codelineno-13-19"></a><span class="w">        </span><span class="s2">"clone"</span><span class="p">,</span>
<a href="#__codelineno-13-20" id="__codelineno-13-20" name="__codelineno-13-20"></a><span class="w">        </span><span class="s2">"close"</span><span class="p">,</span>
<a href="#__codelineno-13-21" id="__codelineno-13-21" name="__codelineno-13-21"></a><span class="w">        </span><span class="s2">"connect"</span><span class="p">,</span>
<a href="#__codelineno-13-22" id="__codelineno-13-22" name="__codelineno-13-22"></a><span class="w">        </span><span class="s2">"dup"</span><span class="p">,</span>
<a href="#__codelineno-13-23" id="__codelineno-13-23" name="__codelineno-13-23"></a><span class="w">        </span><span class="s2">"dup2"</span><span class="p">,</span>
<a href="#__codelineno-13-24" id="__codelineno-13-24" name="__codelineno-13-24"></a><span class="w">        </span><span class="s2">"epoll_create"</span><span class="p">,</span>
<a href="#__codelineno-13-25" id="__codelineno-13-25" name="__codelineno-13-25"></a><span class="w">        </span><span class="s2">"epoll_ctl"</span><span class="p">,</span>
<a href="#__codelineno-13-26" id="__codelineno-13-26" name="__codelineno-13-26"></a><span class="w">        </span><span class="s2">"epoll_wait"</span><span class="p">,</span>
<a href="#__codelineno-13-27" id="__codelineno-13-27" name="__codelineno-13-27"></a><span class="w">        </span><span class="s2">"exit"</span><span class="p">,</span>
<a href="#__codelineno-13-28" id="__codelineno-13-28" name="__codelineno-13-28"></a><span class="w">        </span><span class="s2">"exit_group"</span><span class="p">,</span>
<a href="#__codelineno-13-29" id="__codelineno-13-29" name="__codelineno-13-29"></a><span class="w">        </span><span class="s2">"fcntl"</span><span class="p">,</span>
<a href="#__codelineno-13-30" id="__codelineno-13-30" name="__codelineno-13-30"></a><span class="w">        </span><span class="s2">"fstat"</span><span class="p">,</span>
<a href="#__codelineno-13-31" id="__codelineno-13-31" name="__codelineno-13-31"></a><span class="w">        </span><span class="s2">"futex"</span><span class="p">,</span>
<a href="#__codelineno-13-32" id="__codelineno-13-32" name="__codelineno-13-32"></a><span class="w">        </span><span class="s2">"getcwd"</span><span class="p">,</span>
<a href="#__codelineno-13-33" id="__codelineno-13-33" name="__codelineno-13-33"></a><span class="w">        </span><span class="s2">"getdents"</span><span class="p">,</span>
<a href="#__codelineno-13-34" id="__codelineno-13-34" name="__codelineno-13-34"></a><span class="w">        </span><span class="s2">"getpid"</span><span class="p">,</span>
<a href="#__codelineno-13-35" id="__codelineno-13-35" name="__codelineno-13-35"></a><span class="w">        </span><span class="s2">"getppid"</span><span class="p">,</span>
<a href="#__codelineno-13-36" id="__codelineno-13-36" name="__codelineno-13-36"></a><span class="w">        </span><span class="s2">"getuid"</span><span class="p">,</span>
<a href="#__codelineno-13-37" id="__codelineno-13-37" name="__codelineno-13-37"></a><span class="w">        </span><span class="s2">"listen"</span><span class="p">,</span>
<a href="#__codelineno-13-38" id="__codelineno-13-38" name="__codelineno-13-38"></a><span class="w">        </span><span class="s2">"mmap"</span><span class="p">,</span>
<a href="#__codelineno-13-39" id="__codelineno-13-39" name="__codelineno-13-39"></a><span class="w">        </span><span class="s2">"open"</span><span class="p">,</span>
<a href="#__codelineno-13-40" id="__codelineno-13-40" name="__codelineno-13-40"></a><span class="w">        </span><span class="s2">"openat"</span><span class="p">,</span>
<a href="#__codelineno-13-41" id="__codelineno-13-41" name="__codelineno-13-41"></a><span class="w">        </span><span class="s2">"read"</span><span class="p">,</span>
<a href="#__codelineno-13-42" id="__codelineno-13-42" name="__codelineno-13-42"></a><span class="w">        </span><span class="s2">"readlink"</span><span class="p">,</span>
<a href="#__codelineno-13-43" id="__codelineno-13-43" name="__codelineno-13-43"></a><span class="w">        </span><span class="s2">"rt_sigaction"</span><span class="p">,</span>
<a href="#__codelineno-13-44" id="__codelineno-13-44" name="__codelineno-13-44"></a><span class="w">        </span><span class="s2">"rt_sigprocmask"</span><span class="p">,</span>
<a href="#__codelineno-13-45" id="__codelineno-13-45" name="__codelineno-13-45"></a><span class="w">        </span><span class="s2">"rt_sigreturn"</span><span class="p">,</span>
<a href="#__codelineno-13-46" id="__codelineno-13-46" name="__codelineno-13-46"></a><span class="w">        </span><span class="s2">"select"</span><span class="p">,</span>
<a href="#__codelineno-13-47" id="__codelineno-13-47" name="__codelineno-13-47"></a><span class="w">        </span><span class="s2">"set_robust_list"</span><span class="p">,</span>
<a href="#__codelineno-13-48" id="__codelineno-13-48" name="__codelineno-13-48"></a><span class="w">        </span><span class="s2">"set_tid_address"</span><span class="p">,</span>
<a href="#__codelineno-13-49" id="__codelineno-13-49" name="__codelineno-13-49"></a><span class="w">        </span><span class="s2">"socket"</span><span class="p">,</span>
<a href="#__codelineno-13-50" id="__codelineno-13-50" name="__codelineno-13-50"></a><span class="w">        </span><span class="s2">"stat"</span><span class="p">,</span>
<a href="#__codelineno-13-51" id="__codelineno-13-51" name="__codelineno-13-51"></a><span class="w">        </span><span class="s2">"wait4"</span><span class="p">,</span>
<a href="#__codelineno-13-52" id="__codelineno-13-52" name="__codelineno-13-52"></a><span class="w">        </span><span class="s2">"write"</span>
<a href="#__codelineno-13-53" id="__codelineno-13-53" name="__codelineno-13-53"></a><span class="w">      </span><span class="p">],</span>
<a href="#__codelineno-13-54" id="__codelineno-13-54" name="__codelineno-13-54"></a><span class="w">      </span><span class="nt">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SCMP_ACT_ALLOW"</span>
<a href="#__codelineno-13-55" id="__codelineno-13-55" name="__codelineno-13-55"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-13-56" id="__codelineno-13-56" name="__codelineno-13-56"></a><span class="w">  </span><span class="p">]</span>
<a href="#__codelineno-13-57" id="__codelineno-13-57" name="__codelineno-13-57"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>Restrictive Profile (deny-write.json):</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="p">{</span>
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">  </span><span class="nt">"defaultAction"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SCMP_ACT_ALLOW"</span><span class="p">,</span>
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">  </span><span class="nt">"syscalls"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">    </span><span class="p">{</span>
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">      </span><span class="nt">"names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">        </span><span class="s2">"write"</span><span class="p">,</span>
<a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">        </span><span class="s2">"writev"</span><span class="p">,</span>
<a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">        </span><span class="s2">"pwrite64"</span><span class="p">,</span>
<a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">        </span><span class="s2">"pwritev"</span><span class="p">,</span>
<a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">        </span><span class="s2">"pwritev2"</span>
<a href="#__codelineno-14-11" id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">      </span><span class="p">],</span>
<a href="#__codelineno-14-12" id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="w">      </span><span class="nt">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SCMP_ACT_ERRNO"</span>
<a href="#__codelineno-14-13" id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-14-14" id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="w">  </span><span class="p">]</span>
<a href="#__codelineno-14-15" id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>Using Localhost Profile:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">seccomp-localhost</span>
<a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">  </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">    </span><span class="nt">seccompProfile</span><span class="p">:</span>
<a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Localhost</span>
<a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">      </span><span class="nt">localhostProfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">profiles/audit.json</span>
<a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:1.0</span>
</code></pre></div></p>
<p><strong>Deploy Profile to Nodes:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1"># Copy profile to all nodes</span>
<a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="k">for</span><span class="w"> </span>node<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>-o<span class="w"> </span>name<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d/<span class="w"> </span>-f2<span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">  </span>scp<span class="w"> </span>profiles/audit.json<span class="w"> </span><span class="nv">$node</span>:/var/lib/kubelet/seccomp/profiles/
<a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="k">done</span>
<a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a>
<a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="c1"># Verify profile</span>
<a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a>ssh<span class="w"> </span>node01<span class="w"> </span>ls<span class="w"> </span>-la<span class="w"> </span>/var/lib/kubelet/seccomp/profiles/
</code></pre></div></p>
<h3 id="44-generating-seccomp-profiles">4.4 Generating Seccomp Profiles<a class="headerlink" href="#44-generating-seccomp-profiles" title="Permanent link">¶</a></h3>
<p>Use OCI seccomp profile generator or record syscalls:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1"># Install seccomp-bpf</span>
<a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>linux-tools-common<span class="w"> </span>linux-tools-<span class="k">$(</span>uname<span class="w"> </span>-r<span class="k">)</span>
<a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a>
<a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="c1"># Trace syscalls (strace)</span>
<a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>pod-name<span class="w"> </span>--<span class="w"> </span>strace<span class="w"> </span>-c<span class="w"> </span>-f<span class="w"> </span>-e<span class="w"> </span><span class="nv">trace</span><span class="o">=</span>all<span class="w"> </span>sleep<span class="w"> </span><span class="m">10</span>
<a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a>
<a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="c1"># Use oci-seccomp-bpf-hook (in container runtime)</span>
<a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="c1"># Automatically generates profiles based on observed behavior</span>
</code></pre></div>
<hr/>
<h2 id="5-apparmor">5. AppArmor<a class="headerlink" href="#5-apparmor" title="Permanent link">¶</a></h2>
<h3 id="51-apparmor-overview">5.1 AppArmor Overview<a class="headerlink" href="#51-apparmor-overview" title="Permanent link">¶</a></h3>
<p>AppArmor is a Mandatory Access Control (MAC) system that restricts program capabilities using per-program profiles.</p>
<p><strong>AppArmor Support:</strong>
- Supported on Ubuntu, Debian, SUSE
- Check if enabled: <code>cat /sys/module/apparmor/parameters/enabled</code>
- Profiles location: <code>/etc/apparmor.d/</code></p>
<h3 id="52-apparmor-profiles">5.2 AppArmor Profiles<a class="headerlink" href="#52-apparmor-profiles" title="Permanent link">¶</a></h3>
<p><strong>Check Available Profiles:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1"># On the node</span>
<a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a>sudo<span class="w"> </span>aa-status
<a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a>
<a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="c1"># List loaded profiles</span>
<a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a>sudo<span class="w"> </span>apparmor_status
</code></pre></div></p>
<p><strong>Example AppArmor Profile:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="c1"># /etc/apparmor.d/k8s-nginx</span>
<a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="c1">#include &lt;tunables/global&gt;</span>
<a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a>
<a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a>profile<span class="w"> </span>k8s-nginx<span class="w"> </span><span class="nv">flags</span><span class="o">=(</span>attach_disconnected,mediate_deleted<span class="o">)</span><span class="w"> </span><span class="o">{</span>
<a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="w">  </span><span class="c1">#include &lt;abstractions/base&gt;</span>
<a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="w">  </span><span class="c1">#include &lt;abstractions/apache2-common&gt;</span>
<a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a>
<a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="w">  </span><span class="c1"># Network access</span>
<a href="#__codelineno-19-9" id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="w">  </span>network<span class="w"> </span>inet<span class="w"> </span>tcp,
<a href="#__codelineno-19-10" id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="w">  </span>network<span class="w"> </span>inet<span class="w"> </span>udp,
<a href="#__codelineno-19-11" id="__codelineno-19-11" name="__codelineno-19-11"></a>
<a href="#__codelineno-19-12" id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="w">  </span><span class="c1"># File access</span>
<a href="#__codelineno-19-13" id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="w">  </span>/usr/sbin/nginx<span class="w"> </span>ix,
<a href="#__codelineno-19-14" id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="w">  </span>/etc/nginx/**<span class="w"> </span>r,
<a href="#__codelineno-19-15" id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="w">  </span>/var/log/nginx/*<span class="w"> </span>w,
<a href="#__codelineno-19-16" id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="w">  </span>/var/cache/nginx/**<span class="w"> </span>rw,
<a href="#__codelineno-19-17" id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="w">  </span>/run/nginx.pid<span class="w"> </span>rw,
<a href="#__codelineno-19-18" id="__codelineno-19-18" name="__codelineno-19-18"></a>
<a href="#__codelineno-19-19" id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="w">  </span><span class="c1"># Deny sensitive paths</span>
<a href="#__codelineno-19-20" id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="w">  </span>deny<span class="w"> </span>/proc/sys/**<span class="w"> </span>w,
<a href="#__codelineno-19-21" id="__codelineno-19-21" name="__codelineno-19-21"></a><span class="w">  </span>deny<span class="w"> </span>/sys/**<span class="w"> </span>w,
<a href="#__codelineno-19-22" id="__codelineno-19-22" name="__codelineno-19-22"></a><span class="w">  </span>deny<span class="w"> </span>/etc/shadow<span class="w"> </span>r,
<a href="#__codelineno-19-23" id="__codelineno-19-23" name="__codelineno-19-23"></a><span class="w">  </span>deny<span class="w"> </span>/etc/passwd<span class="w"> </span>w,
<a href="#__codelineno-19-24" id="__codelineno-19-24" name="__codelineno-19-24"></a>
<a href="#__codelineno-19-25" id="__codelineno-19-25" name="__codelineno-19-25"></a><span class="w">  </span><span class="c1"># Required directories</span>
<a href="#__codelineno-19-26" id="__codelineno-19-26" name="__codelineno-19-26"></a><span class="w">  </span>/usr/share/nginx/**<span class="w"> </span>r,
<a href="#__codelineno-19-27" id="__codelineno-19-27" name="__codelineno-19-27"></a><span class="w">  </span>/var/www/**<span class="w"> </span>r,
<a href="#__codelineno-19-28" id="__codelineno-19-28" name="__codelineno-19-28"></a>
<a href="#__codelineno-19-29" id="__codelineno-19-29" name="__codelineno-19-29"></a><span class="w">  </span><span class="c1"># Temporary files</span>
<a href="#__codelineno-19-30" id="__codelineno-19-30" name="__codelineno-19-30"></a><span class="w">  </span>/tmp/**<span class="w"> </span>rw,
<a href="#__codelineno-19-31" id="__codelineno-19-31" name="__codelineno-19-31"></a><span class="w">  </span>/var/tmp/**<span class="w"> </span>rw,
<a href="#__codelineno-19-32" id="__codelineno-19-32" name="__codelineno-19-32"></a>
<a href="#__codelineno-19-33" id="__codelineno-19-33" name="__codelineno-19-33"></a><span class="w">  </span><span class="c1"># Capabilities (limited)</span>
<a href="#__codelineno-19-34" id="__codelineno-19-34" name="__codelineno-19-34"></a><span class="w">  </span>capability<span class="w"> </span>net_bind_service,
<a href="#__codelineno-19-35" id="__codelineno-19-35" name="__codelineno-19-35"></a><span class="w">  </span>capability<span class="w"> </span>dac_override,
<a href="#__codelineno-19-36" id="__codelineno-19-36" name="__codelineno-19-36"></a><span class="w">  </span>capability<span class="w"> </span>setuid,
<a href="#__codelineno-19-37" id="__codelineno-19-37" name="__codelineno-19-37"></a><span class="w">  </span>capability<span class="w"> </span>setgid,
<a href="#__codelineno-19-38" id="__codelineno-19-38" name="__codelineno-19-38"></a><span class="w">  </span>capability<span class="w"> </span>chown,
<a href="#__codelineno-19-39" id="__codelineno-19-39" name="__codelineno-19-39"></a>
<a href="#__codelineno-19-40" id="__codelineno-19-40" name="__codelineno-19-40"></a><span class="w">  </span><span class="c1"># Deny dangerous capabilities</span>
<a href="#__codelineno-19-41" id="__codelineno-19-41" name="__codelineno-19-41"></a><span class="w">  </span>deny<span class="w"> </span>capability<span class="w"> </span>sys_admin,
<a href="#__codelineno-19-42" id="__codelineno-19-42" name="__codelineno-19-42"></a><span class="w">  </span>deny<span class="w"> </span>capability<span class="w"> </span>sys_module,
<a href="#__codelineno-19-43" id="__codelineno-19-43" name="__codelineno-19-43"></a><span class="w">  </span>deny<span class="w"> </span>capability<span class="w"> </span>sys_rawio,
<a href="#__codelineno-19-44" id="__codelineno-19-44" name="__codelineno-19-44"></a><span class="o">}</span>
</code></pre></div></p>
<p><strong>Load Profile:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># Parse and load profile</span>
<a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a>sudo<span class="w"> </span>apparmor_parser<span class="w"> </span>-r<span class="w"> </span>-W<span class="w"> </span>/etc/apparmor.d/k8s-nginx
<a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a>
<a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="c1"># Verify profile loaded</span>
<a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a>sudo<span class="w"> </span>aa-status<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>k8s-nginx
</code></pre></div></p>
<h3 id="53-using-apparmor-in-pods">5.3 Using AppArmor in Pods<a class="headerlink" href="#53-using-apparmor-in-pods" title="Permanent link">¶</a></h3>
<p><strong>AppArmor Annotation:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-apparmor</span>
<a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">    </span><span class="c1"># Format: container.apparmor.security.beta.kubernetes.io/&lt;container-name&gt;: &lt;profile&gt;</span>
<a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">    </span><span class="nt">container.apparmor.security.beta.kubernetes.io/nginx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost/k8s-nginx</span>
<a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.25</span>
<a href="#__codelineno-21-12" id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<a href="#__codelineno-21-13" id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div></p>
<p><strong>Runtime Default Profile:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="nt">container.apparmor.security.beta.kubernetes.io/nginx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">runtime/default</span>
</code></pre></div></p>
<p><strong>Unconfined (Insecure):</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="nt">container.apparmor.security.beta.kubernetes.io/nginx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unconfined</span>
</code></pre></div></p>
<h3 id="54-testing-apparmor-enforcement">5.4 Testing AppArmor Enforcement<a class="headerlink" href="#54-testing-apparmor-enforcement" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1"># Deploy pod with AppArmor</span>
<a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>nginx-apparmor.yaml
<a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a>
<a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="c1"># Test restricted operation (should fail)</span>
<a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>nginx-apparmor<span class="w"> </span>--<span class="w"> </span>touch<span class="w"> </span>/etc/shadow
<a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="c1"># Output: touch: cannot touch '/etc/shadow': Permission denied</span>
<a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a>
<a href="#__codelineno-24-8" id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="c1"># Check AppArmor denials in logs</span>
<a href="#__codelineno-24-9" id="__codelineno-24-9" name="__codelineno-24-9"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>nginx-apparmor<span class="w"> </span>--<span class="w"> </span>dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>DENIED
</code></pre></div>
<hr/>
<h2 id="6-selinux">6. SELinux<a class="headerlink" href="#6-selinux" title="Permanent link">¶</a></h2>
<h3 id="61-selinux-overview">6.1 SELinux Overview<a class="headerlink" href="#61-selinux-overview" title="Permanent link">¶</a></h3>
<p>Security-Enhanced Linux (SELinux) provides mandatory access control (MAC) through security labels and policies.</p>
<p><strong>SELinux Contexts:</strong>
- <strong>User</strong> (<code>system_u</code>) - SELinux user
- <strong>Role</strong> (<code>system_r</code>) - Role-based access control
- <strong>Type</strong> (<code>container_t</code>) - Type enforcement (most important)
- <strong>Level</strong> (<code>s0:c1,c2</code>) - Multi-Level Security (MLS)</p>
<p><strong>Check SELinux Status:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1"># On the node</span>
<a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a>getenforce
<a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="c1"># Output: Enforcing / Permissive / Disabled</span>
<a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a>
<a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a>sestatus
</code></pre></div></p>
<h3 id="62-container-selinux-types">6.2 Container SELinux Types<a class="headerlink" href="#62-container-selinux-types" title="Permanent link">¶</a></h3>
<p><strong>Common Container Types:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>container_t</code></td>
<td>Default container type</td>
<td>Standard containers</td>
</tr>
<tr>
<td><code>container_init_t</code></td>
<td>Container init process</td>
<td>systemd in containers</td>
</tr>
<tr>
<td><code>svirt_sandbox_file_t</code></td>
<td>Container files</td>
<td>Volume mounts</td>
</tr>
<tr>
<td><code>container_file_t</code></td>
<td>Container filesystem</td>
<td>Container layers</td>
</tr>
</tbody>
</table>
<h3 id="63-selinux-in-pods">6.3 SELinux in Pods<a class="headerlink" href="#63-selinux-in-pods" title="Permanent link">¶</a></h3>
<p><strong>Basic SELinux Options:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">selinux-demo</span>
<a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-26-6" id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="w">  </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-26-7" id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="w">    </span><span class="nt">seLinuxOptions</span><span class="p">:</span>
<a href="#__codelineno-26-8" id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="w">      </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="s">"s0:c123,c456"</span><span class="w">  </span><span class="c1"># MLS/MCS level</span>
<a href="#__codelineno-26-9" id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="w">      </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="s">"system_r"</span><span class="w">        </span><span class="c1"># SELinux role</span>
<a href="#__codelineno-26-10" id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">"container_t"</span><span class="w">     </span><span class="c1"># SELinux type</span>
<a href="#__codelineno-26-11" id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="s">"system_u"</span><span class="w">        </span><span class="c1"># SELinux user</span>
<a href="#__codelineno-26-12" id="__codelineno-26-12" name="__codelineno-26-12"></a>
<a href="#__codelineno-26-13" id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-26-14" id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-26-15" id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:1.0</span>
</code></pre></div></p>
<p><strong>Custom SELinux Policy:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-selinux</span>
<a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="w">  </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-27-7" id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="w">    </span><span class="nt">seLinuxOptions</span><span class="p">:</span>
<a href="#__codelineno-27-8" id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="w">      </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="s">"s0"</span>
<a href="#__codelineno-27-9" id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">"container_t"</span>
<a href="#__codelineno-27-10" id="__codelineno-27-10" name="__codelineno-27-10"></a>
<a href="#__codelineno-27-11" id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-27-12" id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a href="#__codelineno-27-13" id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.25</span>
<a href="#__codelineno-27-14" id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span>
<a href="#__codelineno-27-15" id="__codelineno-27-15" name="__codelineno-27-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<a href="#__codelineno-27-16" id="__codelineno-27-16" name="__codelineno-27-16"></a><span class="w">      </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/share/nginx/html</span>
<a href="#__codelineno-27-17" id="__codelineno-27-17" name="__codelineno-27-17"></a>
<a href="#__codelineno-27-18" id="__codelineno-27-18" name="__codelineno-27-18"></a><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<a href="#__codelineno-27-19" id="__codelineno-27-19" name="__codelineno-27-19"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<a href="#__codelineno-27-20" id="__codelineno-27-20" name="__codelineno-27-20"></a><span class="w">    </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<a href="#__codelineno-27-21" id="__codelineno-27-21" name="__codelineno-27-21"></a><span class="w">      </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-content</span>
</code></pre></div></p>
<p><strong>Verify SELinux Context:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1"># Check pod context</span>
<a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>selinux-demo<span class="w"> </span>--<span class="w"> </span>ps<span class="w"> </span>-eZ<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nginx
<a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a>
<a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="c1"># Check file contexts</span>
<a href="#__codelineno-28-5" id="__codelineno-28-5" name="__codelineno-28-5"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>selinux-demo<span class="w"> </span>--<span class="w"> </span>ls<span class="w"> </span>-Z<span class="w"> </span>/usr/share/nginx/html
</code></pre></div></p>
<h3 id="64-selinux-volume-labeling">6.4 SELinux Volume Labeling<a class="headerlink" href="#64-selinux-volume-labeling" title="Permanent link">¶</a></h3>
<p>Kubernetes automatically applies SELinux labels to volumes based on pod context:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">volume-selinux</span>
<a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-29-6" id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="w">  </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-29-7" id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="w">    </span><span class="nt">seLinuxOptions</span><span class="p">:</span>
<a href="#__codelineno-29-8" id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="w">      </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="s">"s0:c100,c200"</span>
<a href="#__codelineno-29-9" id="__codelineno-29-9" name="__codelineno-29-9"></a>
<a href="#__codelineno-29-10" id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-29-11" id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-29-12" id="__codelineno-29-12" name="__codelineno-29-12"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">busybox</span>
<a href="#__codelineno-29-13" id="__codelineno-29-13" name="__codelineno-29-13"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"sleep"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"3600"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-29-14" id="__codelineno-29-14" name="__codelineno-29-14"></a><span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span>
<a href="#__codelineno-29-15" id="__codelineno-29-15" name="__codelineno-29-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data</span>
<a href="#__codelineno-29-16" id="__codelineno-29-16" name="__codelineno-29-16"></a><span class="w">      </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data</span>
<a href="#__codelineno-29-17" id="__codelineno-29-17" name="__codelineno-29-17"></a>
<a href="#__codelineno-29-18" id="__codelineno-29-18" name="__codelineno-29-18"></a><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<a href="#__codelineno-29-19" id="__codelineno-29-19" name="__codelineno-29-19"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data</span>
<a href="#__codelineno-29-20" id="__codelineno-29-20" name="__codelineno-29-20"></a><span class="w">    </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</code></pre></div>
<p><strong>Check Volume Labels:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="c1"># On the node, find container ID</span>
<a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a>docker<span class="w"> </span>ps<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>volume-selinux
<a href="#__codelineno-30-3" id="__codelineno-30-3" name="__codelineno-30-3"></a>
<a href="#__codelineno-30-4" id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="c1"># Check volume mount labels</span>
<a href="#__codelineno-30-5" id="__codelineno-30-5" name="__codelineno-30-5"></a>docker<span class="w"> </span>inspect<span class="w"> </span>&lt;container-id&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">10</span><span class="w"> </span>Mounts
<a href="#__codelineno-30-6" id="__codelineno-30-6" name="__codelineno-30-6"></a>
<a href="#__codelineno-30-7" id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="c1"># Verify filesystem labels</span>
<a href="#__codelineno-30-8" id="__codelineno-30-8" name="__codelineno-30-8"></a>ls<span class="w"> </span>-Z<span class="w"> </span>/var/lib/kubelet/pods/&lt;pod-uid&gt;/volumes/
</code></pre></div></p>
<hr/>
<h2 id="7-read-only-root-filesystem">7. Read-Only Root Filesystem<a class="headerlink" href="#7-read-only-root-filesystem" title="Permanent link">¶</a></h2>
<h3 id="71-why-read-only-root-filesystems">7.1 Why Read-Only Root Filesystems?<a class="headerlink" href="#71-why-read-only-root-filesystems" title="Permanent link">¶</a></h3>
<p><strong>Security Benefits:</strong>
- Prevents malware persistence
- Blocks unauthorized file modifications
- Reduces attack surface
- Enforces immutable infrastructure
- Simplifies security auditing</p>
<h3 id="72-implementing-read-only-root-filesystem">7.2 Implementing Read-Only Root Filesystem<a class="headerlink" href="#72-implementing-read-only-root-filesystem" title="Permanent link">¶</a></h3>
<p><strong>Basic Configuration:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">readonly-root</span>
<a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-31-6" id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-31-7" id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a href="#__codelineno-31-8" id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.25</span>
<a href="#__codelineno-31-9" id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-31-10" id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="w">      </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-31-11" id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span>
<a href="#__codelineno-31-12" id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache</span>
<a href="#__codelineno-31-13" id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="w">      </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/cache/nginx</span>
<a href="#__codelineno-31-14" id="__codelineno-31-14" name="__codelineno-31-14"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">run</span>
<a href="#__codelineno-31-15" id="__codelineno-31-15" name="__codelineno-31-15"></a><span class="w">      </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run</span>
<a href="#__codelineno-31-16" id="__codelineno-31-16" name="__codelineno-31-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmp</span>
<a href="#__codelineno-31-17" id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="w">      </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
<a href="#__codelineno-31-18" id="__codelineno-31-18" name="__codelineno-31-18"></a>
<a href="#__codelineno-31-19" id="__codelineno-31-19" name="__codelineno-31-19"></a><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<a href="#__codelineno-31-20" id="__codelineno-31-20" name="__codelineno-31-20"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache</span>
<a href="#__codelineno-31-21" id="__codelineno-31-21" name="__codelineno-31-21"></a><span class="w">    </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a href="#__codelineno-31-22" id="__codelineno-31-22" name="__codelineno-31-22"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">run</span>
<a href="#__codelineno-31-23" id="__codelineno-31-23" name="__codelineno-31-23"></a><span class="w">    </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a href="#__codelineno-31-24" id="__codelineno-31-24" name="__codelineno-31-24"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmp</span>
<a href="#__codelineno-31-25" id="__codelineno-31-25" name="__codelineno-31-25"></a><span class="w">    </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</code></pre></div></p>
<h3 id="73-application-specific-writable-paths">7.3 Application-Specific Writable Paths<a class="headerlink" href="#73-application-specific-writable-paths" title="Permanent link">¶</a></h3>
<p>Different applications require different writable directories:</p>
<p><strong>Nginx:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="nt">volumeMounts</span><span class="p">:</span>
<a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache</span>
<a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="w">  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/cache/nginx</span>
<a href="#__codelineno-32-4" id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">run</span>
<a href="#__codelineno-32-5" id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="w">  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run</span>
<a href="#__codelineno-32-6" id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmp</span>
<a href="#__codelineno-32-7" id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="w">  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
</code></pre></div></p>
<p><strong>Node.js Application:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="nt">volumeMounts</span><span class="p">:</span>
<a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm-cache</span>
<a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="w">  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/.npm</span>
<a href="#__codelineno-33-4" id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node-cache</span>
<a href="#__codelineno-33-5" id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="w">  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/.node</span>
<a href="#__codelineno-33-6" id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmp</span>
<a href="#__codelineno-33-7" id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="w">  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
<a href="#__codelineno-33-8" id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-logs</span>
<a href="#__codelineno-33-9" id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="w">  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/logs</span>
</code></pre></div></p>
<p><strong>Java Application:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="nt">volumeMounts</span><span class="p">:</span>
<a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmp</span>
<a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="w">  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
<a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">java-tmp</span>
<a href="#__codelineno-34-5" id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="w">  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/java/tmp</span>
<a href="#__codelineno-34-6" id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="nt">env</span><span class="p">:</span>
<a href="#__codelineno-34-7" id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">JAVA_TOOL_OPTIONS</span>
<a href="#__codelineno-34-8" id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"-Djava.io.tmpdir=/opt/java/tmp"</span>
</code></pre></div></p>
<h3 id="74-production-ready-example-with-read-only-root">7.4 Production-Ready Example with Read-Only Root<a class="headerlink" href="#74-production-ready-example-with-read-only-root" title="Permanent link">¶</a></h3>
<p><strong>Complete Deployment:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a href="#__codelineno-35-3" id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-35-4" id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secure-web-app</span>
<a href="#__codelineno-35-5" id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<a href="#__codelineno-35-6" id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-35-7" id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a href="#__codelineno-35-8" id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a href="#__codelineno-35-9" id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<a href="#__codelineno-35-10" id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secure-web</span>
<a href="#__codelineno-35-11" id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a href="#__codelineno-35-12" id="__codelineno-35-12" name="__codelineno-35-12"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-35-13" id="__codelineno-35-13" name="__codelineno-35-13"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a href="#__codelineno-35-14" id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secure-web</span>
<a href="#__codelineno-35-15" id="__codelineno-35-15" name="__codelineno-35-15"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-35-16" id="__codelineno-35-16" name="__codelineno-35-16"></a><span class="w">      </span><span class="c1"># Pod-level security</span>
<a href="#__codelineno-35-17" id="__codelineno-35-17" name="__codelineno-35-17"></a><span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-35-18" id="__codelineno-35-18" name="__codelineno-35-18"></a><span class="w">        </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-35-19" id="__codelineno-35-19" name="__codelineno-35-19"></a><span class="w">        </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<a href="#__codelineno-35-20" id="__codelineno-35-20" name="__codelineno-35-20"></a><span class="w">        </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
<a href="#__codelineno-35-21" id="__codelineno-35-21" name="__codelineno-35-21"></a><span class="w">        </span><span class="nt">fsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2000</span>
<a href="#__codelineno-35-22" id="__codelineno-35-22" name="__codelineno-35-22"></a><span class="w">        </span><span class="nt">seccompProfile</span><span class="p">:</span>
<a href="#__codelineno-35-23" id="__codelineno-35-23" name="__codelineno-35-23"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RuntimeDefault</span>
<a href="#__codelineno-35-24" id="__codelineno-35-24" name="__codelineno-35-24"></a>
<a href="#__codelineno-35-25" id="__codelineno-35-25" name="__codelineno-35-25"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-35-26" id="__codelineno-35-26" name="__codelineno-35-26"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-35-27" id="__codelineno-35-27" name="__codelineno-35-27"></a><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mycompany/web-app:1.2.3</span>
<a href="#__codelineno-35-28" id="__codelineno-35-28" name="__codelineno-35-28"></a>
<a href="#__codelineno-35-29" id="__codelineno-35-29" name="__codelineno-35-29"></a><span class="w">        </span><span class="c1"># Container-level security</span>
<a href="#__codelineno-35-30" id="__codelineno-35-30" name="__codelineno-35-30"></a><span class="w">        </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-35-31" id="__codelineno-35-31" name="__codelineno-35-31"></a><span class="w">          </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a href="#__codelineno-35-32" id="__codelineno-35-32" name="__codelineno-35-32"></a><span class="w">          </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-35-33" id="__codelineno-35-33" name="__codelineno-35-33"></a><span class="w">          </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-35-34" id="__codelineno-35-34" name="__codelineno-35-34"></a><span class="w">          </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<a href="#__codelineno-35-35" id="__codelineno-35-35" name="__codelineno-35-35"></a><span class="w">          </span><span class="nt">capabilities</span><span class="p">:</span>
<a href="#__codelineno-35-36" id="__codelineno-35-36" name="__codelineno-35-36"></a><span class="w">            </span><span class="nt">drop</span><span class="p">:</span>
<a href="#__codelineno-35-37" id="__codelineno-35-37" name="__codelineno-35-37"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<a href="#__codelineno-35-38" id="__codelineno-35-38" name="__codelineno-35-38"></a><span class="w">            </span><span class="nt">add</span><span class="p">:</span>
<a href="#__codelineno-35-39" id="__codelineno-35-39" name="__codelineno-35-39"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NET_BIND_SERVICE</span>
<a href="#__codelineno-35-40" id="__codelineno-35-40" name="__codelineno-35-40"></a>
<a href="#__codelineno-35-41" id="__codelineno-35-41" name="__codelineno-35-41"></a><span class="w">        </span><span class="c1"># Application requirements</span>
<a href="#__codelineno-35-42" id="__codelineno-35-42" name="__codelineno-35-42"></a><span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<a href="#__codelineno-35-43" id="__codelineno-35-43" name="__codelineno-35-43"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<a href="#__codelineno-35-44" id="__codelineno-35-44" name="__codelineno-35-44"></a><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<a href="#__codelineno-35-45" id="__codelineno-35-45" name="__codelineno-35-45"></a>
<a href="#__codelineno-35-46" id="__codelineno-35-46" name="__codelineno-35-46"></a><span class="w">        </span><span class="c1"># Resource limits</span>
<a href="#__codelineno-35-47" id="__codelineno-35-47" name="__codelineno-35-47"></a><span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<a href="#__codelineno-35-48" id="__codelineno-35-48" name="__codelineno-35-48"></a><span class="w">          </span><span class="nt">limits</span><span class="p">:</span>
<a href="#__codelineno-35-49" id="__codelineno-35-49" name="__codelineno-35-49"></a><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">"1"</span>
<a href="#__codelineno-35-50" id="__codelineno-35-50" name="__codelineno-35-50"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512Mi</span>
<a href="#__codelineno-35-51" id="__codelineno-35-51" name="__codelineno-35-51"></a><span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<a href="#__codelineno-35-52" id="__codelineno-35-52" name="__codelineno-35-52"></a><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">250m</span>
<a href="#__codelineno-35-53" id="__codelineno-35-53" name="__codelineno-35-53"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256Mi</span>
<a href="#__codelineno-35-54" id="__codelineno-35-54" name="__codelineno-35-54"></a>
<a href="#__codelineno-35-55" id="__codelineno-35-55" name="__codelineno-35-55"></a><span class="w">        </span><span class="c1"># Writable volumes</span>
<a href="#__codelineno-35-56" id="__codelineno-35-56" name="__codelineno-35-56"></a><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
<a href="#__codelineno-35-57" id="__codelineno-35-57" name="__codelineno-35-57"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache</span>
<a href="#__codelineno-35-58" id="__codelineno-35-58" name="__codelineno-35-58"></a><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/cache</span>
<a href="#__codelineno-35-59" id="__codelineno-35-59" name="__codelineno-35-59"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmp</span>
<a href="#__codelineno-35-60" id="__codelineno-35-60" name="__codelineno-35-60"></a><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
<a href="#__codelineno-35-61" id="__codelineno-35-61" name="__codelineno-35-61"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logs</span>
<a href="#__codelineno-35-62" id="__codelineno-35-62" name="__codelineno-35-62"></a><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/logs</span>
<a href="#__codelineno-35-63" id="__codelineno-35-63" name="__codelineno-35-63"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<a href="#__codelineno-35-64" id="__codelineno-35-64" name="__codelineno-35-64"></a><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/config</span>
<a href="#__codelineno-35-65" id="__codelineno-35-65" name="__codelineno-35-65"></a><span class="w">          </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-35-66" id="__codelineno-35-66" name="__codelineno-35-66"></a>
<a href="#__codelineno-35-67" id="__codelineno-35-67" name="__codelineno-35-67"></a><span class="w">        </span><span class="c1"># Health checks</span>
<a href="#__codelineno-35-68" id="__codelineno-35-68" name="__codelineno-35-68"></a><span class="w">        </span><span class="nt">livenessProbe</span><span class="p">:</span>
<a href="#__codelineno-35-69" id="__codelineno-35-69" name="__codelineno-35-69"></a><span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span>
<a href="#__codelineno-35-70" id="__codelineno-35-70" name="__codelineno-35-70"></a><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/health</span>
<a href="#__codelineno-35-71" id="__codelineno-35-71" name="__codelineno-35-71"></a><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<a href="#__codelineno-35-72" id="__codelineno-35-72" name="__codelineno-35-72"></a><span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<a href="#__codelineno-35-73" id="__codelineno-35-73" name="__codelineno-35-73"></a><span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a href="#__codelineno-35-74" id="__codelineno-35-74" name="__codelineno-35-74"></a>
<a href="#__codelineno-35-75" id="__codelineno-35-75" name="__codelineno-35-75"></a><span class="w">        </span><span class="nt">readinessProbe</span><span class="p">:</span>
<a href="#__codelineno-35-76" id="__codelineno-35-76" name="__codelineno-35-76"></a><span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span>
<a href="#__codelineno-35-77" id="__codelineno-35-77" name="__codelineno-35-77"></a><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/ready</span>
<a href="#__codelineno-35-78" id="__codelineno-35-78" name="__codelineno-35-78"></a><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<a href="#__codelineno-35-79" id="__codelineno-35-79" name="__codelineno-35-79"></a><span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<a href="#__codelineno-35-80" id="__codelineno-35-80" name="__codelineno-35-80"></a><span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<a href="#__codelineno-35-81" id="__codelineno-35-81" name="__codelineno-35-81"></a>
<a href="#__codelineno-35-82" id="__codelineno-35-82" name="__codelineno-35-82"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<a href="#__codelineno-35-83" id="__codelineno-35-83" name="__codelineno-35-83"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache</span>
<a href="#__codelineno-35-84" id="__codelineno-35-84" name="__codelineno-35-84"></a><span class="w">        </span><span class="nt">emptyDir</span><span class="p">:</span>
<a href="#__codelineno-35-85" id="__codelineno-35-85" name="__codelineno-35-85"></a><span class="w">          </span><span class="nt">sizeLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100Mi</span>
<a href="#__codelineno-35-86" id="__codelineno-35-86" name="__codelineno-35-86"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmp</span>
<a href="#__codelineno-35-87" id="__codelineno-35-87" name="__codelineno-35-87"></a><span class="w">        </span><span class="nt">emptyDir</span><span class="p">:</span>
<a href="#__codelineno-35-88" id="__codelineno-35-88" name="__codelineno-35-88"></a><span class="w">          </span><span class="nt">sizeLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50Mi</span>
<a href="#__codelineno-35-89" id="__codelineno-35-89" name="__codelineno-35-89"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logs</span>
<a href="#__codelineno-35-90" id="__codelineno-35-90" name="__codelineno-35-90"></a><span class="w">        </span><span class="nt">emptyDir</span><span class="p">:</span>
<a href="#__codelineno-35-91" id="__codelineno-35-91" name="__codelineno-35-91"></a><span class="w">          </span><span class="nt">sizeLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200Mi</span>
<a href="#__codelineno-35-92" id="__codelineno-35-92" name="__codelineno-35-92"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<a href="#__codelineno-35-93" id="__codelineno-35-93" name="__codelineno-35-93"></a><span class="w">        </span><span class="nt">configMap</span><span class="p">:</span>
<a href="#__codelineno-35-94" id="__codelineno-35-94" name="__codelineno-35-94"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-config</span>
</code></pre></div></p>
<hr/>
<h2 id="8-security-best-practices">8. Security Best Practices<a class="headerlink" href="#8-security-best-practices" title="Permanent link">¶</a></h2>
<h3 id="81-defense-in-depth">8.1 Defense in Depth<a class="headerlink" href="#81-defense-in-depth" title="Permanent link">¶</a></h3>
<p>Implement multiple security layers:</p>
<ol>
<li><strong>Pod Security Standards</strong> - Enforce at namespace level</li>
<li><strong>Security Contexts</strong> - Configure for every container</li>
<li><strong>Seccomp/AppArmor/SELinux</strong> - Add MAC layer</li>
<li><strong>Read-Only Filesystem</strong> - Prevent modifications</li>
<li><strong>Network Policies</strong> - Restrict traffic</li>
<li><strong>Resource Limits</strong> - Prevent resource exhaustion</li>
</ol>
<h3 id="82-principle-of-least-privilege">8.2 Principle of Least Privilege<a class="headerlink" href="#82-principle-of-least-privilege" title="Permanent link">¶</a></h3>
<p><strong>Checklist:</strong>
- ✅ Run as non-root user
- ✅ Drop all capabilities, add only required ones
- ✅ Use read-only root filesystem
- ✅ Disable privilege escalation
- ✅ Apply seccomp profile (RuntimeDefault minimum)
- ✅ Use specific image tags (not <code>latest</code>)
- ✅ Set resource limits
- ✅ Avoid hostPath, hostNetwork, hostPID, hostIPC</p>
<p><strong>Minimal Security Template:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-36-2" id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="w">  </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-36-3" id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="w">  </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<a href="#__codelineno-36-4" id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="w">  </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a href="#__codelineno-36-5" id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="w">  </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-36-6" id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="w">  </span><span class="nt">capabilities</span><span class="p">:</span>
<a href="#__codelineno-36-7" id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="w">    </span><span class="nt">drop</span><span class="p">:</span>
<a href="#__codelineno-36-8" id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<a href="#__codelineno-36-9" id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="w">  </span><span class="nt">seccompProfile</span><span class="p">:</span>
<a href="#__codelineno-36-10" id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RuntimeDefault</span>
</code></pre></div></p>
<h3 id="83-secure-image-practices">8.3 Secure Image Practices<a class="headerlink" href="#83-secure-image-practices" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-37-1" id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1"># Use minimal base images</span>
<a href="#__codelineno-37-2" id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="l l-Scalar l-Scalar-Plain">FROM gcr.io/distroless/static-debian11:nonroot</span>
<a href="#__codelineno-37-3" id="__codelineno-37-3" name="__codelineno-37-3"></a>
<a href="#__codelineno-37-4" id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="l l-Scalar l-Scalar-Plain"># Or create non-root user</span>
<a href="#__codelineno-37-5" id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="l l-Scalar l-Scalar-Plain">FROM alpine:3.18</span>
<a href="#__codelineno-37-6" id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="l l-Scalar l-Scalar-Plain">RUN addgroup -g 1000 appuser &amp;&amp; \</span>
<a href="#__codelineno-37-7" id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">adduser -D -u 1000 -G appuser appuser</span>
<a href="#__codelineno-37-8" id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="l l-Scalar l-Scalar-Plain">USER appuser</span>
<a href="#__codelineno-37-9" id="__codelineno-37-9" name="__codelineno-37-9"></a>
<a href="#__codelineno-37-10" id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="l l-Scalar l-Scalar-Plain"># Use specific tags, not latest</span>
<a href="#__codelineno-37-11" id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.example.com/myapp:v1.2.3-sha256@abc123...</span>
</code></pre></div>
<h3 id="84-admission-controllers">8.4 Admission Controllers<a class="headerlink" href="#84-admission-controllers" title="Permanent link">¶</a></h3>
<p>Enforce security policies cluster-wide using admission controllers:</p>
<p><strong>Example OPA Gatekeeper Policy:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-38-1" id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">constraints.gatekeeper.sh/v1beta1</span>
<a href="#__codelineno-38-2" id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">K8sRequireReadOnlyRoot</span>
<a href="#__codelineno-38-3" id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a href="#__codelineno-38-4" id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">require-readonly-root</span>
<a href="#__codelineno-38-5" id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-38-6" id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="w">  </span><span class="nt">match</span><span class="p">:</span>
<a href="#__codelineno-38-7" id="__codelineno-38-7" name="__codelineno-38-7"></a><span class="w">    </span><span class="nt">kinds</span><span class="p">:</span>
<a href="#__codelineno-38-8" id="__codelineno-38-8" name="__codelineno-38-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">""</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-38-9" id="__codelineno-38-9" name="__codelineno-38-9"></a><span class="w">      </span><span class="nt">kinds</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"Pod"</span><span class="p p-Indicator">]</span>
<a href="#__codelineno-38-10" id="__codelineno-38-10" name="__codelineno-38-10"></a><span class="w">    </span><span class="nt">namespaces</span><span class="p">:</span>
<a href="#__codelineno-38-11" id="__codelineno-38-11" name="__codelineno-38-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<a href="#__codelineno-38-12" id="__codelineno-38-12" name="__codelineno-38-12"></a><span class="w">  </span><span class="nt">parameters</span><span class="p">:</span>
<a href="#__codelineno-38-13" id="__codelineno-38-13" name="__codelineno-38-13"></a><span class="w">    </span><span class="nt">exemptions</span><span class="p">:</span>
<a href="#__codelineno-38-14" id="__codelineno-38-14" name="__codelineno-38-14"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
</code></pre></div></p>
<hr/>
<h2 id="9-security-anti-patterns">9. Security Anti-Patterns<a class="headerlink" href="#9-security-anti-patterns" title="Permanent link">¶</a></h2>
<h3 id="91-common-mistakes">9.1 Common Mistakes<a class="headerlink" href="#91-common-mistakes" title="Permanent link">¶</a></h3>
<p><strong>❌ Anti-Pattern 1: Running as Root</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-39-1" id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="c1"># BAD: Runs as root (UID 0)</span>
<a href="#__codelineno-39-2" id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-39-3" id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-39-4" id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-39-5" id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:latest</span>
<a href="#__codelineno-39-6" id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="w">    </span><span class="c1"># No securityContext specified</span>
</code></pre></div></p>
<p><strong>✅ Corrected:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-40-1" id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-40-2" id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="w">  </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-40-3" id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="w">    </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-40-4" id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="w">    </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<a href="#__codelineno-40-5" id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-40-6" id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-40-7" id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:latest</span>
</code></pre></div></p>
<p><strong>❌ Anti-Pattern 2: Privileged Containers</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-41-1" id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="c1"># BAD: Privileged container</span>
<a href="#__codelineno-41-2" id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-41-3" id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-41-4" id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-41-5" id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:latest</span>
<a href="#__codelineno-41-6" id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-41-7" id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="w">      </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div></p>
<p><strong>✅ Corrected:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-42-1" id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-42-2" id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-42-3" id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-42-4" id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:latest</span>
<a href="#__codelineno-42-5" id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-42-6" id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="w">      </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a href="#__codelineno-42-7" id="__codelineno-42-7" name="__codelineno-42-7"></a><span class="w">      </span><span class="nt">capabilities</span><span class="p">:</span>
<a href="#__codelineno-42-8" id="__codelineno-42-8" name="__codelineno-42-8"></a><span class="w">        </span><span class="nt">drop</span><span class="p">:</span>
<a href="#__codelineno-42-9" id="__codelineno-42-9" name="__codelineno-42-9"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<a href="#__codelineno-42-10" id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="w">        </span><span class="nt">add</span><span class="p">:</span>
<a href="#__codelineno-42-11" id="__codelineno-42-11" name="__codelineno-42-11"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NET_ADMIN</span><span class="w">  </span><span class="c1"># Only if absolutely required</span>
</code></pre></div></p>
<p><strong>❌ Anti-Pattern 3: Host Namespaces</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-43-1" id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="c1"># BAD: Sharing host namespaces</span>
<a href="#__codelineno-43-2" id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-43-3" id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="w">  </span><span class="nt">hostNetwork</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-43-4" id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="w">  </span><span class="nt">hostPID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-43-5" id="__codelineno-43-5" name="__codelineno-43-5"></a><span class="w">  </span><span class="nt">hostIPC</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div></p>
<p><strong>✅ Corrected:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-44-1" id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-44-2" id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="w">  </span><span class="nt">hostNetwork</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a href="#__codelineno-44-3" id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="w">  </span><span class="nt">hostPID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a href="#__codelineno-44-4" id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="w">  </span><span class="nt">hostIPC</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div></p>
<p><strong>❌ Anti-Pattern 4: Writable Root Filesystem</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-45-1" id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="c1"># BAD: Writable filesystem</span>
<a href="#__codelineno-45-2" id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-45-3" id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-45-4" id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-45-5" id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:latest</span>
<a href="#__codelineno-45-6" id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="w">    </span><span class="c1"># No readOnlyRootFilesystem setting</span>
</code></pre></div></p>
<p><strong>✅ Corrected:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-46-1" id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-46-2" id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-46-3" id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-46-4" id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:latest</span>
<a href="#__codelineno-46-5" id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span>
<a href="#__codelineno-46-6" id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="w">      </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-46-7" id="__codelineno-46-7" name="__codelineno-46-7"></a><span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span>
<a href="#__codelineno-46-8" id="__codelineno-46-8" name="__codelineno-46-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmp</span>
<a href="#__codelineno-46-9" id="__codelineno-46-9" name="__codelineno-46-9"></a><span class="w">      </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
<a href="#__codelineno-46-10" id="__codelineno-46-10" name="__codelineno-46-10"></a><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<a href="#__codelineno-46-11" id="__codelineno-46-11" name="__codelineno-46-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmp</span>
<a href="#__codelineno-46-12" id="__codelineno-46-12" name="__codelineno-46-12"></a><span class="w">    </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</code></pre></div></p>
<p><strong>❌ Anti-Pattern 5: No Resource Limits</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-47-1" id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="c1"># BAD: No resource limits</span>
<a href="#__codelineno-47-2" id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-47-3" id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-47-4" id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-47-5" id="__codelineno-47-5" name="__codelineno-47-5"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:latest</span>
</code></pre></div></p>
<p><strong>✅ Corrected:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-48-1" id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="nt">spec</span><span class="p">:</span>
<a href="#__codelineno-48-2" id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a href="#__codelineno-48-3" id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<a href="#__codelineno-48-4" id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:latest</span>
<a href="#__codelineno-48-5" id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<a href="#__codelineno-48-6" id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
<a href="#__codelineno-48-7" id="__codelineno-48-7" name="__codelineno-48-7"></a><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500m</span>
<a href="#__codelineno-48-8" id="__codelineno-48-8" name="__codelineno-48-8"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512Mi</span>
<a href="#__codelineno-48-9" id="__codelineno-48-9" name="__codelineno-48-9"></a><span class="w">      </span><span class="nt">requests</span><span class="p">:</span>
<a href="#__codelineno-48-10" id="__codelineno-48-10" name="__codelineno-48-10"></a><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">250m</span>
<a href="#__codelineno-48-11" id="__codelineno-48-11" name="__codelineno-48-11"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256Mi</span>
</code></pre></div></p>
<hr/>
<h2 id="10-hands-on-labs">10. Hands-On Labs<a class="headerlink" href="#10-hands-on-labs" title="Permanent link">¶</a></h2>
<h3 id="lab-1-implementing-pod-security-admission">Lab 1: Implementing Pod Security Admission<a class="headerlink" href="#lab-1-implementing-pod-security-admission" title="Permanent link">¶</a></h3>
<p><strong>Objective:</strong> Configure PSA for a namespace and test enforcement.</p>
<p><strong>Steps:</strong></p>
<ol>
<li>
<p>Create namespace with restricted PSA:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-49-1" id="__codelineno-49-1" name="__codelineno-49-1"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a href="#__codelineno-49-2" id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="s">apiVersion: v1</span>
<a href="#__codelineno-49-3" id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="s">kind: Namespace</span>
<a href="#__codelineno-49-4" id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="s">metadata:</span>
<a href="#__codelineno-49-5" id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="s">  name: lab-restricted</span>
<a href="#__codelineno-49-6" id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="s">  labels:</span>
<a href="#__codelineno-49-7" id="__codelineno-49-7" name="__codelineno-49-7"></a><span class="s">    pod-security.kubernetes.io/enforce: restricted</span>
<a href="#__codelineno-49-8" id="__codelineno-49-8" name="__codelineno-49-8"></a><span class="s">    pod-security.kubernetes.io/audit: restricted</span>
<a href="#__codelineno-49-9" id="__codelineno-49-9" name="__codelineno-49-9"></a><span class="s">    pod-security.kubernetes.io/warn: restricted</span>
<a href="#__codelineno-49-10" id="__codelineno-49-10" name="__codelineno-49-10"></a><span class="s">EOF</span>
</code></pre></div></p>
</li>
<li>
<p>Try deploying non-compliant pod:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-50-1" id="__codelineno-50-1" name="__codelineno-50-1"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a href="#__codelineno-50-2" id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="s">apiVersion: v1</span>
<a href="#__codelineno-50-3" id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="s">kind: Pod</span>
<a href="#__codelineno-50-4" id="__codelineno-50-4" name="__codelineno-50-4"></a><span class="s">metadata:</span>
<a href="#__codelineno-50-5" id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="s">  name: bad-pod</span>
<a href="#__codelineno-50-6" id="__codelineno-50-6" name="__codelineno-50-6"></a><span class="s">  namespace: lab-restricted</span>
<a href="#__codelineno-50-7" id="__codelineno-50-7" name="__codelineno-50-7"></a><span class="s">spec:</span>
<a href="#__codelineno-50-8" id="__codelineno-50-8" name="__codelineno-50-8"></a><span class="s">  containers:</span>
<a href="#__codelineno-50-9" id="__codelineno-50-9" name="__codelineno-50-9"></a><span class="s">  - name: nginx</span>
<a href="#__codelineno-50-10" id="__codelineno-50-10" name="__codelineno-50-10"></a><span class="s">    image: nginx:1.25</span>
<a href="#__codelineno-50-11" id="__codelineno-50-11" name="__codelineno-50-11"></a><span class="s">EOF</span>
</code></pre></div></p>
</li>
</ol>
<p>Expected error: Pod violates restricted policy.</p>
<ol>
<li>
<p>Deploy compliant pod:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-51-1" id="__codelineno-51-1" name="__codelineno-51-1"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a href="#__codelineno-51-2" id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="s">apiVersion: v1</span>
<a href="#__codelineno-51-3" id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="s">kind: Pod</span>
<a href="#__codelineno-51-4" id="__codelineno-51-4" name="__codelineno-51-4"></a><span class="s">metadata:</span>
<a href="#__codelineno-51-5" id="__codelineno-51-5" name="__codelineno-51-5"></a><span class="s">  name: good-pod</span>
<a href="#__codelineno-51-6" id="__codelineno-51-6" name="__codelineno-51-6"></a><span class="s">  namespace: lab-restricted</span>
<a href="#__codelineno-51-7" id="__codelineno-51-7" name="__codelineno-51-7"></a><span class="s">spec:</span>
<a href="#__codelineno-51-8" id="__codelineno-51-8" name="__codelineno-51-8"></a><span class="s">  securityContext:</span>
<a href="#__codelineno-51-9" id="__codelineno-51-9" name="__codelineno-51-9"></a><span class="s">    runAsNonRoot: true</span>
<a href="#__codelineno-51-10" id="__codelineno-51-10" name="__codelineno-51-10"></a><span class="s">    runAsUser: 1000</span>
<a href="#__codelineno-51-11" id="__codelineno-51-11" name="__codelineno-51-11"></a><span class="s">    seccompProfile:</span>
<a href="#__codelineno-51-12" id="__codelineno-51-12" name="__codelineno-51-12"></a><span class="s">      type: RuntimeDefault</span>
<a href="#__codelineno-51-13" id="__codelineno-51-13" name="__codelineno-51-13"></a><span class="s">  containers:</span>
<a href="#__codelineno-51-14" id="__codelineno-51-14" name="__codelineno-51-14"></a><span class="s">  - name: nginx</span>
<a href="#__codelineno-51-15" id="__codelineno-51-15" name="__codelineno-51-15"></a><span class="s">    image: nginx:1.25</span>
<a href="#__codelineno-51-16" id="__codelineno-51-16" name="__codelineno-51-16"></a><span class="s">    securityContext:</span>
<a href="#__codelineno-51-17" id="__codelineno-51-17" name="__codelineno-51-17"></a><span class="s">      allowPrivilegeEscalation: false</span>
<a href="#__codelineno-51-18" id="__codelineno-51-18" name="__codelineno-51-18"></a><span class="s">      readOnlyRootFilesystem: true</span>
<a href="#__codelineno-51-19" id="__codelineno-51-19" name="__codelineno-51-19"></a><span class="s">      runAsNonRoot: true</span>
<a href="#__codelineno-51-20" id="__codelineno-51-20" name="__codelineno-51-20"></a><span class="s">      runAsUser: 1000</span>
<a href="#__codelineno-51-21" id="__codelineno-51-21" name="__codelineno-51-21"></a><span class="s">      capabilities:</span>
<a href="#__codelineno-51-22" id="__codelineno-51-22" name="__codelineno-51-22"></a><span class="s">        drop:</span>
<a href="#__codelineno-51-23" id="__codelineno-51-23" name="__codelineno-51-23"></a><span class="s">        - ALL</span>
<a href="#__codelineno-51-24" id="__codelineno-51-24" name="__codelineno-51-24"></a><span class="s">    volumeMounts:</span>
<a href="#__codelineno-51-25" id="__codelineno-51-25" name="__codelineno-51-25"></a><span class="s">    - name: cache</span>
<a href="#__codelineno-51-26" id="__codelineno-51-26" name="__codelineno-51-26"></a><span class="s">      mountPath: /var/cache/nginx</span>
<a href="#__codelineno-51-27" id="__codelineno-51-27" name="__codelineno-51-27"></a><span class="s">    - name: run</span>
<a href="#__codelineno-51-28" id="__codelineno-51-28" name="__codelineno-51-28"></a><span class="s">      mountPath: /var/run</span>
<a href="#__codelineno-51-29" id="__codelineno-51-29" name="__codelineno-51-29"></a><span class="s">  volumes:</span>
<a href="#__codelineno-51-30" id="__codelineno-51-30" name="__codelineno-51-30"></a><span class="s">  - name: cache</span>
<a href="#__codelineno-51-31" id="__codelineno-51-31" name="__codelineno-51-31"></a><span class="s">    emptyDir: {}</span>
<a href="#__codelineno-51-32" id="__codelineno-51-32" name="__codelineno-51-32"></a><span class="s">  - name: run</span>
<a href="#__codelineno-51-33" id="__codelineno-51-33" name="__codelineno-51-33"></a><span class="s">    emptyDir: {}</span>
<a href="#__codelineno-51-34" id="__codelineno-51-34" name="__codelineno-51-34"></a><span class="s">EOF</span>
</code></pre></div></p>
</li>
<li>
<p>Verify pod running:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-52-1" id="__codelineno-52-1" name="__codelineno-52-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>-n<span class="w"> </span>lab-restricted
<a href="#__codelineno-52-2" id="__codelineno-52-2" name="__codelineno-52-2"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>good-pod<span class="w"> </span>-n<span class="w"> </span>lab-restricted
</code></pre></div></p>
</li>
</ol>
<h3 id="lab-2-seccomp-profile-creation">Lab 2: Seccomp Profile Creation<a class="headerlink" href="#lab-2-seccomp-profile-creation" title="Permanent link">¶</a></h3>
<p><strong>Objective:</strong> Create and apply a custom seccomp profile.</p>
<p><strong>Steps:</strong></p>
<ol>
<li>
<p>Create audit profile:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-53-1" id="__codelineno-53-1" name="__codelineno-53-1"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/lib/kubelet/seccomp/profiles
<a href="#__codelineno-53-2" id="__codelineno-53-2" name="__codelineno-53-2"></a>
<a href="#__codelineno-53-3" id="__codelineno-53-3" name="__codelineno-53-3"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | sudo tee /var/lib/kubelet/seccomp/profiles/audit.json</span>
<a href="#__codelineno-53-4" id="__codelineno-53-4" name="__codelineno-53-4"></a><span class="s">{</span>
<a href="#__codelineno-53-5" id="__codelineno-53-5" name="__codelineno-53-5"></a><span class="s">  "defaultAction": "SCMP_ACT_LOG",</span>
<a href="#__codelineno-53-6" id="__codelineno-53-6" name="__codelineno-53-6"></a><span class="s">  "architectures": ["SCMP_ARCH_X86_64"],</span>
<a href="#__codelineno-53-7" id="__codelineno-53-7" name="__codelineno-53-7"></a><span class="s">  "syscalls": [</span>
<a href="#__codelineno-53-8" id="__codelineno-53-8" name="__codelineno-53-8"></a><span class="s">    {</span>
<a href="#__codelineno-53-9" id="__codelineno-53-9" name="__codelineno-53-9"></a><span class="s">      "names": ["accept", "bind", "connect", "read", "write"],</span>
<a href="#__codelineno-53-10" id="__codelineno-53-10" name="__codelineno-53-10"></a><span class="s">      "action": "SCMP_ACT_ALLOW"</span>
<a href="#__codelineno-53-11" id="__codelineno-53-11" name="__codelineno-53-11"></a><span class="s">    }</span>
<a href="#__codelineno-53-12" id="__codelineno-53-12" name="__codelineno-53-12"></a><span class="s">  ]</span>
<a href="#__codelineno-53-13" id="__codelineno-53-13" name="__codelineno-53-13"></a><span class="s">}</span>
<a href="#__codelineno-53-14" id="__codelineno-53-14" name="__codelineno-53-14"></a><span class="s">EOF</span>
</code></pre></div></p>
</li>
<li>
<p>Deploy pod with profile:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-54-1" id="__codelineno-54-1" name="__codelineno-54-1"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a href="#__codelineno-54-2" id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="s">apiVersion: v1</span>
<a href="#__codelineno-54-3" id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="s">kind: Pod</span>
<a href="#__codelineno-54-4" id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="s">metadata:</span>
<a href="#__codelineno-54-5" id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="s">  name: seccomp-test</span>
<a href="#__codelineno-54-6" id="__codelineno-54-6" name="__codelineno-54-6"></a><span class="s">spec:</span>
<a href="#__codelineno-54-7" id="__codelineno-54-7" name="__codelineno-54-7"></a><span class="s">  securityContext:</span>
<a href="#__codelineno-54-8" id="__codelineno-54-8" name="__codelineno-54-8"></a><span class="s">    seccompProfile:</span>
<a href="#__codelineno-54-9" id="__codelineno-54-9" name="__codelineno-54-9"></a><span class="s">      type: Localhost</span>
<a href="#__codelineno-54-10" id="__codelineno-54-10" name="__codelineno-54-10"></a><span class="s">      localhostProfile: profiles/audit.json</span>
<a href="#__codelineno-54-11" id="__codelineno-54-11" name="__codelineno-54-11"></a><span class="s">  containers:</span>
<a href="#__codelineno-54-12" id="__codelineno-54-12" name="__codelineno-54-12"></a><span class="s">  - name: test</span>
<a href="#__codelineno-54-13" id="__codelineno-54-13" name="__codelineno-54-13"></a><span class="s">    image: busybox</span>
<a href="#__codelineno-54-14" id="__codelineno-54-14" name="__codelineno-54-14"></a><span class="s">    command: ["sleep", "3600"]</span>
<a href="#__codelineno-54-15" id="__codelineno-54-15" name="__codelineno-54-15"></a><span class="s">EOF</span>
</code></pre></div></p>
</li>
<li>
<p>Monitor syscalls:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-55-1" id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="c1"># View audit logs</span>
<a href="#__codelineno-55-2" id="__codelineno-55-2" name="__codelineno-55-2"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>seccomp-test<span class="w"> </span>--<span class="w"> </span>dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>seccomp
</code></pre></div></p>
</li>
</ol>
<h3 id="lab-3-apparmor-profile">Lab 3: AppArmor Profile<a class="headerlink" href="#lab-3-apparmor-profile" title="Permanent link">¶</a></h3>
<p><strong>Objective:</strong> Create and enforce an AppArmor profile.</p>
<p><strong>Steps:</strong></p>
<ol>
<li>
<p>Create profile on node:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-56-1" id="__codelineno-56-1" name="__codelineno-56-1"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | sudo tee /etc/apparmor.d/k8s-deny-write</span>
<a href="#__codelineno-56-2" id="__codelineno-56-2" name="__codelineno-56-2"></a><span class="s">#include &lt;tunables/global&gt;</span>
<a href="#__codelineno-56-3" id="__codelineno-56-3" name="__codelineno-56-3"></a>
<a href="#__codelineno-56-4" id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="s">profile k8s-deny-write flags=(attach_disconnected,mediate_deleted) {</span>
<a href="#__codelineno-56-5" id="__codelineno-56-5" name="__codelineno-56-5"></a><span class="s">  #include &lt;abstractions/base&gt;</span>
<a href="#__codelineno-56-6" id="__codelineno-56-6" name="__codelineno-56-6"></a>
<a href="#__codelineno-56-7" id="__codelineno-56-7" name="__codelineno-56-7"></a><span class="s">  file,</span>
<a href="#__codelineno-56-8" id="__codelineno-56-8" name="__codelineno-56-8"></a>
<a href="#__codelineno-56-9" id="__codelineno-56-9" name="__codelineno-56-9"></a><span class="s">  # Deny all write operations</span>
<a href="#__codelineno-56-10" id="__codelineno-56-10" name="__codelineno-56-10"></a><span class="s">  deny /** w,</span>
<a href="#__codelineno-56-11" id="__codelineno-56-11" name="__codelineno-56-11"></a>
<a href="#__codelineno-56-12" id="__codelineno-56-12" name="__codelineno-56-12"></a><span class="s">  # Allow reads</span>
<a href="#__codelineno-56-13" id="__codelineno-56-13" name="__codelineno-56-13"></a><span class="s">  /** r,</span>
<a href="#__codelineno-56-14" id="__codelineno-56-14" name="__codelineno-56-14"></a><span class="s">}</span>
<a href="#__codelineno-56-15" id="__codelineno-56-15" name="__codelineno-56-15"></a><span class="s">EOF</span>
</code></pre></div></p>
</li>
<li>
<p>Load profile:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-57-1" id="__codelineno-57-1" name="__codelineno-57-1"></a>sudo<span class="w"> </span>apparmor_parser<span class="w"> </span>-r<span class="w"> </span>-W<span class="w"> </span>/etc/apparmor.d/k8s-deny-write
<a href="#__codelineno-57-2" id="__codelineno-57-2" name="__codelineno-57-2"></a>sudo<span class="w"> </span>aa-status<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>k8s-deny-write
</code></pre></div></p>
</li>
<li>
<p>Deploy pod with AppArmor:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-58-1" id="__codelineno-58-1" name="__codelineno-58-1"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a href="#__codelineno-58-2" id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="s">apiVersion: v1</span>
<a href="#__codelineno-58-3" id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="s">kind: Pod</span>
<a href="#__codelineno-58-4" id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="s">metadata:</span>
<a href="#__codelineno-58-5" id="__codelineno-58-5" name="__codelineno-58-5"></a><span class="s">  name: apparmor-test</span>
<a href="#__codelineno-58-6" id="__codelineno-58-6" name="__codelineno-58-6"></a><span class="s">  annotations:</span>
<a href="#__codelineno-58-7" id="__codelineno-58-7" name="__codelineno-58-7"></a><span class="s">    container.apparmor.security.beta.kubernetes.io/test: localhost/k8s-deny-write</span>
<a href="#__codelineno-58-8" id="__codelineno-58-8" name="__codelineno-58-8"></a><span class="s">spec:</span>
<a href="#__codelineno-58-9" id="__codelineno-58-9" name="__codelineno-58-9"></a><span class="s">  containers:</span>
<a href="#__codelineno-58-10" id="__codelineno-58-10" name="__codelineno-58-10"></a><span class="s">  - name: test</span>
<a href="#__codelineno-58-11" id="__codelineno-58-11" name="__codelineno-58-11"></a><span class="s">    image: busybox</span>
<a href="#__codelineno-58-12" id="__codelineno-58-12" name="__codelineno-58-12"></a><span class="s">    command: ["sleep", "3600"]</span>
<a href="#__codelineno-58-13" id="__codelineno-58-13" name="__codelineno-58-13"></a><span class="s">EOF</span>
</code></pre></div></p>
</li>
<li>
<p>Test enforcement:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-59-1" id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="c1"># Should succeed (read)</span>
<a href="#__codelineno-59-2" id="__codelineno-59-2" name="__codelineno-59-2"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>apparmor-test<span class="w"> </span>--<span class="w"> </span>cat<span class="w"> </span>/etc/hostname
<a href="#__codelineno-59-3" id="__codelineno-59-3" name="__codelineno-59-3"></a>
<a href="#__codelineno-59-4" id="__codelineno-59-4" name="__codelineno-59-4"></a><span class="c1"># Should fail (write)</span>
<a href="#__codelineno-59-5" id="__codelineno-59-5" name="__codelineno-59-5"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>apparmor-test<span class="w"> </span>--<span class="w"> </span>touch<span class="w"> </span>/tmp/test
</code></pre></div></p>
</li>
</ol>
<h3 id="lab-4-complete-secure-deployment">Lab 4: Complete Secure Deployment<a class="headerlink" href="#lab-4-complete-secure-deployment" title="Permanent link">¶</a></h3>
<p><strong>Objective:</strong> Create a production-ready secure deployment.</p>
<p><strong>Create deployment:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-60-1" id="__codelineno-60-1" name="__codelineno-60-1"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a href="#__codelineno-60-2" id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="s">apiVersion: v1</span>
<a href="#__codelineno-60-3" id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="s">kind: Namespace</span>
<a href="#__codelineno-60-4" id="__codelineno-60-4" name="__codelineno-60-4"></a><span class="s">metadata:</span>
<a href="#__codelineno-60-5" id="__codelineno-60-5" name="__codelineno-60-5"></a><span class="s">  name: secure-prod</span>
<a href="#__codelineno-60-6" id="__codelineno-60-6" name="__codelineno-60-6"></a><span class="s">  labels:</span>
<a href="#__codelineno-60-7" id="__codelineno-60-7" name="__codelineno-60-7"></a><span class="s">    pod-security.kubernetes.io/enforce: restricted</span>
<a href="#__codelineno-60-8" id="__codelineno-60-8" name="__codelineno-60-8"></a><span class="s">---</span>
<a href="#__codelineno-60-9" id="__codelineno-60-9" name="__codelineno-60-9"></a><span class="s">apiVersion: apps/v1</span>
<a href="#__codelineno-60-10" id="__codelineno-60-10" name="__codelineno-60-10"></a><span class="s">kind: Deployment</span>
<a href="#__codelineno-60-11" id="__codelineno-60-11" name="__codelineno-60-11"></a><span class="s">metadata:</span>
<a href="#__codelineno-60-12" id="__codelineno-60-12" name="__codelineno-60-12"></a><span class="s">  name: secure-app</span>
<a href="#__codelineno-60-13" id="__codelineno-60-13" name="__codelineno-60-13"></a><span class="s">  namespace: secure-prod</span>
<a href="#__codelineno-60-14" id="__codelineno-60-14" name="__codelineno-60-14"></a><span class="s">spec:</span>
<a href="#__codelineno-60-15" id="__codelineno-60-15" name="__codelineno-60-15"></a><span class="s">  replicas: 2</span>
<a href="#__codelineno-60-16" id="__codelineno-60-16" name="__codelineno-60-16"></a><span class="s">  selector:</span>
<a href="#__codelineno-60-17" id="__codelineno-60-17" name="__codelineno-60-17"></a><span class="s">    matchLabels:</span>
<a href="#__codelineno-60-18" id="__codelineno-60-18" name="__codelineno-60-18"></a><span class="s">      app: secure-app</span>
<a href="#__codelineno-60-19" id="__codelineno-60-19" name="__codelineno-60-19"></a><span class="s">  template:</span>
<a href="#__codelineno-60-20" id="__codelineno-60-20" name="__codelineno-60-20"></a><span class="s">    metadata:</span>
<a href="#__codelineno-60-21" id="__codelineno-60-21" name="__codelineno-60-21"></a><span class="s">      labels:</span>
<a href="#__codelineno-60-22" id="__codelineno-60-22" name="__codelineno-60-22"></a><span class="s">        app: secure-app</span>
<a href="#__codelineno-60-23" id="__codelineno-60-23" name="__codelineno-60-23"></a><span class="s">    spec:</span>
<a href="#__codelineno-60-24" id="__codelineno-60-24" name="__codelineno-60-24"></a><span class="s">      securityContext:</span>
<a href="#__codelineno-60-25" id="__codelineno-60-25" name="__codelineno-60-25"></a><span class="s">        runAsNonRoot: true</span>
<a href="#__codelineno-60-26" id="__codelineno-60-26" name="__codelineno-60-26"></a><span class="s">        runAsUser: 1000</span>
<a href="#__codelineno-60-27" id="__codelineno-60-27" name="__codelineno-60-27"></a><span class="s">        fsGroup: 2000</span>
<a href="#__codelineno-60-28" id="__codelineno-60-28" name="__codelineno-60-28"></a><span class="s">        seccompProfile:</span>
<a href="#__codelineno-60-29" id="__codelineno-60-29" name="__codelineno-60-29"></a><span class="s">          type: RuntimeDefault</span>
<a href="#__codelineno-60-30" id="__codelineno-60-30" name="__codelineno-60-30"></a><span class="s">      containers:</span>
<a href="#__codelineno-60-31" id="__codelineno-60-31" name="__codelineno-60-31"></a><span class="s">      - name: app</span>
<a href="#__codelineno-60-32" id="__codelineno-60-32" name="__codelineno-60-32"></a><span class="s">        image: nginx:1.25-alpine</span>
<a href="#__codelineno-60-33" id="__codelineno-60-33" name="__codelineno-60-33"></a><span class="s">        securityContext:</span>
<a href="#__codelineno-60-34" id="__codelineno-60-34" name="__codelineno-60-34"></a><span class="s">          allowPrivilegeEscalation: false</span>
<a href="#__codelineno-60-35" id="__codelineno-60-35" name="__codelineno-60-35"></a><span class="s">          readOnlyRootFilesystem: true</span>
<a href="#__codelineno-60-36" id="__codelineno-60-36" name="__codelineno-60-36"></a><span class="s">          runAsNonRoot: true</span>
<a href="#__codelineno-60-37" id="__codelineno-60-37" name="__codelineno-60-37"></a><span class="s">          runAsUser: 1000</span>
<a href="#__codelineno-60-38" id="__codelineno-60-38" name="__codelineno-60-38"></a><span class="s">          capabilities:</span>
<a href="#__codelineno-60-39" id="__codelineno-60-39" name="__codelineno-60-39"></a><span class="s">            drop:</span>
<a href="#__codelineno-60-40" id="__codelineno-60-40" name="__codelineno-60-40"></a><span class="s">            - ALL</span>
<a href="#__codelineno-60-41" id="__codelineno-60-41" name="__codelineno-60-41"></a><span class="s">        ports:</span>
<a href="#__codelineno-60-42" id="__codelineno-60-42" name="__codelineno-60-42"></a><span class="s">        - containerPort: 8080</span>
<a href="#__codelineno-60-43" id="__codelineno-60-43" name="__codelineno-60-43"></a><span class="s">        resources:</span>
<a href="#__codelineno-60-44" id="__codelineno-60-44" name="__codelineno-60-44"></a><span class="s">          limits:</span>
<a href="#__codelineno-60-45" id="__codelineno-60-45" name="__codelineno-60-45"></a><span class="s">            cpu: 200m</span>
<a href="#__codelineno-60-46" id="__codelineno-60-46" name="__codelineno-60-46"></a><span class="s">            memory: 128Mi</span>
<a href="#__codelineno-60-47" id="__codelineno-60-47" name="__codelineno-60-47"></a><span class="s">          requests:</span>
<a href="#__codelineno-60-48" id="__codelineno-60-48" name="__codelineno-60-48"></a><span class="s">            cpu: 100m</span>
<a href="#__codelineno-60-49" id="__codelineno-60-49" name="__codelineno-60-49"></a><span class="s">            memory: 64Mi</span>
<a href="#__codelineno-60-50" id="__codelineno-60-50" name="__codelineno-60-50"></a><span class="s">        volumeMounts:</span>
<a href="#__codelineno-60-51" id="__codelineno-60-51" name="__codelineno-60-51"></a><span class="s">        - name: cache</span>
<a href="#__codelineno-60-52" id="__codelineno-60-52" name="__codelineno-60-52"></a><span class="s">          mountPath: /var/cache/nginx</span>
<a href="#__codelineno-60-53" id="__codelineno-60-53" name="__codelineno-60-53"></a><span class="s">        - name: run</span>
<a href="#__codelineno-60-54" id="__codelineno-60-54" name="__codelineno-60-54"></a><span class="s">          mountPath: /var/run</span>
<a href="#__codelineno-60-55" id="__codelineno-60-55" name="__codelineno-60-55"></a><span class="s">      volumes:</span>
<a href="#__codelineno-60-56" id="__codelineno-60-56" name="__codelineno-60-56"></a><span class="s">      - name: cache</span>
<a href="#__codelineno-60-57" id="__codelineno-60-57" name="__codelineno-60-57"></a><span class="s">        emptyDir: {}</span>
<a href="#__codelineno-60-58" id="__codelineno-60-58" name="__codelineno-60-58"></a><span class="s">      - name: run</span>
<a href="#__codelineno-60-59" id="__codelineno-60-59" name="__codelineno-60-59"></a><span class="s">        emptyDir: {}</span>
<a href="#__codelineno-60-60" id="__codelineno-60-60" name="__codelineno-60-60"></a><span class="s">EOF</span>
</code></pre></div></p>
<p><strong>Verify security:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-61-1" id="__codelineno-61-1" name="__codelineno-61-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>secure-prod
<a href="#__codelineno-61-2" id="__codelineno-61-2" name="__codelineno-61-2"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>-n<span class="w"> </span>secure-prod<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="s2">"Security Context"</span>
</code></pre></div></p>
<hr/>
<h2 id="11-security-checklist">11. Security Checklist<a class="headerlink" href="#11-security-checklist" title="Permanent link">¶</a></h2>
<h3 id="pre-deployment-security-audit">Pre-Deployment Security Audit<a class="headerlink" href="#pre-deployment-security-audit" title="Permanent link">¶</a></h3>
<ul>
<li>[ ] <strong>Pod Security Standards</strong></li>
<li>[ ] Namespace has PSA labels configured</li>
<li>[ ] Enforcement level appropriate (restricted for prod)</li>
<li>
<p>[ ] Exemptions documented and minimal</p>
</li>
<li>
<p>[ ] <strong>Security Context</strong></p>
</li>
<li>[ ] runAsNonRoot: true</li>
<li>[ ] runAsUser set to non-zero UID</li>
<li>[ ] allowPrivilegeEscalation: false</li>
<li>[ ] readOnlyRootFilesystem: true (with required writable mounts)</li>
<li>[ ] All capabilities dropped, only required added</li>
<li>[ ] No privileged: true</li>
<li>
<p>[ ] No hostNetwork, hostPID, hostIPC</p>
</li>
<li>
<p>[ ] <strong>Seccomp/AppArmor/SELinux</strong></p>
</li>
<li>[ ] Seccomp profile configured (RuntimeDefault minimum)</li>
<li>[ ] AppArmor profile applied (if available)</li>
<li>
<p>[ ] SELinux context appropriate</p>
</li>
<li>
<p>[ ] <strong>Resource Management</strong></p>
</li>
<li>[ ] CPU limits and requests defined</li>
<li>[ ] Memory limits and requests defined</li>
<li>
<p>[ ] Storage limits on emptyDir volumes</p>
</li>
<li>
<p>[ ] <strong>Image Security</strong></p>
</li>
<li>[ ] Using specific image tags (not latest)</li>
<li>[ ] Images from trusted registries</li>
<li>[ ] Image scanned for vulnerabilities</li>
<li>
<p>[ ] Minimal base image (distroless/alpine)</p>
</li>
<li>
<p>[ ] <strong>Network Security</strong></p>
</li>
<li>[ ] Network policies defined</li>
<li>[ ] Ingress/egress rules restrictive</li>
<li>
<p>[ ] No unnecessary exposed ports</p>
</li>
<li>
<p>[ ] <strong>Volumes</strong></p>
</li>
<li>[ ] No hostPath volumes (unless absolutely required)</li>
<li>[ ] Sensitive data in Secrets, not ConfigMaps</li>
<li>
<p>[ ] Volume mounts have appropriate permissions</p>
</li>
<li>
<p>[ ] <strong>Monitoring</strong></p>
</li>
<li>[ ] Logging configured</li>
<li>[ ] Security events monitored</li>
<li>[ ] Alerts for policy violations</li>
</ul>
<hr/>
<h2 id="12-references">12. References<a class="headerlink" href="#12-references" title="Permanent link">¶</a></h2>
<h3 id="official-documentation">Official Documentation<a class="headerlink" href="#official-documentation" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Kubernetes Pod Security Standards</strong></li>
<li>
<p>https://kubernetes.io/docs/concepts/security/pod-security-standards/</p>
</li>
<li>
<p><strong>Pod Security Admission</strong></p>
</li>
<li>
<p>https://kubernetes.io/docs/concepts/security/pod-security-admission/</p>
</li>
<li>
<p><strong>Security Context</strong></p>
</li>
<li>
<p>https://kubernetes.io/docs/tasks/configure-pod-container/security-context/</p>
</li>
<li>
<p><strong>Seccomp</strong></p>
</li>
<li>
<p>https://kubernetes.io/docs/tutorials/security/seccomp/</p>
</li>
<li>
<p><strong>AppArmor</strong></p>
</li>
<li>https://kubernetes.io/docs/tutorials/security/apparmor/</li>
</ol>
<h3 id="security-frameworks">Security Frameworks<a class="headerlink" href="#security-frameworks" title="Permanent link">¶</a></h3>
<ol>
<li><strong>CIS Kubernetes Benchmark v1.8</strong></li>
<li>
<p>https://www.cisecurity.org/benchmark/kubernetes</p>
</li>
<li>
<p><strong>NSA/CISA Kubernetes Hardening Guide</strong></p>
</li>
<li>
<p>https://media.defense.gov/2022/Aug/29/2003066362/-1/-1/0/CTR_KUBERNETES_HARDENING_GUIDANCE_1.2_20220829.PDF</p>
</li>
<li>
<p><strong>NIST SP 800-190 - Container Security</strong></p>
</li>
<li>
<p>https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-190.pdf</p>
</li>
<li>
<p><strong>CNCF Security TAG - Cloud Native Security Whitepaper</strong></p>
</li>
<li>https://github.com/cncf/tag-security/tree/main/security-whitepaper</li>
</ol>
<h3 id="linux-security">Linux Security<a class="headerlink" href="#linux-security" title="Permanent link">¶</a></h3>
<ol>
<li>
<p><strong>Linux Capabilities Man Page</strong></p>
<ul>
<li>https://man7.org/linux/man-pages/man7/capabilities.7.html</li>
</ul>
</li>
<li>
<p><strong>Seccomp BPF</strong></p>
<ul>
<li>https://www.kernel.org/doc/html/latest/userspace-api/seccomp_filter.html</li>
</ul>
</li>
<li>
<p><strong>AppArmor Documentation</strong></p>
<ul>
<li>https://gitlab.com/apparmor/apparmor/-/wikis/Documentation</li>
</ul>
</li>
<li>
<p><strong>SELinux Project</strong></p>
<ul>
<li>https://github.com/SELinuxProject/selinux</li>
</ul>
</li>
</ol>
<h3 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">¶</a></h3>
<ol>
<li>
<p><strong>kubesec - Security risk analysis</strong></p>
<ul>
<li>https://kubesec.io/</li>
</ul>
</li>
<li>
<p><strong>kube-bench - CIS benchmark checker</strong></p>
<ul>
<li>https://github.com/aquasecurity/kube-bench</li>
</ul>
</li>
<li>
<p><strong>Polaris - Kubernetes best practices</strong></p>
<ul>
<li>https://github.com/FairwindsOps/polaris</li>
</ul>
</li>
</ol>
<hr/>
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">¶</a></h2>
<p>Continue to <strong>Module 07: Admission Control and Policy</strong> to learn about policy enforcement, admission webhooks, OPA/Gatekeeper, and Kyverno for cluster-wide security governance.</p>
<hr/>
<p><strong>Module Completion Status:</strong> ✅ Complete</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2025 K8s Security Training Contributors
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/yourusername/k8s-architecture-and-security-training" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
<script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
</body>
</html>